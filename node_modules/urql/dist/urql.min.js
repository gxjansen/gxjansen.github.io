Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@urql/core"),t=require("react"),r=require("wonka"),n=t.createContext({}),u=n.Provider,s=n.Consumer;n.displayName="UrqlContext";var a=()=>t.useContext(n),o={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0},i=(e,t)=>e===t||!(!e||!t||e.key!==t.key),c=(e,t)=>{var r={...e,...t,data:void 0!==t.data||t.error?t.data:e.data,fetching:!!t.fetching,stale:!!t.stale};return((e,t)=>{for(var r in e)if(!(r in t))return!0;for(var n in t)if("operation"===n?!i(e[n],t[n]):e[n]!==t[n])return!0;return!1})(e,r)?r:e},f=(e,t)=>{for(var r=0,n=t.length;r<n;r++)if(e[r]!==t[r])return!0;return!1};function l(e,t){e(t)}function d(n){var u=t.useRef(!0),s=a(),[i,c]=t.useState(o),f=t.useCallback(((t,a)=>(l(c,{...o,fetching:!0}),r.toPromise(r.take(1)(r.filter((e=>!e.hasNext))(r.onPush((e=>{u.current&&l(c,{fetching:!1,stale:e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation})}))(s.executeMutation(e.createRequest(n,t),a||{}))))))),[s,n,c]);return t.useEffect((()=>(u.current=!0,()=>{u.current=!1})),[]),[i,f]}function p(r,n){var u=t.useRef(void 0);return t.useMemo((()=>{var t=e.createRequest(r,n);return void 0!==u.current&&u.current.key===t.key?u.current:(u.current=t,t)}),[r,n])}function v(e){var n=a(),u=(e=>{if(!e._react){var t=new Set,n=new Map;e.operations$&&r.subscribe((e=>{"teardown"===e.kind&&t.has(e.key)&&(t.delete(e.key),n.delete(e.key))}))(e.operations$),e._react={get:e=>n.get(e),set(e,r){t.delete(e),n.set(e,r)},dispose(e){t.add(e)}}}return e._react})(n),s=((e,t)=>t&&void 0!==t.suspense?!!t.suspense:e.suspense)(n,e.context),i=p(e.query,e.variables),d=t.useMemo((()=>{if(e.pause)return null;var t=n.executeQuery(i,{requestPolicy:e.requestPolicy,...e.context});return s?r.onPush((e=>{u.set(i.key,e)}))(t):t}),[u,n,i,s,e.pause,e.requestPolicy,e.context]),v=t.useCallback(((e,t)=>{if(!e)return{fetching:!1};var n=u.get(i.key);if(n){if(t&&null!=n&&"then"in n)throw n}else{var s,a=r.subscribe((e=>{n=e,s&&s(n)}))(r.takeWhile((()=>t&&!s||!n))(e));if(null==n&&t){var o=new Promise((e=>{s=e}));throw u.set(i.key,o),o}a.unsubscribe()}return n||{fetching:!0}}),[u,i]),x=[n,i,e.requestPolicy,e.context,e.pause],[y,h]=t.useState((()=>[d,c(o,v(d,s)),x])),b=y[1];d!==y[0]&&f(y[2],x)&&h([d,b=c(y[1],v(d,s)),x]),t.useEffect((()=>{var e=y[0],t=y[2][1],n=!1,s=e=>{n=!0,l(h,(t=>{var r=c(t[1],e);return t[1]!==r?[t[0],r,t[2]]:t}))};if(e){var a=r.subscribe(s)(r.onEnd((()=>{s({fetching:!1})}))(e));return n||s({fetching:!0}),()=>{u.dispose(t.key),a.unsubscribe()}}s({fetching:!1})}),[u,y[0],y[2][1]]);var k=t.useCallback((t=>{var a={requestPolicy:e.requestPolicy,...e.context,...t};l(h,(e=>[s?r.onPush((e=>{u.set(i.key,e)}))(n.executeQuery(i,a)):n.executeQuery(i,a),e[1],x]))}),[n,u,i,s,e.requestPolicy,e.context,e.pause]);return[b,k]}function x(e,n){var u=a(),s=p(e.query,e.variables),i=t.useRef(n);i.current=n;var d=t.useMemo((()=>e.pause?null:u.executeSubscription(s,e.context)),[u,s,e.pause,e.context]),v=[u,s,e.context,e.pause],[x,y]=t.useState((()=>[d,{...o,fetching:!!d},v])),h=x[1];d!==x[0]&&f(x[2],v)&&y([d,h=c(x[1],{fetching:!!d}),v]),t.useEffect((()=>{var e=e=>{l(y,(t=>{var r=c(t[1],e);return t[1]===r?t:(i.current&&t[1].data!==r.data&&(r.data=i.current(t[1].data,r.data)),[t[0],r,t[2]])}))};if(x[0])return r.subscribe(e)(r.onEnd((()=>{e({fetching:!!d})}))(x[0])).unsubscribe;e({fetching:!1})}),[x[0]]);var b=t.useCallback((t=>{var r=u.executeSubscription(s,{...e.context,...t});l(y,(e=>[r,e[1],v]))}),[u,s,e.context,e.pause]);return[h,b]}exports.Consumer=s,exports.Context=n,exports.Mutation=function(e){var t=d(e.query);return e.children({...t[0],executeMutation:t[1]})},exports.Provider=u,exports.Query=function(e){var t=v(e);return e.children({...t[0],executeQuery:t[1]})},exports.Subscription=function(e){var t=x(e,e.handler);return e.children({...t[0],executeSubscription:t[1]})},exports.useClient=a,exports.useMutation=d,exports.useQuery=v,exports.useSubscription=x,Object.keys(e).forEach((function(t){"default"===t||exports.hasOwnProperty(t)||Object.defineProperty(exports,t,{enumerable:!0,get:function(){return e[t]}})}));
//# sourceMappingURL=urql.min.js.map
