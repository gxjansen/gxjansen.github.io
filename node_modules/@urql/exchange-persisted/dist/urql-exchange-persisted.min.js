Object.defineProperty(exports,"__esModule",{value:!0});var e,r=require("wonka"),t=require("@urql/core"),n="undefined"!=typeof window?window.crypto:"undefined"!=typeof self?self.crypto:null,i=async r=>{if(n&&n.subtle){var t=await n.subtle.digest({name:"SHA-256"},(new TextEncoder).encode(r));return new Uint8Array(t).reduce(((e,r)=>e+r.toString(16).padStart(2,"0")),"")}return await(async()=>{if(!e)try{e=new Function("require",'return require("crypto")')(require)}catch(r){try{e=new Function('return import("crypto")')()}catch(e){}}return e})()?(await e).createHash("sha256").update(r).digest("hex"):""};exports.persistedExchange=e=>({forward:n})=>{e||(e={});var s=e.preferGetForPersistedQueries,o=!!e.enforcePersistedQueries,a=e.generateHash||i,u=!!e.enableForMutation,p=!!e.enableForSubscriptions,d=!0,c=e=>d&&!e.context.persistAttempt&&(u&&"mutation"===e.kind||p&&"subscription"===e.kind||"query"===e.kind);return e=>{var i=r.makeSubject(),u=r.filter((e=>!c(e)))(e),p=r.mergeMap((n=>{var i=(async e=>{var r=t.makeOperation(e.kind,e,{...e.context,persistAttempt:!0}),n=await a(t.stringifyDocument(e.query),e.query);return n&&(r.extensions={...r.extensions,persistedQuery:{version:1,sha256Hash:n}},"query"===r.kind&&s&&(r.context.preferGetMethod=s)),r})(n);return r.takeUntil(r.filter((e=>"teardown"===e.kind&&e.key===n.key))(e))(r.fromPromise(i))}))(r.filter(c)(e));return r.filter((e=>!!e))(r.map((e=>{if(!o&&e.operation.extensions&&e.operation.extensions.persistedQuery){if(e.error&&e.error.graphQLErrors.some((e=>"PersistedQueryNotSupported"===e.message))){d=!1;var r=t.makeOperation(e.operation.kind,e.operation);return r.extensions&&delete r.extensions.persistedQuery,i.next(r),null}if(e.error&&e.error.graphQLErrors.some((e=>"PersistedQueryNotFound"===e.message))){if(e.operation.extensions.persistedQuery.miss)return e;var n=t.makeOperation(e.operation.kind,e.operation);return n.extensions={...n.extensions,persistedQuery:{...(n.extensions||{}).persistedQuery,miss:!0}},i.next(n),null}}return e}))(n(r.merge([p,u,i.source]))))}};
//# sourceMappingURL=urql-exchange-persisted.min.js.map
