Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@urql/core"),r=require("@0no-co/graphql.web"),t=require("wonka"),i="\nhttps://bit.ly/2XbVrpR#";function a(e,r,t){if(!e){var a=new Error((r||"Minfied Error #"+t+"\n")+i+t);throw a.name="Graphcache Error",a}}new Set;var n={},o=e=>e._directives||n,s=e=>e.name.value,l=e=>e.typeCondition.name.value,d=e=>e.alias?e.alias.value:e.name.value,u=[],p=e=>e.selectionSet?e.selectionSet.selections:u,v=e=>e.typeCondition?e.typeCondition.name.value:null,f=(e,t)=>{var i=null;if(e.arguments)for(var a=0,n=e.arguments.length;a<n;a++){var o=e.arguments[a],l=r.valueFromASTUntyped(o.value,t);null!=l&&(i||(i={}),i[s(o)]=l)}return i},y=(e,r)=>{if(r&&e.variableDefinitions){for(var t={},i=0,a=e.variableDefinitions.length;i<a;i++){var n=s(e.variableDefinitions[i].variable);t[n]=r[n]}return t}},c=(e,t)=>{var i={};if(!t)return i;if(e.variableDefinitions)for(var a=0,n=e.variableDefinitions.length;a<n;a++){var o=e.variableDefinitions[a],l=s(o.variable);i[l]=void 0===t[l]&&o.defaultValue?r.valueFromASTUntyped(o.defaultValue,t):t[l]}for(var d in t)d in i||(i[d]=t[d]);return i};function m(e){for(var t=0;t<e.definitions.length;t++)if(e.definitions[t].kind===r.Kind.OPERATION_DEFINITION)return e.definitions[t];a(!1,"",1)}var h=e=>{for(var t={},i=0;i<e.definitions.length;i++){var a=e.definitions[i];a.kind===r.Kind.FRAGMENT_DEFINITION&&(t[s(a)]=a)}return t},g=(e,t)=>{var i=o(e);if(i.include||i.skip)for(var a in i){var n=i[a];if(n&&("include"===a||"skip"===a)&&n.arguments&&n.arguments[0]&&"if"===s(n.arguments[0])){var l=r.valueFromASTUntyped(n.arguments[0].value,t);return"include"===a?!!l:!l}}return!0},k=(e,t)=>{var{defer:i}=o(e);if(i){for(var a of i.arguments||[])if("if"===s(a))return!!r.valueFromASTUntyped(a.value,t);return!0}return!1},_=e=>{var{optional:r,required:t}=o(e);return!t&&(!!r||void 0)},O=(e,r,t,i)=>{var a=N(e,r,t,i);return!!a&&"NON_NULL"!==a.type.kind},w=(e,r,t,i)=>{var a=N(e,r,t,i);if(!a)return!1;var n="NON_NULL"===a.type.kind?a.type.ofType:a.type;return"LIST"===n.kind&&"NON_NULL"!==n.ofType.kind},b=(e,r,t)=>{if(!t)return!1;var i=v(r);return!i||t===i||(e.types.has(i)&&"OBJECT"===e.types.get(i).kind?i===t:(function(e,r){a(e.types.has(r)&&("INTERFACE"===e.types.get(r).kind||"UNION"===e.types.get(r).kind),"",5)}(e,i),q(e,t),e.isSubType(i,t)))},N=(e,r,t,i)=>{if(0!==t.indexOf("__")&&0!==r.indexOf("__"))return q(e,r),e.types.get(r).fields()[t]};function q(e,r){a(e.types.has(r)&&"OBJECT"===e.types.get(r).kind,"",3)}var x=(r,t)=>t?`${r}(${e.stringifyVariables(t)})`:r,K=(e,r)=>`${e}.${r}`,S=e=>{var r=e.indexOf("(");return r>-1?{fieldKey:e,fieldName:e.slice(0,r),arguments:JSON.parse(e.slice(r+1,-1))}:{fieldKey:e,fieldName:e,arguments:null}},E=e=>{var r=e.indexOf(".");return{entityKey:e.slice(0,r).replace(/%2e/g,"."),fieldKey:e.slice(r+1)}},M=null,A=null,T=null,D=null,F=null,I=null,C=!1,L=!1;function $(e,r){var t;if(e){if(M.has(e))return e;t=A.get(e)}return null==t&&(t=r?[]:{}),e&&A.set(e,t),M.add(t),t}var R=e=>!!e&&M.has(e),P=(e,r,t,i,a)=>{M=new WeakSet,A=new WeakMap,F=e,T=r,I=new Set,L=!!i,C=!!a,t?"read"===F?D=t:i||r.hydrating||r.optimisticOrder.length>1?(i||r.commutativeKeys.has(t)?i&&(-1===r.optimisticOrder.indexOf(t)||r.commutativeKeys.has(t)||r.optimisticOrder.splice(r.optimisticOrder.indexOf(t),1),r.commutativeKeys.delete(t)):te(r,t),D=t,ie(r,t)):(D=null,ne(r,t)):D=null},j=()=>{var e=T,r=D;if(L=!1,D=null,!e.hydrating&&r&&e.optimisticOrder.indexOf(r)>-1)for(var t=e.optimisticOrder.length;--t>=0&&e.dirtyKeys.has(e.optimisticOrder[t])&&e.commutativeKeys.has(e.optimisticOrder[t]);)oe(e.optimisticOrder[t]);M=null,A=null,F=null,T=null,I=null,e.defer||!e.storage&&e.optimisticOrder.length||(e.defer=!0,setTimeout((()=>{P("read",e,null),H(),le(),j(),e.defer=!1})))},U=(e,r,t)=>{r&&!t&&e.deferredKeys.delete(r),P("write",e,r,t),j()},J=new Set,Q=(e,r,t,i)=>{var a=D?e.optimistic.get(D):e.base,n=a.get(r);void 0===n&&a.set(r,n=Object.create(null)),void 0!==i||D?n[t]=i:delete n[t]},B=(e,r,t)=>{for(var i,a=!L&&"read"===F&&D&&T.commutativeKeys.has(D),n=0,o=T.optimisticOrder.length;n<o;n++){var s=T.optimisticOrder[n],l=e.optimistic.get(s);if(a=a&&s!==D,l&&(!a||!T.commutativeKeys.has(s))&&(!L||"write"===F||T.commutativeKeys.has(s))&&void 0!==(i=l.get(r))&&t in i)return i[t]}return void 0!==(i=e.base.get(r))?i[t]:void 0},V=(e,r)=>{if(Array.isArray(e))for(var t=0,i=e.length;t<i;t++)V(e[t],r);else"string"==typeof e&&((e,r)=>{var t=T.refCount.get(e)||0,i=t+r>0?t+r:0;T.refCount.set(e,i),i?!t&&i&&T.gc.delete(e):T.gc.add(e)})(e,r)},G=(e,r,t)=>{if(void 0!==t)for(var i in t)r.has(i)||(e.push(S(i)),r.add(i))},z=(e,r,t,i)=>{G(e,r,i.base.get(t));for(var a=0,n=T.optimisticOrder.length;a<n;a++){var o=i.optimistic.get(T.optimisticOrder[a]);void 0!==o&&G(e,r,o.get(t))}},H=()=>{if(!T.optimisticOrder.length)for(var e of T.gc.keys())if(T.gc.delete(e),!((T.refCount.get(e)||0)>0)){var r=T.records.base.get(e);T.refCount.delete(e),T.records.base.delete(e);var t=r&&r.__typename;if(t){var i=T.types.get(t);i&&i.delete(e)}var a=T.links.base.get(e);if(a)for(var n in T.links.base.delete(e),a)V(a[n],-1)}},W=(e,r)=>{e!==T.queryRootKey?I.add(e):void 0!==r&&"__typename"!==r&&I.add(K(e,r))},X=(e,r)=>{!L&&T.storage&&T.persist.add(((e,r)=>`${e.replace(/\./g,"%2e")}.${r}`)(e,r))},Y=(e,r)=>(W(e,r),B(T.records,e,r)),Z=(e,r)=>(W(e,r),B(T.links,e,r)),ee=(e,r,t)=>{W(e,r),X(e,r),Q(T.records,e,r,t)},re=(e,r,t)=>{var i=D?T.links.optimistic.get(D):T.links.base;if(!D){var a=i&&i.get(e);V(a&&a[r],-1),V(t,1)}W(e,r),X(e,r),Q(T.links,e,r,t)},te=(e,r,t)=>{var i=e.optimisticOrder.indexOf(r);if(i>-1&&e.optimisticOrder.splice(i,1),t)for(e.deferredKeys.add(r),i=i>-1?i:0;i<e.optimisticOrder.length&&!e.deferredKeys.has(e.optimisticOrder[i])&&(!e.dirtyKeys.has(e.optimisticOrder[i])||!e.commutativeKeys.has(e.optimisticOrder[i]));i++);else e.deferredKeys.delete(r),i>-1&&!e.commutativeKeys.has(r)&&ae(e,r),i=0;e.optimisticOrder.splice(i,0,r),e.commutativeKeys.add(r)},ie=(e,r)=>{-1===e.optimisticOrder.indexOf(r)&&e.optimisticOrder.unshift(r),e.dirtyKeys.has(r)||(e.dirtyKeys.add(r),e.links.optimistic.set(r,new Map),e.records.optimistic.set(r,new Map))},ae=(e,r)=>{e.dirtyKeys.has(r)&&(e.dirtyKeys.delete(r),e.records.optimistic.delete(r),e.links.optimistic.delete(r),e.deferredKeys.delete(r))},ne=(e,r)=>{var t=e.optimisticOrder.indexOf(r);t>-1&&(e.optimisticOrder.splice(t,1),e.commutativeKeys.delete(r)),ae(e,r)},oe=e=>{var r=I;I=new Set,F="write";var t=T.links.optimistic.get(e);if(t)for(var i of t.entries()){var a=i[0],n=i[1];for(var o in n)re(a,o,n[o])}var s=T.records.optimistic.get(e);if(s)for(var l of s.entries()){var d=l[0],u=l[1];for(var p in u)ee(d,p,u[p])}I=r,ne(T,e)},se=e=>{var{links:r,records:t}=T,i=[],a=new Set;return W(e),z(i,a,e,r),z(i,a,e,t),i},le=()=>{if(T.storage){L=!0,F="read";var r={};for(var t of T.persist.keys()){var{entityKey:i,fieldKey:a}=E(t),n=void 0;r[t]=void 0!==(n=Z(i,a))?`:${e.stringifyVariables(n)}`:void 0!==(n=Y(i,a))?e.stringifyVariables(n):void 0}L=!1,T.storage.writeData(r),T.persist.clear()}},de=null,ue=!1,pe=void 0,ve=e=>e.__internal.path.length>0&&e.__internal.errorMap?e.__internal.errorMap[e.__internal.path.join(".")]:void 0,fe=(e,r,t,i,a,n)=>{var o={store:e,variables:r,fragments:t,parent:{__typename:i},parentTypeName:i,parentKey:a,parentFieldKey:"",fieldName:"",error:void 0,partial:!1,hasNext:!1,optimistic:L,__internal:{path:[],errorMap:void 0}};if(n&&n.graphQLErrors)for(var s=0;s<n.graphQLErrors.length;s++){var l=n.graphQLErrors[s];l.path&&l.path.length&&(o.__internal.errorMap||(o.__internal.errorMap=Object.create(null)),o.__internal.errorMap[l.path.join(".")]=l)}return o},ye=(e,r,t,i,a,n)=>{de=e,e.parent=r,e.parentTypeName=t,e.parentKey=i,e.parentFieldKey=a,e.fieldName=n,e.error=ve(e)},ce=(e,t,i,a,n)=>{if(!t)return!1;var o=v(e);return!o||t===o||"write"===F||!p(e).some((e=>{if(e.kind!==r.Kind.FIELD)return!1;var t=x(s(e),f(e,a));return!((e,r)=>void 0!==Y(e,r)||void 0!==Z(e,r))(i,t)}))};function me(e,t,i,a,n,o){var l,d=0;return function(){for(var u;l||d<n.length;)if(u=void 0,ue=i,pe=a,l){if(u=l())return u;l=void 0}else{var v=n[d++];if(g(v,o.variables))if(v.kind!==r.Kind.FIELD){var f=v.kind!==r.Kind.INLINE_FRAGMENT?o.fragments[s(v)]:v;if(f&&(!f.typeCondition||(o.store.schema?b(o.store.schema,f,e):ce(f,e,t,o.variables)))){var y=_(v);l=me(e,t,i||k(v,o.variables),void 0!==y?y:a,p(f),o)}}else if("write"===F||!v._generated)return v}}}var he=e=>null==e?null:e,ge=(e,r)=>{if(!r)return r||null;if(Array.isArray(r)){for(var t=new Array(r.length),i=0,a=t.length;i<a;i++)t[i]=ge(e,r[i]);return t}return e.keyOfEntity(r)},ke=(r,t,i,a)=>{var n=e.formatDocument(t.query),o=m(n),s=r.rootFields[o.operation],l=p(o),d=fe(r,c(o,t.variables),h(n),s,s,a),u=s!==d.store.rootFields.query?_e(d,s,l,i||$()):be(d,s,l,i||$());return{dependencies:I,partial:d.partial||!u,hasNext:d.hasNext,data:u||null}},_e=(e,r,t,i)=>{if("string"!=typeof(e.store.rootNames[r]?r:i.__typename))return i;for(var a,n=me(r,r,!1,void 0,t,e),o=C,s=$(i);a=n();){var l,u=d(a),v=i[u];e.__internal.path.push(u),l=a.selectionSet&&null!==v?Oe(e,p(a),he(v)):v,o=o||l!==v,void 0!==l&&(s[u]=l),e.__internal.path.pop()}return o?s:i},Oe=(e,r,t)=>{if(Array.isArray(t)){for(var i=new Array(t.length),a=C,n=0,o=t.length;n<o;n++)e.__internal.path.push(n),i[n]=Oe(e,r,t[n]),a=a||i[n]!==t[n],e.__internal.path.pop();return a?i:t}if(null===t)return null;var s=e.store.keyOfEntity(t);return null!==s?be(e,s,r,t)||null:_e(e,t.__typename,r,t)};function we(e,r,t,i){var a=i.store.resolvers[r],n=a&&a[t];for(var o in e){var s=e[o];if(s&&"include"!==o&&"skip"!==o&&i.store.directives[o])return i.store.directives[o](f(s,i.variables))}return n}var be=(e,r,t,i,a)=>{var{store:n}=e,l=r===n.rootFields.query,u=a&&n.keyOfEntity(a)||r,v=l?r:Y(u,"__typename")||a&&a.__typename;if("string"==typeof v&&(!a||v===a.__typename)){for(var y,c=me(v,u,!1,void 0,t,e),m=!1,h=!1,g=C,k=e.partial,_=$(i);void 0!==(y=c());){var w=s(y),b=f(y,e.variables),N=d(y),q=o(y),S=we(q,v,w,e),E=x(w,b),M=K(u,E),A=Y(u,E),T=a?a[w]:void 0;e.__internal.path.push(N);var D=void 0;if("__typename"===w)D=v;else if(void 0!==T&&void 0===y.selectionSet)D=T;else if("read"===F&&S){var I=_;if(void 0===y.selectionSet&&void 0!==A&&(I={..._,[N]:A,[w]:A}),ye(e,I,v,u,E,w),D=S(I,b||{},n,e),y.selectionSet&&(D=Ne(e,v,w,M,p(y),void 0!==_[N]?_[N]:i[N],D,R(i))),n.schema&&null===D&&!O(n.schema,v,w,e.store.logger))return}else if(y.selectionSet)if(void 0!==T)D=Ne(e,v,w,M,p(y),void 0!==_[N]?_[N]:i[N],T,R(i));else{var L=Z(u,E);void 0!==L?D=qe(e,L,v,w,p(y),void 0!==_[N]?_[N]:i[N],R(i)):"object"==typeof A&&null!==A&&(D=A)}else D=A;if(!ue&&void 0===D&&(q.optional||pe&&!q.required||ve(e)||n.schema&&O(n.schema,v,w,e.store.logger))?(e.partial=!0,D=null):null!==D||!q.required&&!1!==pe?m=m||"__typename"!==w:D=void 0,e.__internal.path.pop(),g=g||D!==i[N],void 0!==D)_[N]=D;else{if(!ue)return void(e.partial=k);h=!0}}return e.partial=e.partial||k,e.hasNext=e.hasNext||h,l&&e.partial&&!m?void 0:g?_:i}},Ne=(e,r,t,i,a,n,o,s)=>{if(Array.isArray(o)){for(var{store:l}=e,d=!!l.schema&&w(l.schema,r,t,e.store.logger),u=e.partial,p=$(n,!0),v=C||!Array.isArray(n)||o.length!==n.length,f=0,y=o.length;f<y;f++){e.__internal.path.push(f);var c=Ne(e,r,t,K(i,`${f}`),a,null!=n?n[f]:void 0,o[f],s);if(e.__internal.path.pop(),void 0===c&&!d)return void(e.partial=u);e.partial=e.partial||void 0===c&&d,p[f]=null!=c?c:null,v=v||p[f]!==n[f]}return v?p:n}if(null==o)return o;if(s&&null===n)return null;if(xe(o)){var m=n||$(n);return"string"==typeof o?be(e,o,a,m):be(e,i,a,m,o)}},qe=(e,r,t,i,a,n,o)=>{if(Array.isArray(r)){for(var{store:s}=e,l=!!s.schema&&w(s.schema,t,i,e.store.logger),d=$(n,!0),u=e.partial,p=C||!Array.isArray(n)||r.length!==n.length,v=0,f=r.length;v<f;v++){e.__internal.path.push(v);var y=qe(e,r[v],t,i,a,null!=n?n[v]:void 0,o);if(e.__internal.path.pop(),void 0===y&&!l)return void(e.partial=u);e.partial=e.partial||void 0===y&&l,d[v]=y||null,p=p||d[v]!==n[v]}return p?d:n}return null===r||null===n&&o?null:be(e,r,a,n||$(n))},xe=e=>"string"==typeof e||"object"==typeof e&&"string"==typeof e.__typename,Ke=(r,t,i,a)=>{var n=e.formatDocument(t.query),o=m(n),s={data:i||$(),dependencies:I},l=r.rootFields[o.operation],d=fe(r,c(o,t.variables),h(n),l,l,a);return Se(d,l,p(o),s.data),s},Se=(e,r,t,i)=>{var a=e.store.rootNames[r]||"query",n=!!e.store.rootNames[r],o=n?r:i.__typename;if(!o&&r&&e.optimistic&&(o=Y(r,"__typename")),o){!n&&r&&(ee(r,"__typename",o),((e,r)=>{var t=T.types.get(e);if(t)t.add(r);else{var i=new Set;i.add(r),T.types.set(e,i)}})(o,r));for(var l,u=e.store.updates[o],v=me(o,r||o,!1,void 0,t,e);l=v();){var y=s(l),c=f(l,e.variables),m=x(y,c),h=d(l),g=i[e.optimistic?y:h];if(!("__typename"===y||void 0===g&&(ue||e.optimistic&&"query"===a))){e.__internal.path.push(h);var k=void 0;if(e.optimistic&&"mutation"===a){if(!(k=e.store.optimisticMutations[y]))continue}else e.optimistic&&"function"==typeof g&&(k=g);if(k&&(ye(e,i,o,r||o,m,y),g=he(k(c||{},e.store,e))),void 0!==g){if(l.selectionSet)if(r&&"query"===a){var _=K(r,m),O=Ee(e,p(l),he(g),_,e.optimistic?Z(r||o,m):void 0);re(r||o,m,O)}else Ee(e,p(l),he(g));else r&&"query"===a&&ee(r||o,m,null===g&&ve(e)?void 0:g);var w=u&&u[y];w&&(ye(e,i,o,r||o,m,y),i[y]=g,w(i,c||{},e.store,e)),e.__internal.path.pop()}}}}},Ee=(e,r,t,i,a)=>{if(Array.isArray(t)){for(var n=new Array(t.length),o=0,s=t.length;o<s;o++){e.__internal.path.push(o);var l=i?K(i,`${o}`):void 0,d=Ee(e,r,t[o],l,null!=a?a[o]:void 0);n[o]=d,e.__internal.path.pop()}return n}if(null===t)return ve(e)?void 0:null;var u=e.store.keyOfEntity(t)||("string"==typeof a?a:null)||i;return Se(e,u,r,t),u||null},Me=(e,r,t)=>{for(var i=r?[{fieldKey:x(r,t)}]:se(e),a=0,n=i.length;a<n;a++){var{fieldKey:o}=i[a];void 0!==Z(e,o)?re(e,o,void 0):ee(e,o,void 0)}};class Ae{constructor(e){e||(e={}),this.logger=e.logger,this.resolvers=e.resolvers||{},this.directives=e.directives||{},this.optimisticMutations=e.optimistic||{},this.keys=e.keys||{},this.globalIDs=Array.isArray(e.globalIDs)?new Set(e.globalIDs):!!e.globalIDs;var r,t="Query",i="Mutation",a="Subscription";if(e.schema){var n=(({__schema:e})=>{var r=new Map,t=e=>{var r;return()=>{if(!r){r={};for(var t=0;t<e.length;t++)r[e[t].name]=e[t]}return r}},i=e=>{switch(e.kind){case"OBJECT":case"INTERFACE":return{name:e.name,kind:e.kind,interfaces:t(e.interfaces||[]),fields:t(e.fields.map((e=>({name:e.name,type:e.type,args:t(e.args)}))))};case"UNION":return{name:e.name,kind:e.kind,types:t(e.possibleTypes||[])}}},a={query:e.queryType?e.queryType.name:null,mutation:e.mutationType?e.mutationType.name:null,subscription:e.subscriptionType?e.subscriptionType.name:null,types:void 0,isSubType(e,t){var i=r.get(e),a=r.get(t);return!!(i&&a&&("UNION"===i.kind?i.types()[t]:"OBJECT"!==i.kind&&"OBJECT"===a.kind?a.interfaces()[e]:e===t))}};if(e.types){a.types=r;for(var n=0;n<e.types.length;n++){var o=e.types[n];if(o&&o.name){var s=i(o);s&&r.set(o.name,s)}}}return a})(e.schema);t=n.query||t,i=n.mutation||i,a=n.subscription||a,n.types&&(this.schema=n)}this.updates=e.updates||{},this.rootFields={query:t,mutation:i,subscription:a},this.rootNames={[t]:"query",[i]:"mutation",[a]:"subscription"},this.data=(r=t,{hydrating:!1,defer:!1,gc:new Set,types:new Map,persist:new Set,queryRootKey:r,refCount:new Map,links:{optimistic:new Map,base:new Map},records:{optimistic:new Map,base:new Map},deferredKeys:new Set,commutativeKeys:new Set,dirtyKeys:new Set,optimisticOrder:[],storage:null})}keyOfField(e,r){return x(e,r)}keyOfEntity(e){if(de&&e===de.parent)return de.parentKey;if(null==e||"string"==typeof e)return e||null;if(!e.__typename)return null;if(this.rootNames[e.__typename])return e.__typename;var r=null;this.keys[e.__typename]?r=this.keys[e.__typename](e)||null:null!=e.id?r=`${e.id}`:null!=e._id&&(r=`${e._id}`);var t=e.__typename;return!0===this.globalIDs||this.globalIDs&&this.globalIDs.has(t)||!r?r:`${t}:${r}`}resolve(e,r,t){var i=this.keyOfEntity(e);if(i){var a=x(r,t),n=Y(i,a);if(void 0!==n)return n;var o=Z(i,a);return void 0!==o&&(o=ge(this,o)),o}}resolveFieldByKey(e,r,t){return this.resolve(e,r,t)}invalidate(e,r,t){var i=this.keyOfEntity(e);!e||"string"!=typeof e||r||t||this.resolve(e,"__typename")?(a(i,"",19),Me(i,r,t)):(e=>{var r=(e=>T.types.get(e)||J)(e);for(var t of r)Me(t)})(e)}inspectFields(e){var r=this.keyOfEntity(e);return r?se(r):[]}updateQuery(r,t){var i=e.createRequest(r.query,r.variables),a=t(this.readQuery(i));null!==a&&Ke(this,i,a,void 0)}readQuery(r){var t=e.createRequest(r.query,r.variables);return ke(this,t,void 0,void 0).data}readFragment(r,t,i,a){return((e,r,t,i,a)=>{var n,o=h(r);if(a){if(!(n=o[a]))return null}else if(!(n=o[Object.keys(o)[0]]))return null;var s=l(n);"string"==typeof t||t.__typename||(t.__typename=s);var d=e.keyOfEntity(t);if(!d)return null;var u=fe(e,i||{},o,s,d,void 0);return be(u,d,p(n),$())||null})(this,e.formatDocument(r),t,i,a)}writeFragment(r,t,i,a){((e,r,t,i,a)=>{var n,o=h(r);if(a){if(!(n=o[a]))return null}else if(!(n=o[Object.keys(o)[0]]))return null;var s=l(n),d={__typename:s,...t},u=e.keyOfEntity(d);if(u){var v=fe(e,i||{},o,s,u,void 0);Se(v,u,p(n),d)}})(this,e.formatDocument(r),t,i,a)}link(e,r,...t){var i=2===t.length?t[0]:null,a=2===t.length?t[1]:t[0],n=this.keyOfEntity(e);n&&re(n,x(r,i),ge(this,a))}}var Te=(r,t)=>e.makeOperation(r.kind,r,{...r.context,requestPolicy:t}),De=r=>({forward:i,client:a})=>{var n=new Ae(r);r&&r.storage&&(n.data.hydrating=!0,r.storage.readData().then((e=>{((e,r,t)=>{for(var i in P("write",e,null),t){var a=t[i];if(void 0!==a){var{entityKey:n,fieldKey:o}=E(i);":"===a[0]?void 0===Z(n,o)&&re(n,o,JSON.parse(a.slice(1))):void 0===Y(n,o)&&ee(n,o,JSON.parse(a))}}e.storage=r,e.hydrating=!1,j()})(n.data,r.storage,e),r.storage.onCacheHydrated&&r.storage.onCacheHydrated()})));var o=new Map,s=[],l=new Map,d=new Map,u=new Set,p=new Set,v=new Map,f=new Set,c=new Set,h=e=>{for(var r of e.values())if(u.has(r))return!0;return!1},g=(e,r)=>{if(r)for(var t of r.values()){var i=v.get(t);if(i)for(var a of i.values())e.add(a)}},k=(e,r,t)=>{for(var i of r.values())if(i!==e.key){var n=l.get(i);if(n){"query"===e.kind&&c.add(i);var o="cache-first";p.has(i)&&(p.delete(i),o="cache-and-network"),a.reexecuteOperation(Te(n,o))}}if(!t){var s=f;"query"===e.kind&&(f=c).add(e.key),(c=s).clear()}},_=r=>{var t=!1;if("query"===r.kind)te(n.data,r.key),l.set(r.key,r);else{if("teardown"===r.kind)return l.delete(r.key),d.delete(r.key),f.delete(r.key),U(n.data,r.key),r;if("mutation"===r.kind&&"network-only"!==r.context.requestPolicy){l.set(r.key,r),P("write",n.data,r.key,!0,!1);var{dependencies:i}=Ke(n,r,void 0,void 0);if(j(),i.size){for(var a of i.values())u.add(a);o.set(r.key,i);var s=new Set;g(s,i),k(r,s,!0),t=!0}}}return e.makeOperation(r.kind,{key:r.key,query:e.formatDocument(r.query),variables:r.variables?y(m(r.query),r.variables):r.variables},{...r.context,optimistic:t})},O=(e,r)=>{for(var t of r.values()){var i=v.get(t);i||v.set(t,i=new Set),i.add(e.key)}},w=e=>{P("read",n.data,void 0,!1,!1);var r=ke(n,e,d.get(e.key),void 0);j();var t=r.data?r.partial||r.hasNext?"partial":"hit":"miss";return d.set(e.key,r.data),l.set(e.key,e),O(e,r.dependencies),{outcome:t,operation:e,data:r.data,dependencies:r.dependencies,hasNext:r.hasNext}},b=(e,r)=>{var t,i=l.get(e.operation.key)||e.operation;if("mutation"===i.kind){var a=o.get(i.key);g(r,a),o.delete(i.key)}("subscription"===i.kind||e.hasNext)&&te(n.data,i.key,!0);var s=e.data;if(s){P("write",n.data,i.key,!1,!1);var u=Ke(n,i,s,e.error).dependencies;j(),g(r,u);var p="query"===i.kind?d.get(i.key):null;P("read",n.data,i.key,!1,p!==s);var v=ke(n,i,p||s,e.error);j(),s=v.data,"query"===i.kind&&(g(r,t=v.dependencies),d.set(i.key,s))}else U(n.data,i.key);return t&&O(e.operation,t),{operation:i,data:s,error:e.error,extensions:e.extensions,hasNext:e.hasNext,stale:e.stale}};return e=>{var r=t.share(t.map(w)(t.filter((e=>"query"===e.kind&&"network-only"!==e.context.requestPolicy))(e))),d=t.filter((e=>"query"!==e.kind||"network-only"===e.context.requestPolicy))(e),v=t.map((e=>e.operation))(t.filter((e=>"miss"===e.outcome&&"cache-only"!==e.operation.context.requestPolicy&&!h(e.dependencies)&&!f.has(e.operation.key)))(r)),y=t.map((e=>{var r,t,{requestPolicy:i}=e.operation.context,o="cache-only"!==i&&(e.hasNext||"cache-and-network"===i||"cache-first"===i&&"partial"===e.outcome&&!f.has(e.operation.key)),s="cache-only"!==i&&(o||"partial"===e.outcome&&f.has(e.operation.key)&&((r=n.data).commutativeKeys.has(t=e.operation.key)||r.optimisticOrder.indexOf(t)>-1)),d={operation:e.operation,data:e.data,error:e.error,extensions:e.extensions,stale:s&&!e.hasNext,hasNext:o&&e.hasNext};return o&&(h(e.dependencies)?"cache-and-network"===i&&p.add(e.operation.key):a.reexecuteOperation(Te(l.get(e.operation.key)||e.operation,"network-only"))),d}))(t.filter((e=>"miss"!==e.outcome||"cache-only"===e.operation.context.requestPolicy))(r)),c=i(t.map(_)(t.merge([d,v]))),m=t.map((e=>{var r=new Set,t=b(e,r);return k(e.operation,r,!1),t}))(t.filter((e=>!o.has(e.operation.key)))(c)),g=t.mergeMap((e=>{if(s.push(e)<o.size)return t.empty;for(var r=0;r<s.length;r++)te(n.data,s[r].operation.key);u.clear();for(var i,a=[],l=new Set;i=s.shift();)a.push(b(i,l));return k(e.operation,l,!1),t.fromArray(a)}))(t.filter((e=>o.has(e.operation.key)))(c));return t.merge([m,g,y])}},Fe={"cache-only":0,"cache-first":1,"network-only":2,"cache-and-network":3};exports.Store=Ae,exports.cacheExchange=De,exports.offlineExchange=r=>i=>{var{storage:a}=r,n=r.isOfflineError||(e=>e&&e.networkError&&!e.response&&("undefined"!=typeof navigator&&!1===navigator.onLine||/request failed|failed to fetch|network\s?error/i.test(e.networkError.message)));if(a&&a.onOnline&&a.readMetadata&&a.writeMetadata){var{forward:o,client:s,dispatchDebug:l}=i,{source:d,next:u}=t.makeSubject(),p=[],v=!1,f=!1,y=()=>{if(v){for(var r=[],t=0;t<p.length;t++){var i=p[t];"mutation"===i.kind&&r.push({query:e.stringifyDocument(i.query),variables:i.variables,extensions:i.extensions})}a.writeMetadata(r)}},c=e=>{for(var r=p.length-1;r>=0;r--)p[r].key===e&&p.splice(r,1)},m=()=>{if(!f){var r=new Set;f=!0;for(var t=0;t<p.length;t++){var i=p[t];if("mutation"===i.kind||!r.has(i.key))if(r.add(i.key),"subscription"!==i.kind){u(e.makeOperation("teardown",i));for(var a="cache-first",n=0;n<p.length;n++){var{requestPolicy:o}=p[n].context;Fe[o]>Fe[a]&&(a=o)}u(Te(i,a))}else u(Te(i,"cache-first"))}f=!1,p.length=0,y()}},h=De({...r,storage:{...a,readData(){var r=a.readData();return{async then(t){for(var i=await a.readMetadata(),n=0;i&&n<i.length;n++)p.push(s.createRequestOperation("mutation",e.createRequest(i[n].query,i[n].variables),i[n].extensions));t(await r),a.onOnline(m),v=!0,m()}}}}})({client:s,dispatchDebug:l,forward:e=>t.share(t.filter((e=>!(v&&"mutation"===e.operation.kind&&e.operation.context.optimistic&&n(e.error,e)&&(p.push(e.operation),y(),1))))(o(e)))});return e=>{var r=t.merge([d,t.onPush((e=>{"query"!==e.kind||v?"teardown"===e.kind&&c(e.key):p.push(e)}))(e)]);return t.filter((e=>{if("query"===e.operation.kind){if(n(e.error,e))return u(Te(e.operation,"cache-only")),p.push(e.operation),!1;v||c(e.operation.key)}return!0}))(h(r))}}return De(r)(i)};
//# sourceMappingURL=urql-exchange-graphcache.min.js.map
