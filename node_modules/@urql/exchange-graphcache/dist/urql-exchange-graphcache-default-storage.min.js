Object.defineProperty(exports,"__esModule",{value:!0});var e=e=>new Promise(((r,t)=>{e.onerror=()=>{t(e.error)},e.onsuccess=()=>{r(e.result)}})),r=e=>new Promise(((r,t)=>{e.onerror=()=>{t(e.error)},e.oncomplete=r}));exports.makeDefaultStorage=t=>{var a;t||(t={});var n=t.idbName||"graphcache-v4",o="entries",c="metadata",s=Object.create(null),i=Math.floor((new Date).valueOf()/864e5),l=i-(t.maxAge||7),u=indexedDB.open(n,1),d=e(u);u.onupgradeneeded=()=>{u.result.createObjectStore(o),u.result.createObjectStore(c)};var v=e=>e.replace(/:/g,"%3a"),h=e=>e.replace(/%3a/g,":"),b=e=>{for(var r={},t="",a="",n="",o=0,c=0;c<e.length;){for(n="";":"!==(t=e[c++])&&t;)n+=t;o?(r[a]=h(n)||void 0,o=0):(a=h(n),o=1)}return r};return{clear:()=>d.then((e=>{var t=e.transaction([c,o],"readwrite");return t.objectStore(c).clear(),t.objectStore(o).clear(),s=Object.create(null),r(t)})),readMetadata:()=>d.then((r=>e(r.transaction(c,"readonly").objectStore(c).get(c))),(()=>null)),writeMetadata(r){d.then((t=>e(t.transaction(c,"readwrite").objectStore(c).put(r,c))),(()=>{}))},writeData(r){Object.assign(s,r);var t=()=>{};return d.then((r=>e(r.transaction(o,"readwrite").objectStore(o).put((()=>{var e="";for(var r in s){var t=s[r];e+=v(r),e+=":",t&&(e+=v(t)),e+=":"}return e})(),i)))).then(t,t)},readData(){var e=[];return d.then((t=>{var a=t.transaction(o,"readwrite"),n=a.objectStore(o);return(n.openKeyCursor||n.openCursor).call(n).onsuccess=function(){if(this.result){var{key:r}=this.result;if("number"!=typeof r||r<l)n.delete(r);else{var t=n.get(r),a=e.length;e.push(""),t.onsuccess=()=>{var n=""+t.result;r===i&&Object.assign(s,b(n)),e[a]=n}}this.result.continue()}},r(a)})).then((()=>b(e.join(""))),(()=>s))},onCacheHydrated:t.onCacheHydrated,onOnline(e){a&&(window.removeEventListener("online",a),a=void 0),window.addEventListener("online",a=()=>{e()})}}};
//# sourceMappingURL=urql-exchange-graphcache-default-storage.min.js.map
