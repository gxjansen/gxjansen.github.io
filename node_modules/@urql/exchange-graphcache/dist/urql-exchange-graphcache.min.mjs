import{stringifyVariables as e,formatDocument as t,createRequest as r,makeOperation as i,stringifyDocument as a}from"@urql/core";import{Kind as n,valueFromASTUntyped as o}from"@0no-co/graphql.web";import{share as s,map as l,filter as d,merge as p,mergeMap as u,empty as v,fromArray as y,makeSubject as f,onPush as c}from"wonka";var h="\nhttps://bit.ly/2XbVrpR#";function m(e,t,r){if(!e){var i=new Error((t||"Minfied Error #"+r+"\n")+h+r);throw i.name="Graphcache Error",i}}new Set;var g={},k=e=>e._directives||g,_=e=>e.name.value,w=e=>e.typeCondition.name.value,O=e=>e.alias?e.alias.value:e.name.value,b=[],x=e=>e.selectionSet?e.selectionSet.selections:b,N=e=>e.typeCondition?e.typeCondition.name.value:null,q=(e,t)=>{var r=null;if(e.arguments)for(var i=0,a=e.arguments.length;i<a;i++){var n=e.arguments[i],s=o(n.value,t);null!=s&&(r||(r={}),r[_(n)]=s)}return r},K=(e,t)=>{if(t&&e.variableDefinitions){for(var r={},i=0,a=e.variableDefinitions.length;i<a;i++){var n=_(e.variableDefinitions[i].variable);r[n]=t[n]}return r}},S=(e,t)=>{var r={};if(!t)return r;if(e.variableDefinitions)for(var i=0,a=e.variableDefinitions.length;i<a;i++){var n=e.variableDefinitions[i],s=_(n.variable);r[s]=void 0===t[s]&&n.defaultValue?o(n.defaultValue,t):t[s]}for(var l in t)l in r||(r[l]=t[l]);return r};function E(e){for(var t=0;t<e.definitions.length;t++)if(e.definitions[t].kind===n.OPERATION_DEFINITION)return e.definitions[t];m(!1,"",1)}var M=e=>{for(var t={},r=0;r<e.definitions.length;r++){var i=e.definitions[r];i.kind===n.FRAGMENT_DEFINITION&&(t[_(i)]=i)}return t},A=(e,t)=>{var r=k(e);if(r.include||r.skip)for(var i in r){var a=r[i];if(a&&("include"===i||"skip"===i)&&a.arguments&&a.arguments[0]&&"if"===_(a.arguments[0])){var n=o(a.arguments[0].value,t);return"include"===i?!!n:!n}}return!0},T=(e,t)=>{var{defer:r}=k(e);if(r){for(var i of r.arguments||[])if("if"===_(i))return!!o(i.value,t);return!0}return!1},C=e=>{var{optional:t,required:r}=k(e);return!r&&(!!t||void 0)},I=(e,t,r,i)=>{var a=L(e,t,r,i);return!!a&&"NON_NULL"!==a.type.kind},D=(e,t,r,i)=>{var a=L(e,t,r,i);if(!a)return!1;var n="NON_NULL"===a.type.kind?a.type.ofType:a.type;return"LIST"===n.kind&&"NON_NULL"!==n.ofType.kind},F=(e,t,r)=>{if(!r)return!1;var i=N(t);return!i||r===i||(e.types.has(i)&&"OBJECT"===e.types.get(i).kind?i===r:(function(e,t){m(e.types.has(t)&&("INTERFACE"===e.types.get(t).kind||"UNION"===e.types.get(t).kind),"",5)}(e,i),$(e,r),e.isSubType(i,r)))},L=(e,t,r,i)=>{if(0!==r.indexOf("__")&&0!==t.indexOf("__"))return $(e,t),e.types.get(t).fields()[r]};function $(e,t){m(e.types.has(t)&&"OBJECT"===e.types.get(t).kind,"",3)}var j=(t,r)=>r?`${t}(${e(r)})`:t,P=(e,t)=>`${e}.${t}`,R=e=>{var t=e.indexOf("(");return t>-1?{fieldKey:e,fieldName:e.slice(0,t),arguments:JSON.parse(e.slice(t+1,-1))}:{fieldKey:e,fieldName:e,arguments:null}},J=e=>{var t=e.indexOf(".");return{entityKey:e.slice(0,t).replace(/%2e/g,"."),fieldKey:e.slice(t+1)}},Q=null,U=null,B=null,z=null,G=null,V=null,H=!1,W=!1;function X(e,t){var r;if(e){if(Q.has(e))return e;r=U.get(e)}return null==r&&(r=t?[]:{}),e&&U.set(e,r),Q.add(r),r}var Y=e=>!!e&&Q.has(e),Z=(e,t,r,i,a)=>{Q=new WeakSet,U=new WeakMap,G=e,B=t,V=new Set,W=!!i,H=!!a,r?"read"===G?z=r:i||t.hydrating||t.optimisticOrder.length>1?(i||t.commutativeKeys.has(r)?i&&(-1===t.optimisticOrder.indexOf(r)||t.commutativeKeys.has(r)||t.optimisticOrder.splice(t.optimisticOrder.indexOf(r),1),t.commutativeKeys.delete(r)):me(t,r),z=r,ge(t,r)):(z=null,_e(t,r)):z=null},ee=()=>{var e=B,t=z;if(W=!1,z=null,!e.hydrating&&t&&e.optimisticOrder.indexOf(t)>-1)for(var r=e.optimisticOrder.length;--r>=0&&e.dirtyKeys.has(e.optimisticOrder[r])&&e.commutativeKeys.has(e.optimisticOrder[r]);)we(e.optimisticOrder[r]);Q=null,U=null,G=null,B=null,V=null,e.defer||!e.storage&&e.optimisticOrder.length||(e.defer=!0,setTimeout((()=>{Z("read",e,null),de(),be(),ee(),e.defer=!1})))},te=(e,t,r)=>{t&&!r&&e.deferredKeys.delete(t),Z("write",e,t,r),ee()},re=new Set,ie=(e,t,r,i)=>{var a=z?e.optimistic.get(z):e.base,n=a.get(t);void 0===n&&a.set(t,n=Object.create(null)),void 0!==i||z?n[r]=i:delete n[r]},ae=(e,t,r)=>{for(var i,a=!W&&"read"===G&&z&&B.commutativeKeys.has(z),n=0,o=B.optimisticOrder.length;n<o;n++){var s=B.optimisticOrder[n],l=e.optimistic.get(s);if(a=a&&s!==z,l&&(!a||!B.commutativeKeys.has(s))&&(!W||"write"===G||B.commutativeKeys.has(s))&&void 0!==(i=l.get(t))&&r in i)return i[r]}return void 0!==(i=e.base.get(t))?i[r]:void 0};function ne(e){return B.refCount.get(e)||0}var oe=(e,t)=>{if(Array.isArray(e))for(var r=0,i=e.length;r<i;r++)oe(e[r],t);else"string"==typeof e&&((e,t)=>{var r=ne(e),i=r+t>0?r+t:0;B.refCount.set(e,i),i?!r&&i&&B.gc.delete(e):B.gc.add(e)})(e,t)},se=(e,t,r)=>{if(void 0!==r)for(var i in r)t.has(i)||(e.push(R(i)),t.add(i))},le=(e,t,r,i)=>{se(e,t,i.base.get(r));for(var a=0,n=B.optimisticOrder.length;a<n;a++){var o=i.optimistic.get(B.optimisticOrder[a]);void 0!==o&&se(e,t,o.get(r))}},de=()=>{if(!B.optimisticOrder.length)for(var e of B.gc.keys())if(B.gc.delete(e),!(ne(e)>0)){var t=B.records.base.get(e);B.refCount.delete(e),B.records.base.delete(e);var r=t&&t.__typename;if(r){var i=B.types.get(r);i&&i.delete(e)}var a=B.links.base.get(e);if(a)for(var n in B.links.base.delete(e),a)oe(a[n],-1)}},pe=(e,t)=>{e!==B.queryRootKey?V.add(e):void 0!==t&&"__typename"!==t&&V.add(P(e,t))},ue=(e,t)=>{!W&&B.storage&&B.persist.add(((e,t)=>`${e.replace(/\./g,"%2e")}.${t}`)(e,t))},ve=(e,t)=>("read"===G&&pe(e,t),ae(B.records,e,t)),ye=(e,t)=>("read"===G&&pe(e,t),ae(B.links,e,t)),fe=(e,t)=>{var r=B.abstractToConcreteMap.get(e);if(r)r.add(t);else{var i=new Set;i.add(t),B.abstractToConcreteMap.set(e,i)}},ce=(e,t,r)=>{xe(ae(B.records,e,t),r)||(pe(e,t),ue(e,t)),ie(B.records,e,t,r)},he=(e,t,r)=>{var i=z?B.links.optimistic.get(z):B.links.base;if(!z){var a=i&&i.get(e);oe(a&&a[t],-1),oe(r,1)}xe(ae(B.links,e,t),r)||(pe(e,t),ue(e,t)),ie(B.links,e,t,r)},me=(e,t,r)=>{var i=e.optimisticOrder.indexOf(t);if(i>-1&&e.optimisticOrder.splice(i,1),r)for(e.deferredKeys.add(t),i=i>-1?i:0;i<e.optimisticOrder.length&&!e.deferredKeys.has(e.optimisticOrder[i])&&(!e.dirtyKeys.has(e.optimisticOrder[i])||!e.commutativeKeys.has(e.optimisticOrder[i]));i++);else e.deferredKeys.delete(t),i>-1&&!e.commutativeKeys.has(t)&&ke(e,t),i=0;e.optimisticOrder.splice(i,0,t),e.commutativeKeys.add(t)},ge=(e,t)=>{-1===e.optimisticOrder.indexOf(t)&&e.optimisticOrder.unshift(t),e.dirtyKeys.has(t)||(e.dirtyKeys.add(t),e.links.optimistic.set(t,new Map),e.records.optimistic.set(t,new Map))},ke=(e,t)=>{e.dirtyKeys.has(t)&&(e.dirtyKeys.delete(t),e.records.optimistic.delete(t),e.links.optimistic.delete(t),e.deferredKeys.delete(t))},_e=(e,t)=>{var r=e.optimisticOrder.indexOf(t);r>-1&&(e.optimisticOrder.splice(r,1),e.commutativeKeys.delete(t)),ke(e,t)},we=e=>{var t=V;V=new Set,G="write";var r=B.links.optimistic.get(e);if(r)for(var i of r.entries()){var a=i[0],n=i[1];for(var o in n)he(a,o,n[o])}var s=B.records.optimistic.get(e);if(s)for(var l of s.entries()){var d=l[0],p=l[1];for(var u in p)ce(d,u,p[u])}V=t,_e(B,e)},Oe=e=>{var{links:t,records:r}=B,i=[],a=new Set;return pe(e),le(i,a,e,t),le(i,a,e,r),i},be=()=>{if(B.storage){W=!0,G="read";var t={};for(var r of B.persist.keys()){var{entityKey:i,fieldKey:a}=J(r),n=void 0;t[r]=void 0!==(n=ye(i,a))?`:${e(n)}`:void 0!==(n=ve(i,a))?e(n):void 0}W=!1,B.storage.writeData(t),B.persist.clear()}};function xe(e,t){return typeof e==typeof t&&e===t&&(!Array.isArray(e)||!Array.isArray(t)||e.length===t.length&&!e.some(((e,r)=>e!==t[r])))}var Ne=null,qe=!1,Ke=void 0,Se=e=>e.__internal.path.length>0&&e.__internal.errorMap?e.__internal.errorMap[e.__internal.path.join(".")]:void 0,Ee=(e,t,r,i,a,n)=>{var o={store:e,variables:t,fragments:r,parent:{__typename:i},parentTypeName:i,parentKey:a,parentFieldKey:"",fieldName:"",error:void 0,partial:!1,hasNext:!1,optimistic:W,__internal:{path:[],errorMap:void 0}};if(n&&n.graphQLErrors)for(var s=0;s<n.graphQLErrors.length;s++){var l=n.graphQLErrors[s];l.path&&l.path.length&&(o.__internal.errorMap||(o.__internal.errorMap=Object.create(null)),o.__internal.errorMap[l.path.join(".")]=l)}return o},Me=(e,t,r,i,a,n)=>{Ne=e,e.parent=t,e.parentTypeName=r,e.parentKey=i,e.parentFieldKey=a,e.fieldName=n,e.error=Se(e)},Ae=(e,t,r,i,a)=>{if(!t)return!1;var o=N(e);return!o||t===o||!x(e).some((e=>{if(e.kind!==n.FIELD)return!1;var t=j(_(e),q(e,i));return!((e,t)=>void 0!==ve(e,t)||void 0!==ye(e,t))(r,t)}))};class Te{constructor(e,t,r,i,a,n){this.typename=e,this.entityKey=t,this.ctx=n,this.stack=[{selectionSet:a,index:0,defer:r,optional:i}]}next(){for(;this.stack.length>0;){for(var e=this.stack[this.stack.length-1];e.index<e.selectionSet.length;){var t=e.selectionSet[e.index++];if(A(t,this.ctx.variables))if(t.kind!==n.FIELD){var r=t.kind!==n.INLINE_FRAGMENT?this.ctx.fragments[_(t)]:t;if(r){var i=!r.typeCondition||(this.ctx.store.schema?F(this.ctx.store.schema,r,this.typename):"read"===G&&Ce(r.typeCondition.name.value,this.typename)||Ae(r,this.typename,this.entityKey,this.ctx.variables));if(i||"write"===G&&!this.ctx.store.schema){var a=C(t);i&&r.typeCondition&&this.typename!==r.typeCondition.name.value&&fe(r.typeCondition.name.value,this.typename),this.stack.push(e={selectionSet:x(r),index:0,defer:e.defer||T(t,this.ctx.variables),optional:void 0!==a?a:e.optional})}}}else if("write"===G||!t._generated)return qe=e.defer,Ke=e.optional,t}this.stack.pop()}}}var Ce=(e,t)=>{if(!t)return!1;if(e===t)return!0;var r=!(e=>B.types.has(e))(e);if(!r)return!1;var i=(e=>B.abstractToConcreteMap.get(e)||re)(e);return i.size&&i.has(t)},Ie=e=>null==e?null:e,De=(e,t)=>{if(!t)return t||null;if(Array.isArray(t)){for(var r=new Array(t.length),i=0,a=r.length;i<a;i++)r[i]=De(e,t[i]);return r}return e.keyOfEntity(t)},Fe=(e,r,i,a)=>{var n=t(r.query),o=E(n),s=e.rootFields[o.operation],l=x(o),d=Ee(e,S(o,r.variables),M(n),s,s,a),p=s!==d.store.rootFields.query?Le(d,s,l,i||X()):Pe(d,s,l,i||X());return{dependencies:V,partial:d.partial||!p,hasNext:d.hasNext,data:p||null}},Le=(e,t,r,i)=>{if("string"!=typeof(e.store.rootNames[t]?t:i.__typename))return i;for(var a,n=new Te(t,t,!1,void 0,r,e),o=H,s=X(i);a=n.next();){var l,d=O(a),p=i[d];e.__internal.path.push(d),l=a.selectionSet&&null!==p?$e(e,x(a),Ie(p)):p,o=o||l!==p,void 0!==l&&(s[d]=l),e.__internal.path.pop()}return o?s:i},$e=(e,t,r)=>{if(Array.isArray(r)){for(var i=new Array(r.length),a=H,n=0,o=r.length;n<o;n++)e.__internal.path.push(n),i[n]=$e(e,t,r[n]),a=a||i[n]!==r[n],e.__internal.path.pop();return a?i:r}if(null===r)return null;var s=e.store.keyOfEntity(r);return null!==s?Pe(e,s,t,r)||null:Le(e,r.__typename,t,r)};function je(e,t,r,i){var a=i.store.resolvers[t],n=a&&a[r];for(var o in e){var s=e[o];if(s&&"include"!==o&&"skip"!==o&&i.store.directives[o])return i.store.directives[o](q(s,i.variables))}return n}var Pe=(e,t,r,i,a)=>{var{store:n}=e,o=t===n.rootFields.query,s=a&&n.keyOfEntity(a)||t,l=o?t:ve(s,"__typename")||a&&a.__typename;if("string"==typeof l&&(!a||l===a.__typename)){for(var d,p=new Te(l,s,!1,void 0,r,e),u=!1,v=!1,y=H,f=e.partial,c=X(i);void 0!==(d=p.next());){var h=_(d),m=q(d,e.variables),g=O(d),w=k(d),b=je(w,l,h,e),N=j(h,m),K=P(s,N),S=ve(s,N),E=a?a[h]:void 0;e.__internal.path.push(g);var M=void 0;if("__typename"===h)M=l;else if(void 0!==E&&void 0===d.selectionSet)M=E;else if("read"===G&&b){var A=c;if(void 0===d.selectionSet&&void 0!==S&&(A={...c,[g]:S,[h]:S}),Me(e,A,l,s,N,h),M=b(A,m||{},n,e),d.selectionSet&&(M=Re(e,l,h,K,x(d),void 0!==c[g]?c[g]:i[g],M,Y(i))),n.schema&&null===M&&!I(n.schema,l,h,e.store.logger))return}else if(d.selectionSet)if(void 0!==E)M=Re(e,l,h,K,x(d),void 0!==c[g]?c[g]:i[g],E,Y(i));else{var T=ye(s,N);void 0!==T?M=Je(e,T,l,h,x(d),void 0!==c[g]?c[g]:i[g],Y(i)):"object"==typeof S&&null!==S&&(M=S)}else M=S;if(!qe&&void 0===M&&(w.optional||Ke&&!w.required||Se(e)||!w.required&&n.schema&&I(n.schema,l,h,e.store.logger))?(e.partial=!0,M=null):null!==M||!w.required&&!1!==Ke?u=u||"__typename"!==h:M=void 0,e.__internal.path.pop(),y=y||M!==i[g],void 0!==M)c[g]=M;else{if(!qe)return void(e.partial=f);v=!0}}return e.partial=e.partial||f,e.hasNext=e.hasNext||v,o&&e.partial&&!u?void 0:y?c:i}},Re=(e,t,r,i,a,n,o,s)=>{if(Array.isArray(o)){for(var{store:l}=e,d=!!l.schema&&D(l.schema,t,r,e.store.logger),p=e.partial,u=X(n,!0),v=H||!Array.isArray(n)||o.length!==n.length,y=0,f=o.length;y<f;y++){e.__internal.path.push(y);var c=Re(e,t,r,P(i,`${y}`),a,null!=n?n[y]:void 0,o[y],s);if(e.__internal.path.pop(),void 0===c&&!d)return void(e.partial=p);e.partial=e.partial||void 0===c&&d,u[y]=null!=c?c:null,v=v||u[y]!==n[y]}return v?u:n}if(null==o)return o;if(s&&null===n)return null;if(Qe(o)){var h=n||X(n);return"string"==typeof o?Pe(e,o,a,h):Pe(e,i,a,h,o)}},Je=(e,t,r,i,a,n,o)=>{if(Array.isArray(t)){for(var{store:s}=e,l=!!s.schema&&D(s.schema,r,i,e.store.logger),d=X(n,!0),p=e.partial,u=H||!Array.isArray(n)||t.length!==n.length,v=0,y=t.length;v<y;v++){e.__internal.path.push(v);var f=Je(e,t[v],r,i,a,null!=n?n[v]:void 0,o);if(e.__internal.path.pop(),void 0===f&&!l)return void(e.partial=p);e.partial=e.partial||void 0===f&&l,d[v]=f||null,u=u||d[v]!==n[v]}return u?d:n}return null===t||null===n&&o?null:Pe(e,t,a,n||X(n))},Qe=e=>"string"==typeof e||"object"==typeof e&&"string"==typeof e.__typename,Ue=(e,t,r)=>{for(var i=t?[{fieldKey:j(t,r)}]:Oe(e),a=0,n=i.length;a<n;a++){var{fieldKey:o}=i[a];void 0!==ye(e,o)?he(e,o,void 0):ce(e,o,void 0)}},Be=(e,t)=>{var r=(e=>B.types.get(e)||re)(e);for(var i of r)t.includes(i)||Ue(i)},ze=(e,r,i,a)=>{var n=t(r.query),o=E(n),s={data:i||X(),dependencies:V},l=e.rootFields[o.operation],d=Ee(e,S(o,r.variables),M(n),l,l,a);return Ge(d,l,x(o),s.data),s},Ge=(e,t,r,i)=>{var a=e.store.rootNames[t]||"query",n=!!e.store.rootNames[t],o=n?t:i.__typename;if(!o&&t&&e.optimistic&&(o=ve(t,"__typename")),o){!n&&t&&(ce(t,"__typename",o),((e,t)=>{var r=B.types.get(e);if(r)r.add(t);else{var i=new Set;i.add(t),B.types.set(e,i)}})(o,t));for(var s,l=e.store.updates[o],d=new Te(o,t||o,!1,void 0,r,e);s=d.next();){var p=_(s),u=q(s,e.variables),v=j(p,u),y=O(s),f=i[e.optimistic?p:y];if(!("__typename"===p||void 0===f&&(qe||e.optimistic&&"query"===a))){e.__internal.path.push(y);var c=void 0;if(e.optimistic&&"mutation"===a){if(!(c=e.store.optimisticMutations[p]))continue}else e.optimistic&&"function"==typeof f&&(c=f);if(c&&(Me(e,i,o,t||o,v,p),f=Ie(c(u||{},e.store,e))),void 0!==f){if(s.selectionSet)if(t&&"query"===a){var h=P(t,v),m=Ve(e,x(s),Ie(f),h,e.optimistic?ye(t||o,v):void 0);he(t||o,v,m)}else Ve(e,x(s),Ie(f));else t&&"query"===a&&ce(t||o,v,null===f&&Se(e)?void 0:f);var g=l&&l[p];if(g)Me(e,i,o,t||o,v,p),i[p]=f,g(i,u||{},e.store,e);else if(o===e.store.rootFields.mutation&&!e.optimistic)if(f&&Array.isArray(f))for(var k=f.map((t=>e.store.keyOfEntity(t)||"")),w=0,b=f.length;w<b;w++){var N=k[w];if(N&&f[w].__typename){var K=ve(N,"__typename"),S=ne(N);K&&!S&&Be(f[w].__typename,k)}}else if(f&&"object"==typeof f){var E=e.store.keyOfEntity(f);if(E){var M=ve(E,"__typename"),A=ne(E);M&&A||!f.__typename||Be(f.__typename,[E])}}e.__internal.path.pop()}}}}},Ve=(e,t,r,i,a)=>{if(Array.isArray(r)){for(var n=new Array(r.length),o=0,s=r.length;o<s;o++){e.__internal.path.push(o);var l=i?P(i,`${o}`):void 0,d=Ve(e,t,r[o],l,null!=a?a[o]:void 0);n[o]=d,e.__internal.path.pop()}return n}if(null===r)return Se(e)?void 0:null;var p=e.store.keyOfEntity(r)||("string"==typeof a?a:null)||i;return Ge(e,p,t,r),p||null};class He{constructor(e){e||(e={}),this.logger=e.logger,this.resolvers=e.resolvers||{},this.directives=e.directives||{},this.optimisticMutations=e.optimistic||{},this.keys=e.keys||{},this.globalIDs=Array.isArray(e.globalIDs)?new Set(e.globalIDs):!!e.globalIDs;var t,r="Query",i="Mutation",a="Subscription";if(e.schema){var n=(({__schema:e})=>{var t=new Map,r=e=>{var t;return()=>{if(!t){t={};for(var r=0;r<e.length;r++)t[e[r].name]=e[r]}return t}},i=e=>{switch(e.kind){case"OBJECT":case"INTERFACE":return{name:e.name,kind:e.kind,interfaces:r(e.interfaces||[]),fields:r(e.fields.map((e=>({name:e.name,type:e.type,args:r(e.args)}))))};case"UNION":return{name:e.name,kind:e.kind,types:r(e.possibleTypes||[])}}},a={query:e.queryType?e.queryType.name:null,mutation:e.mutationType?e.mutationType.name:null,subscription:e.subscriptionType?e.subscriptionType.name:null,types:void 0,isSubType(e,r){var i=t.get(e),a=t.get(r);return!!(i&&a&&("UNION"===i.kind?i.types()[r]:"OBJECT"!==i.kind&&"OBJECT"===a.kind?a.interfaces()[e]:e===r))}};if(e.types){a.types=t;for(var n=0;n<e.types.length;n++){var o=e.types[n];if(o&&o.name){var s=i(o);s&&t.set(o.name,s)}}}return a})(e.schema);r=n.query||r,i=n.mutation||i,a=n.subscription||a,n.types&&(this.schema=n)}this.updates=e.updates||{},this.rootFields={query:r,mutation:i,subscription:a},this.rootNames={[r]:"query",[i]:"mutation",[a]:"subscription"},this.data=(t=r,{hydrating:!1,defer:!1,gc:new Set,types:new Map,persist:new Set,queryRootKey:t,refCount:new Map,links:{optimistic:new Map,base:new Map},abstractToConcreteMap:new Map,records:{optimistic:new Map,base:new Map},deferredKeys:new Set,commutativeKeys:new Set,dirtyKeys:new Set,optimisticOrder:[],storage:null})}keyOfField(e,t){return j(e,t)}keyOfEntity(e){if(Ne&&e===Ne.parent)return Ne.parentKey;if(null==e||"string"==typeof e)return e||null;if(!e.__typename)return null;if(this.rootNames[e.__typename])return e.__typename;var t=null;this.keys[e.__typename]?t=this.keys[e.__typename](e)||null:null!=e.id?t=`${e.id}`:null!=e._id&&(t=`${e._id}`);var r=e.__typename;return!0===this.globalIDs||this.globalIDs&&this.globalIDs.has(r)||!t?t:`${r}:${t}`}resolve(e,t,r){var i=this.keyOfEntity(e);if(i){var a=j(t,r),n=ve(i,a);if(void 0!==n)return n;var o=ye(i,a);return void 0!==o&&(o=De(this,o)),o}}invalidate(e,t,r){var i=this.keyOfEntity(e);!e||"string"!=typeof e||t||r||this.resolve(e,"__typename")?(m(i,"",19),Ue(i,t,r)):Be(e,[])}inspectFields(e){var t=this.keyOfEntity(e);return t?Oe(t):[]}updateQuery(e,t){var i=r(e.query,e.variables),a=t(this.readQuery(i));null!==a&&ze(this,i,a,void 0)}readQuery(e){var t=r(e.query,e.variables);return Fe(this,t,void 0,void 0).data}readFragment(e,r,i,a){return((e,t,r,i,a)=>{var n,o=M(t);if(a){if(!(n=o[a]))return null}else if(!(n=o[Object.keys(o)[0]]))return null;var s=w(n);"string"==typeof r||r.__typename||(r.__typename=s);var l=e.keyOfEntity(r);if(!l)return null;var d=Ee(e,i||{},o,s,l,void 0);return Pe(d,l,x(n),X())||null})(this,t(e),r,i,a)}writeFragment(e,r,i,a){((e,t,r,i,a)=>{var n,o=M(t);if(a){if(!(n=o[a]))return null}else if(!(n=o[Object.keys(o)[0]]))return null;var s=w(n),l={__typename:s,...r},d=e.keyOfEntity(l);if(d){var p=Ee(e,i||{},o,s,d,void 0);Ge(p,d,x(n),l)}})(this,t(e),r,i,a)}link(e,t,...r){var i=2===r.length?r[0]:null,a=2===r.length?r[1]:r[0],n=this.keyOfEntity(e);n&&he(n,j(t,i),De(this,a))}}var We=(e,t)=>i(e.kind,e,{...e.context,requestPolicy:t}),Xe=e=>({forward:r,client:a})=>{var n=new He(e);e&&e.storage&&(n.data.hydrating=!0,e.storage.readData().then((t=>{((e,t,r)=>{for(var i in Z("write",e,null),r){var a=r[i];if(void 0!==a){var{entityKey:n,fieldKey:o}=J(i);":"===a[0]?void 0===ye(n,o)&&he(n,o,JSON.parse(a.slice(1))):void 0===ve(n,o)&&ce(n,o,JSON.parse(a))}}e.storage=t,e.hydrating=!1,ee()})(n.data,e.storage,t),e.storage.onCacheHydrated&&e.storage.onCacheHydrated()})));var o=new Map,f=[],c=new Map,h=new Map,m=new Set,g=new Set,k=new Map,_=new Set,w=new Set,O=e=>{for(var t of e.values())if(m.has(t))return!0;return!1},b=(e,t)=>{if(t)for(var r of t.values()){var i=k.get(r);if(i)for(var a of i.values())e.add(a)}},x=(e,t,r)=>{for(var i of t.values())if(i!==e.key){var n=c.get(i);if(n){"query"===e.kind&&w.add(i);var o="cache-first";g.has(i)&&(g.delete(i),o="cache-and-network"),a.reexecuteOperation(We(n,o))}}if(!r){var s=_;_=w,"query"===e.kind&&_.add(e.key),(w=s).clear()}},N=e=>{var r=!1;if("query"===e.kind)me(n.data,e.key),c.set(e.key,e);else{if("teardown"===e.kind)return c.delete(e.key),h.delete(e.key),_.delete(e.key),te(n.data,e.key),e;if("mutation"===e.kind&&"network-only"!==e.context.requestPolicy){c.set(e.key,e),Z("write",n.data,e.key,!0,!1);var{dependencies:a}=ze(n,e,void 0,void 0);if(ee(),a.size){for(var s of a.values())m.add(s);o.set(e.key,a);var l=new Set;b(l,a),x(e,l,!0),r=!0}}}return i(e.kind,{key:e.key,query:t(e.query),variables:e.variables?K(E(e.query),e.variables):e.variables},{...e.context,optimistic:r})},q=(e,t)=>{for(var r of t.values()){var i=k.get(r);i||k.set(r,i=new Set),i.add(e.key)}},S=e=>{Z("read",n.data,void 0,!1,!1);var t=Fe(n,e,h.get(e.key),void 0);ee();var r=t.data?t.partial||t.hasNext?"partial":"hit":"miss";return h.set(e.key,t.data),c.set(e.key,e),q(e,t.dependencies),{outcome:r,operation:e,data:t.data,dependencies:t.dependencies,hasNext:t.hasNext}},M=(e,t)=>{var r,i=c.get(e.operation.key)||e.operation;if("mutation"===i.kind){var a=o.get(i.key);b(t,a),o.delete(i.key)}("subscription"===i.kind||e.hasNext)&&me(n.data,i.key,!0);var s=e.data;if(s){Z("write",n.data,i.key,!1,!1);var l=ze(n,i,s,e.error).dependencies;ee(),b(t,l);var d="query"===i.kind?h.get(i.key):null;Z("read",n.data,i.key,!1,d!==s);var p=Fe(n,i,d||s,e.error);ee(),s=p.data,"query"===i.kind&&(b(t,r=p.dependencies),h.set(i.key,s))}else te(n.data,i.key);return r&&q(e.operation,r),{operation:i,data:s,error:e.error,extensions:e.extensions,hasNext:e.hasNext,stale:e.stale}};return e=>{var t=s(l(S)(d((e=>"query"===e.kind&&"network-only"!==e.context.requestPolicy))(e))),i=d((e=>"query"!==e.kind||"network-only"===e.context.requestPolicy))(e),h=l((e=>e.operation))(d((e=>"miss"===e.outcome&&"cache-only"!==e.operation.context.requestPolicy&&!O(e.dependencies)&&!_.has(e.operation.key)))(t)),k=l((e=>{var t,r,{requestPolicy:i}=e.operation.context,o="cache-only"!==i&&(e.hasNext||"cache-and-network"===i||"cache-first"===i&&"partial"===e.outcome&&!_.has(e.operation.key)),s="cache-only"!==i&&(o||"partial"===e.outcome&&_.has(e.operation.key)&&((t=n.data).commutativeKeys.has(r=e.operation.key)||t.optimisticOrder.indexOf(r)>-1)),l={operation:e.operation,data:e.data,error:e.error,extensions:e.extensions,stale:s&&!e.hasNext,hasNext:o&&e.hasNext};return o&&(O(e.dependencies)?"cache-and-network"===i&&g.add(e.operation.key):a.reexecuteOperation(We(c.get(e.operation.key)||e.operation,"network-only"))),l}))(d((e=>"miss"!==e.outcome||"cache-only"===e.operation.context.requestPolicy))(t)),w=r(l(N)(p([i,h]))),b=l((e=>{var t=new Set,r=M(e,t);return x(e.operation,t,!1),r}))(d((e=>!o.has(e.operation.key)))(w)),q=u((e=>{if(f.push(e)<o.size)return v;for(var t=0;t<f.length;t++)me(n.data,f[t].operation.key);m.clear();for(var r,i=[],a=new Set;r=f.shift();)i.push(M(r,a));return x(e.operation,a,!1),y(i)}))(d((e=>o.has(e.operation.key)))(w));return p([b,q,k])}},Ye={"cache-only":0,"cache-first":1,"network-only":2,"cache-and-network":3},Ze=e=>t=>{var{storage:n}=e,o=e.isOfflineError||(e=>e&&e.networkError&&!e.response&&("undefined"!=typeof navigator&&!1===navigator.onLine||/request failed|failed to fetch|network\s?error/i.test(e.networkError.message)));if(n&&n.onOnline&&n.readMetadata&&n.writeMetadata){var{forward:l,client:u,dispatchDebug:v}=t,{source:y,next:h}=f(),m=[],g=!1,k=!1,_=()=>{if(g){for(var e=[],t=0;t<m.length;t++){var r=m[t];"mutation"===r.kind&&e.push({query:a(r.query),variables:r.variables,extensions:r.extensions})}n.writeMetadata(e)}},w=e=>{for(var t=m.length-1;t>=0;t--)m[t].key===e&&m.splice(t,1)},O=()=>{if(!k){var e=new Set;k=!0;for(var t=0;t<m.length;t++){var r=m[t];if("mutation"===r.kind||!e.has(r.key))if(e.add(r.key),"subscription"!==r.kind){h(i("teardown",r));for(var a="cache-first",n=0;n<m.length;n++){var{requestPolicy:o}=m[n].context;Ye[o]>Ye[a]&&(a=o)}h(We(r,a))}else h(We(r,"cache-first"))}k=!1,m.length=0,_()}},b=Xe({...e,storage:{...n,readData(){var e=n.readData();return{async then(t){for(var i=await n.readMetadata(),a=0;i&&a<i.length;a++)m.push(u.createRequestOperation("mutation",r(i[a].query,i[a].variables),i[a].extensions));t(await e),n.onOnline(O),g=!0,O()}}}}})({client:u,dispatchDebug:v,forward:e=>s(d((e=>!(g&&"mutation"===e.operation.kind&&e.operation.context.optimistic&&o(e.error,e)&&(m.push(e.operation),_(),1))))(l(e)))});return e=>{var t=p([y,c((e=>{"query"!==e.kind||g?"teardown"===e.kind&&w(e.key):m.push(e)}))(e)]);return d((e=>{if("query"===e.operation.kind){if(o(e.error,e))return h(We(e.operation,"cache-only")),m.push(e.operation),!1;g||w(e.operation.key)}return!0}))(b(t))}}return Xe(e)(t)};export{He as Store,Xe as cacheExchange,Ze as offlineExchange};
//# sourceMappingURL=urql-exchange-graphcache.min.mjs.map
