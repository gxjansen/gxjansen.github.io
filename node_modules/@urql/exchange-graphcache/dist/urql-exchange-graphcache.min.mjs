import{stringifyVariables as e,formatDocument as r,createRequest as t,makeOperation as i,stringifyDocument as a}from"@urql/core";import{Kind as n,valueFromASTUntyped as o}from"@0no-co/graphql.web";import{share as s,map as l,filter as d,merge as u,mergeMap as v,empty as p,fromArray as y,makeSubject as f,onPush as c}from"wonka";var h="\nhttps://bit.ly/2XbVrpR#";function m(e,r,t){if(!e){var i=new Error((r||"Minfied Error #"+t+"\n")+h+t);throw i.name="Graphcache Error",i}}new Set;var g={},k=e=>e._directives||g,_=e=>e.name.value,O=e=>e.typeCondition.name.value,w=e=>e.alias?e.alias.value:e.name.value,b=[],N=e=>e.selectionSet?e.selectionSet.selections:b,q=e=>e.typeCondition?e.typeCondition.name.value:null,x=(e,r)=>{var t=null;if(e.arguments)for(var i=0,a=e.arguments.length;i<a;i++){var n=e.arguments[i],s=o(n.value,r);null!=s&&(t||(t={}),t[_(n)]=s)}return t},K=(e,r)=>{if(r&&e.variableDefinitions){for(var t={},i=0,a=e.variableDefinitions.length;i<a;i++){var n=_(e.variableDefinitions[i].variable);t[n]=r[n]}return t}},E=(e,r)=>{var t={};if(!r)return t;if(e.variableDefinitions)for(var i=0,a=e.variableDefinitions.length;i<a;i++){var n=e.variableDefinitions[i],s=_(n.variable);t[s]=void 0===r[s]&&n.defaultValue?o(n.defaultValue,r):r[s]}for(var l in r)l in t||(t[l]=r[l]);return t};function S(e){for(var r=0;r<e.definitions.length;r++)if(e.definitions[r].kind===n.OPERATION_DEFINITION)return e.definitions[r];m(!1,"",1)}var M=e=>{for(var r={},t=0;t<e.definitions.length;t++){var i=e.definitions[t];i.kind===n.FRAGMENT_DEFINITION&&(r[_(i)]=i)}return r},T=(e,r)=>{var t=k(e);if(t.include||t.skip)for(var i in t){var a=t[i];if(a&&("include"===i||"skip"===i)&&a.arguments&&a.arguments[0]&&"if"===_(a.arguments[0])){var n=o(a.arguments[0].value,r);return"include"===i?!!n:!n}}return!0},A=(e,r)=>{var{defer:t}=k(e);if(t){for(var i of t.arguments||[])if("if"===_(i))return!!o(i.value,r);return!0}return!1},I=e=>{var{optional:r,required:t}=k(e);return!t&&(!!r||void 0)},D=(e,r,t,i)=>{var a=L(e,r,t,i);return!!a&&"NON_NULL"!==a.type.kind},F=(e,r,t,i)=>{var a=L(e,r,t,i);if(!a)return!1;var n="NON_NULL"===a.type.kind?a.type.ofType:a.type;return"LIST"===n.kind&&"NON_NULL"!==n.ofType.kind},C=(e,r,t)=>{if(!t)return!1;var i=q(r);return!i||t===i||(e.types.has(i)&&"OBJECT"===e.types.get(i).kind?i===t:(function(e,r){m(e.types.has(r)&&("INTERFACE"===e.types.get(r).kind||"UNION"===e.types.get(r).kind),"",5)}(e,i),$(e,t),e.isSubType(i,t)))},L=(e,r,t,i)=>{if(0!==t.indexOf("__")&&0!==r.indexOf("__"))return $(e,r),e.types.get(r).fields()[t]};function $(e,r){m(e.types.has(r)&&"OBJECT"===e.types.get(r).kind,"",3)}var P=(r,t)=>t?`${r}(${e(t)})`:r,R=(e,r)=>`${e}.${r}`,j=e=>{var r=e.indexOf("(");return r>-1?{fieldKey:e,fieldName:e.slice(0,r),arguments:JSON.parse(e.slice(r+1,-1))}:{fieldKey:e,fieldName:e,arguments:null}},J=e=>{var r=e.indexOf(".");return{entityKey:e.slice(0,r).replace(/%2e/g,"."),fieldKey:e.slice(r+1)}},Q=null,B=null,U=null,G=null,V=null,z=null,H=!1,W=!1;function X(e,r){var t;if(e){if(Q.has(e))return e;t=B.get(e)}return null==t&&(t=r?[]:{}),e&&B.set(e,t),Q.add(t),t}var Y=e=>!!e&&Q.has(e),Z=(e,r,t,i,a)=>{Q=new WeakSet,B=new WeakMap,V=e,U=r,z=new Set,W=!!i,H=!!a,t?"read"===V?G=t:i||r.hydrating||r.optimisticOrder.length>1?(i||r.commutativeKeys.has(t)?i&&(-1===r.optimisticOrder.indexOf(t)||r.commutativeKeys.has(t)||r.optimisticOrder.splice(r.optimisticOrder.indexOf(t),1),r.commutativeKeys.delete(t)):ce(r,t),G=t,he(r,t)):(G=null,ge(r,t)):G=null},ee=()=>{var e=U,r=G;if(W=!1,G=null,!e.hydrating&&r&&e.optimisticOrder.indexOf(r)>-1)for(var t=e.optimisticOrder.length;--t>=0&&e.dirtyKeys.has(e.optimisticOrder[t])&&e.commutativeKeys.has(e.optimisticOrder[t]);)ke(e.optimisticOrder[t]);Q=null,B=null,V=null,U=null,z=null,e.defer||!e.storage&&e.optimisticOrder.length||(e.defer=!0,setTimeout((()=>{Z("read",e,null),le(),Oe(),ee(),e.defer=!1})))},re=(e,r,t)=>{r&&!t&&e.deferredKeys.delete(r),Z("write",e,r,t),ee()},te=new Set,ie=(e,r,t,i)=>{var a=G?e.optimistic.get(G):e.base,n=a.get(r);void 0===n&&a.set(r,n=Object.create(null)),void 0!==i||G?n[t]=i:delete n[t]},ae=(e,r,t)=>{for(var i,a=!W&&"read"===V&&G&&U.commutativeKeys.has(G),n=0,o=U.optimisticOrder.length;n<o;n++){var s=U.optimisticOrder[n],l=e.optimistic.get(s);if(a=a&&s!==G,l&&(!a||!U.commutativeKeys.has(s))&&(!W||"write"===V||U.commutativeKeys.has(s))&&void 0!==(i=l.get(r))&&t in i)return i[t]}return void 0!==(i=e.base.get(r))?i[t]:void 0},ne=(e,r)=>{if(Array.isArray(e))for(var t=0,i=e.length;t<i;t++)ne(e[t],r);else"string"==typeof e&&((e,r)=>{var t=U.refCount.get(e)||0,i=t+r>0?t+r:0;U.refCount.set(e,i),i?!t&&i&&U.gc.delete(e):U.gc.add(e)})(e,r)},oe=(e,r,t)=>{if(void 0!==t)for(var i in t)r.has(i)||(e.push(j(i)),r.add(i))},se=(e,r,t,i)=>{oe(e,r,i.base.get(t));for(var a=0,n=U.optimisticOrder.length;a<n;a++){var o=i.optimistic.get(U.optimisticOrder[a]);void 0!==o&&oe(e,r,o.get(t))}},le=()=>{if(!U.optimisticOrder.length)for(var e of U.gc.keys())if(U.gc.delete(e),!((U.refCount.get(e)||0)>0)){var r=U.records.base.get(e);U.refCount.delete(e),U.records.base.delete(e);var t=r&&r.__typename;if(t){var i=U.types.get(t);i&&i.delete(e)}var a=U.links.base.get(e);if(a)for(var n in U.links.base.delete(e),a)ne(a[n],-1)}},de=(e,r)=>{e!==U.queryRootKey?z.add(e):void 0!==r&&"__typename"!==r&&z.add(R(e,r))},ue=(e,r)=>{!W&&U.storage&&U.persist.add(((e,r)=>`${e.replace(/\./g,"%2e")}.${r}`)(e,r))},ve=(e,r)=>(de(e,r),ae(U.records,e,r)),pe=(e,r)=>(de(e,r),ae(U.links,e,r)),ye=(e,r,t)=>{de(e,r),ue(e,r),ie(U.records,e,r,t)},fe=(e,r,t)=>{var i=G?U.links.optimistic.get(G):U.links.base;if(!G){var a=i&&i.get(e);ne(a&&a[r],-1),ne(t,1)}de(e,r),ue(e,r),ie(U.links,e,r,t)},ce=(e,r,t)=>{var i=e.optimisticOrder.indexOf(r);if(i>-1&&e.optimisticOrder.splice(i,1),t)for(e.deferredKeys.add(r),i=i>-1?i:0;i<e.optimisticOrder.length&&!e.deferredKeys.has(e.optimisticOrder[i])&&(!e.dirtyKeys.has(e.optimisticOrder[i])||!e.commutativeKeys.has(e.optimisticOrder[i]));i++);else e.deferredKeys.delete(r),i>-1&&!e.commutativeKeys.has(r)&&me(e,r),i=0;e.optimisticOrder.splice(i,0,r),e.commutativeKeys.add(r)},he=(e,r)=>{-1===e.optimisticOrder.indexOf(r)&&e.optimisticOrder.unshift(r),e.dirtyKeys.has(r)||(e.dirtyKeys.add(r),e.links.optimistic.set(r,new Map),e.records.optimistic.set(r,new Map))},me=(e,r)=>{e.dirtyKeys.has(r)&&(e.dirtyKeys.delete(r),e.records.optimistic.delete(r),e.links.optimistic.delete(r),e.deferredKeys.delete(r))},ge=(e,r)=>{var t=e.optimisticOrder.indexOf(r);t>-1&&(e.optimisticOrder.splice(t,1),e.commutativeKeys.delete(r)),me(e,r)},ke=e=>{var r=z;z=new Set,V="write";var t=U.links.optimistic.get(e);if(t)for(var i of t.entries()){var a=i[0],n=i[1];for(var o in n)fe(a,o,n[o])}var s=U.records.optimistic.get(e);if(s)for(var l of s.entries()){var d=l[0],u=l[1];for(var v in u)ye(d,v,u[v])}z=r,ge(U,e)},_e=e=>{var{links:r,records:t}=U,i=[],a=new Set;return de(e),se(i,a,e,r),se(i,a,e,t),i},Oe=()=>{if(U.storage){W=!0,V="read";var r={};for(var t of U.persist.keys()){var{entityKey:i,fieldKey:a}=J(t),n=void 0;r[t]=void 0!==(n=pe(i,a))?`:${e(n)}`:void 0!==(n=ve(i,a))?e(n):void 0}W=!1,U.storage.writeData(r),U.persist.clear()}},we=null,be=!1,Ne=void 0,qe=e=>e.__internal.path.length>0&&e.__internal.errorMap?e.__internal.errorMap[e.__internal.path.join(".")]:void 0,xe=(e,r,t,i,a,n)=>{var o={store:e,variables:r,fragments:t,parent:{__typename:i},parentTypeName:i,parentKey:a,parentFieldKey:"",fieldName:"",error:void 0,partial:!1,hasNext:!1,optimistic:W,__internal:{path:[],errorMap:void 0}};if(n&&n.graphQLErrors)for(var s=0;s<n.graphQLErrors.length;s++){var l=n.graphQLErrors[s];l.path&&l.path.length&&(o.__internal.errorMap||(o.__internal.errorMap=Object.create(null)),o.__internal.errorMap[l.path.join(".")]=l)}return o},Ke=(e,r,t,i,a,n)=>{we=e,e.parent=r,e.parentTypeName=t,e.parentKey=i,e.parentFieldKey=a,e.fieldName=n,e.error=qe(e)},Ee=(e,r,t,i,a)=>{if(!r)return!1;var o=q(e);return!o||r===o||"write"===V||!N(e).some((e=>{if(e.kind!==n.FIELD)return!1;var r=P(_(e),x(e,i));return!((e,r)=>void 0!==ve(e,r)||void 0!==pe(e,r))(t,r)}))};function Se(e,r,t,i,a,o){var s,l=0;return function(){for(var d;s||l<a.length;)if(d=void 0,be=t,Ne=i,s){if(d=s())return d;s=void 0}else{var u=a[l++];if(T(u,o.variables))if(u.kind!==n.FIELD){var v=u.kind!==n.INLINE_FRAGMENT?o.fragments[_(u)]:u;if(v&&(!v.typeCondition||(o.store.schema?C(o.store.schema,v,e):Ee(v,e,r,o.variables)))){var p=I(u);s=Se(e,r,t||A(u,o.variables),void 0!==p?p:i,N(v),o)}}else if("write"===V||!u._generated)return u}}}var Me=e=>null==e?null:e,Te=(e,r)=>{if(!r)return r||null;if(Array.isArray(r)){for(var t=new Array(r.length),i=0,a=t.length;i<a;i++)t[i]=Te(e,r[i]);return t}return e.keyOfEntity(r)},Ae=(e,t,i,a)=>{var n=r(t.query),o=S(n),s=e.rootFields[o.operation],l=N(o),d=xe(e,E(o,t.variables),M(n),s,s,a),u=s!==d.store.rootFields.query?Ie(d,s,l,i||X()):Ce(d,s,l,i||X());return{dependencies:z,partial:d.partial||!u,hasNext:d.hasNext,data:u||null}},Ie=(e,r,t,i)=>{if("string"!=typeof(e.store.rootNames[r]?r:i.__typename))return i;for(var a,n=Se(r,r,!1,void 0,t,e),o=H,s=X(i);a=n();){var l,d=w(a),u=i[d];e.__internal.path.push(d),l=a.selectionSet&&null!==u?De(e,N(a),Me(u)):u,o=o||l!==u,void 0!==l&&(s[d]=l),e.__internal.path.pop()}return o?s:i},De=(e,r,t)=>{if(Array.isArray(t)){for(var i=new Array(t.length),a=H,n=0,o=t.length;n<o;n++)e.__internal.path.push(n),i[n]=De(e,r,t[n]),a=a||i[n]!==t[n],e.__internal.path.pop();return a?i:t}if(null===t)return null;var s=e.store.keyOfEntity(t);return null!==s?Ce(e,s,r,t)||null:Ie(e,t.__typename,r,t)};function Fe(e,r,t,i){var a=i.store.resolvers[r],n=a&&a[t];for(var o in e){var s=e[o];if(s&&"include"!==o&&"skip"!==o&&i.store.directives[o])return i.store.directives[o](x(s,i.variables))}return n}var Ce=(e,r,t,i,a)=>{var{store:n}=e,o=r===n.rootFields.query,s=a&&n.keyOfEntity(a)||r,l=o?r:ve(s,"__typename")||a&&a.__typename;if("string"==typeof l&&(!a||l===a.__typename)){for(var d,u=Se(l,s,!1,void 0,t,e),v=!1,p=!1,y=H,f=e.partial,c=X(i);void 0!==(d=u());){var h=_(d),m=x(d,e.variables),g=w(d),O=k(d),b=Fe(O,l,h,e),q=P(h,m),K=R(s,q),E=ve(s,q),S=a?a[h]:void 0;e.__internal.path.push(g);var M=void 0;if("__typename"===h)M=l;else if(void 0!==S&&void 0===d.selectionSet)M=S;else if("read"===V&&b){var T=c;if(void 0===d.selectionSet&&void 0!==E&&(T={...c,[g]:E,[h]:E}),Ke(e,T,l,s,q,h),M=b(T,m||{},n,e),d.selectionSet&&(M=Le(e,l,h,K,N(d),void 0!==c[g]?c[g]:i[g],M,Y(i))),n.schema&&null===M&&!D(n.schema,l,h,e.store.logger))return}else if(d.selectionSet)if(void 0!==S)M=Le(e,l,h,K,N(d),void 0!==c[g]?c[g]:i[g],S,Y(i));else{var A=pe(s,q);void 0!==A?M=$e(e,A,l,h,N(d),void 0!==c[g]?c[g]:i[g],Y(i)):"object"==typeof E&&null!==E&&(M=E)}else M=E;if(!be&&void 0===M&&(O.optional||Ne&&!O.required||qe(e)||n.schema&&D(n.schema,l,h,e.store.logger))?(e.partial=!0,M=null):null!==M||!O.required&&!1!==Ne?v=v||"__typename"!==h:M=void 0,e.__internal.path.pop(),y=y||M!==i[g],void 0!==M)c[g]=M;else{if(!be)return void(e.partial=f);p=!0}}return e.partial=e.partial||f,e.hasNext=e.hasNext||p,o&&e.partial&&!v?void 0:y?c:i}},Le=(e,r,t,i,a,n,o,s)=>{if(Array.isArray(o)){for(var{store:l}=e,d=!!l.schema&&F(l.schema,r,t,e.store.logger),u=e.partial,v=X(n,!0),p=H||!Array.isArray(n)||o.length!==n.length,y=0,f=o.length;y<f;y++){e.__internal.path.push(y);var c=Le(e,r,t,R(i,`${y}`),a,null!=n?n[y]:void 0,o[y],s);if(e.__internal.path.pop(),void 0===c&&!d)return void(e.partial=u);e.partial=e.partial||void 0===c&&d,v[y]=null!=c?c:null,p=p||v[y]!==n[y]}return p?v:n}if(null==o)return o;if(s&&null===n)return null;if(Pe(o)){var h=n||X(n);return"string"==typeof o?Ce(e,o,a,h):Ce(e,i,a,h,o)}},$e=(e,r,t,i,a,n,o)=>{if(Array.isArray(r)){for(var{store:s}=e,l=!!s.schema&&F(s.schema,t,i,e.store.logger),d=X(n,!0),u=e.partial,v=H||!Array.isArray(n)||r.length!==n.length,p=0,y=r.length;p<y;p++){e.__internal.path.push(p);var f=$e(e,r[p],t,i,a,null!=n?n[p]:void 0,o);if(e.__internal.path.pop(),void 0===f&&!l)return void(e.partial=u);e.partial=e.partial||void 0===f&&l,d[p]=f||null,v=v||d[p]!==n[p]}return v?d:n}return null===r||null===n&&o?null:Ce(e,r,a,n||X(n))},Pe=e=>"string"==typeof e||"object"==typeof e&&"string"==typeof e.__typename,Re=(e,t,i,a)=>{var n=r(t.query),o=S(n),s={data:i||X(),dependencies:z},l=e.rootFields[o.operation],d=xe(e,E(o,t.variables),M(n),l,l,a);return je(d,l,N(o),s.data),s},je=(e,r,t,i)=>{var a=e.store.rootNames[r]||"query",n=!!e.store.rootNames[r],o=n?r:i.__typename;if(!o&&r&&e.optimistic&&(o=ve(r,"__typename")),o){!n&&r&&(ye(r,"__typename",o),((e,r)=>{var t=U.types.get(e);if(t)t.add(r);else{var i=new Set;i.add(r),U.types.set(e,i)}})(o,r));for(var s,l=e.store.updates[o],d=Se(o,r||o,!1,void 0,t,e);s=d();){var u=_(s),v=x(s,e.variables),p=P(u,v),y=w(s),f=i[e.optimistic?u:y];if(!("__typename"===u||void 0===f&&(be||e.optimistic&&"query"===a))){e.__internal.path.push(y);var c=void 0;if(e.optimistic&&"mutation"===a){if(!(c=e.store.optimisticMutations[u]))continue}else e.optimistic&&"function"==typeof f&&(c=f);if(c&&(Ke(e,i,o,r||o,p,u),f=Me(c(v||{},e.store,e))),void 0!==f){if(s.selectionSet)if(r&&"query"===a){var h=R(r,p),m=Je(e,N(s),Me(f),h,e.optimistic?pe(r||o,p):void 0);fe(r||o,p,m)}else Je(e,N(s),Me(f));else r&&"query"===a&&ye(r||o,p,null===f&&qe(e)?void 0:f);var g=l&&l[u];g&&(Ke(e,i,o,r||o,p,u),i[u]=f,g(i,v||{},e.store,e)),e.__internal.path.pop()}}}}},Je=(e,r,t,i,a)=>{if(Array.isArray(t)){for(var n=new Array(t.length),o=0,s=t.length;o<s;o++){e.__internal.path.push(o);var l=i?R(i,`${o}`):void 0,d=Je(e,r,t[o],l,null!=a?a[o]:void 0);n[o]=d,e.__internal.path.pop()}return n}if(null===t)return qe(e)?void 0:null;var u=e.store.keyOfEntity(t)||("string"==typeof a?a:null)||i;return je(e,u,r,t),u||null},Qe=(e,r,t)=>{for(var i=r?[{fieldKey:P(r,t)}]:_e(e),a=0,n=i.length;a<n;a++){var{fieldKey:o}=i[a];void 0!==pe(e,o)?fe(e,o,void 0):ye(e,o,void 0)}};class Be{constructor(e){e||(e={}),this.logger=e.logger,this.resolvers=e.resolvers||{},this.directives=e.directives||{},this.optimisticMutations=e.optimistic||{},this.keys=e.keys||{},this.globalIDs=Array.isArray(e.globalIDs)?new Set(e.globalIDs):!!e.globalIDs;var r,t="Query",i="Mutation",a="Subscription";if(e.schema){var n=(({__schema:e})=>{var r=new Map,t=e=>{var r;return()=>{if(!r){r={};for(var t=0;t<e.length;t++)r[e[t].name]=e[t]}return r}},i=e=>{switch(e.kind){case"OBJECT":case"INTERFACE":return{name:e.name,kind:e.kind,interfaces:t(e.interfaces||[]),fields:t(e.fields.map((e=>({name:e.name,type:e.type,args:t(e.args)}))))};case"UNION":return{name:e.name,kind:e.kind,types:t(e.possibleTypes||[])}}},a={query:e.queryType?e.queryType.name:null,mutation:e.mutationType?e.mutationType.name:null,subscription:e.subscriptionType?e.subscriptionType.name:null,types:void 0,isSubType(e,t){var i=r.get(e),a=r.get(t);return!!(i&&a&&("UNION"===i.kind?i.types()[t]:"OBJECT"!==i.kind&&"OBJECT"===a.kind?a.interfaces()[e]:e===t))}};if(e.types){a.types=r;for(var n=0;n<e.types.length;n++){var o=e.types[n];if(o&&o.name){var s=i(o);s&&r.set(o.name,s)}}}return a})(e.schema);t=n.query||t,i=n.mutation||i,a=n.subscription||a,n.types&&(this.schema=n)}this.updates=e.updates||{},this.rootFields={query:t,mutation:i,subscription:a},this.rootNames={[t]:"query",[i]:"mutation",[a]:"subscription"},this.data=(r=t,{hydrating:!1,defer:!1,gc:new Set,types:new Map,persist:new Set,queryRootKey:r,refCount:new Map,links:{optimistic:new Map,base:new Map},records:{optimistic:new Map,base:new Map},deferredKeys:new Set,commutativeKeys:new Set,dirtyKeys:new Set,optimisticOrder:[],storage:null})}keyOfField(e,r){return P(e,r)}keyOfEntity(e){if(we&&e===we.parent)return we.parentKey;if(null==e||"string"==typeof e)return e||null;if(!e.__typename)return null;if(this.rootNames[e.__typename])return e.__typename;var r=null;this.keys[e.__typename]?r=this.keys[e.__typename](e)||null:null!=e.id?r=`${e.id}`:null!=e._id&&(r=`${e._id}`);var t=e.__typename;return!0===this.globalIDs||this.globalIDs&&this.globalIDs.has(t)||!r?r:`${t}:${r}`}resolve(e,r,t){var i=this.keyOfEntity(e);if(i){var a=P(r,t),n=ve(i,a);if(void 0!==n)return n;var o=pe(i,a);return void 0!==o&&(o=Te(this,o)),o}}resolveFieldByKey(e,r,t){return this.resolve(e,r,t)}invalidate(e,r,t){var i=this.keyOfEntity(e);!e||"string"!=typeof e||r||t||this.resolve(e,"__typename")?(m(i,"",19),Qe(i,r,t)):(e=>{var r=(e=>U.types.get(e)||te)(e);for(var t of r)Qe(t)})(e)}inspectFields(e){var r=this.keyOfEntity(e);return r?_e(r):[]}updateQuery(e,r){var i=t(e.query,e.variables),a=r(this.readQuery(i));null!==a&&Re(this,i,a,void 0)}readQuery(e){var r=t(e.query,e.variables);return Ae(this,r,void 0,void 0).data}readFragment(e,t,i,a){return((e,r,t,i,a)=>{var n,o=M(r);if(a){if(!(n=o[a]))return null}else if(!(n=o[Object.keys(o)[0]]))return null;var s=O(n);"string"==typeof t||t.__typename||(t.__typename=s);var l=e.keyOfEntity(t);if(!l)return null;var d=xe(e,i||{},o,s,l,void 0);return Ce(d,l,N(n),X())||null})(this,r(e),t,i,a)}writeFragment(e,t,i,a){((e,r,t,i,a)=>{var n,o=M(r);if(a){if(!(n=o[a]))return null}else if(!(n=o[Object.keys(o)[0]]))return null;var s=O(n),l={__typename:s,...t},d=e.keyOfEntity(l);if(d){var u=xe(e,i||{},o,s,d,void 0);je(u,d,N(n),l)}})(this,r(e),t,i,a)}link(e,r,...t){var i=2===t.length?t[0]:null,a=2===t.length?t[1]:t[0],n=this.keyOfEntity(e);n&&fe(n,P(r,i),Te(this,a))}}var Ue=(e,r)=>i(e.kind,e,{...e.context,requestPolicy:r}),Ge=e=>({forward:t,client:a})=>{var n=new Be(e);e&&e.storage&&(n.data.hydrating=!0,e.storage.readData().then((r=>{((e,r,t)=>{for(var i in Z("write",e,null),t){var a=t[i];if(void 0!==a){var{entityKey:n,fieldKey:o}=J(i);":"===a[0]?void 0===pe(n,o)&&fe(n,o,JSON.parse(a.slice(1))):void 0===ve(n,o)&&ye(n,o,JSON.parse(a))}}e.storage=r,e.hydrating=!1,ee()})(n.data,e.storage,r),e.storage.onCacheHydrated&&e.storage.onCacheHydrated()})));var o=new Map,f=[],c=new Map,h=new Map,m=new Set,g=new Set,k=new Map,_=new Set,O=new Set,w=e=>{for(var r of e.values())if(m.has(r))return!0;return!1},b=(e,r)=>{if(r)for(var t of r.values()){var i=k.get(t);if(i)for(var a of i.values())e.add(a)}},N=(e,r,t)=>{for(var i of r.values())if(i!==e.key){var n=c.get(i);if(n){"query"===e.kind&&O.add(i);var o="cache-first";g.has(i)&&(g.delete(i),o="cache-and-network"),a.reexecuteOperation(Ue(n,o))}}if(!t){var s=_;"query"===e.kind&&(_=O).add(e.key),(O=s).clear()}},q=e=>{var t=!1;if("query"===e.kind)ce(n.data,e.key),c.set(e.key,e);else{if("teardown"===e.kind)return c.delete(e.key),h.delete(e.key),_.delete(e.key),re(n.data,e.key),e;if("mutation"===e.kind&&"network-only"!==e.context.requestPolicy){c.set(e.key,e),Z("write",n.data,e.key,!0,!1);var{dependencies:a}=Re(n,e,void 0,void 0);if(ee(),a.size){for(var s of a.values())m.add(s);o.set(e.key,a);var l=new Set;b(l,a),N(e,l,!0),t=!0}}}return i(e.kind,{key:e.key,query:r(e.query),variables:e.variables?K(S(e.query),e.variables):e.variables},{...e.context,optimistic:t})},x=(e,r)=>{for(var t of r.values()){var i=k.get(t);i||k.set(t,i=new Set),i.add(e.key)}},E=e=>{Z("read",n.data,void 0,!1,!1);var r=Ae(n,e,h.get(e.key),void 0);ee();var t=r.data?r.partial||r.hasNext?"partial":"hit":"miss";return h.set(e.key,r.data),c.set(e.key,e),x(e,r.dependencies),{outcome:t,operation:e,data:r.data,dependencies:r.dependencies,hasNext:r.hasNext}},M=(e,r)=>{var t,i=c.get(e.operation.key)||e.operation;if("mutation"===i.kind){var a=o.get(i.key);b(r,a),o.delete(i.key)}("subscription"===i.kind||e.hasNext)&&ce(n.data,i.key,!0);var s=e.data;if(s){Z("write",n.data,i.key,!1,!1);var l=Re(n,i,s,e.error).dependencies;ee(),b(r,l);var d="query"===i.kind?h.get(i.key):null;Z("read",n.data,i.key,!1,d!==s);var u=Ae(n,i,d||s,e.error);ee(),s=u.data,"query"===i.kind&&(b(r,t=u.dependencies),h.set(i.key,s))}else re(n.data,i.key);return t&&x(e.operation,t),{operation:i,data:s,error:e.error,extensions:e.extensions,hasNext:e.hasNext,stale:e.stale}};return e=>{var r=s(l(E)(d((e=>"query"===e.kind&&"network-only"!==e.context.requestPolicy))(e))),i=d((e=>"query"!==e.kind||"network-only"===e.context.requestPolicy))(e),h=l((e=>e.operation))(d((e=>"miss"===e.outcome&&"cache-only"!==e.operation.context.requestPolicy&&!w(e.dependencies)&&!_.has(e.operation.key)))(r)),k=l((e=>{var r,t,{requestPolicy:i}=e.operation.context,o="cache-only"!==i&&(e.hasNext||"cache-and-network"===i||"cache-first"===i&&"partial"===e.outcome&&!_.has(e.operation.key)),s="cache-only"!==i&&(o||"partial"===e.outcome&&_.has(e.operation.key)&&((r=n.data).commutativeKeys.has(t=e.operation.key)||r.optimisticOrder.indexOf(t)>-1)),l={operation:e.operation,data:e.data,error:e.error,extensions:e.extensions,stale:s&&!e.hasNext,hasNext:o&&e.hasNext};return o&&(w(e.dependencies)?"cache-and-network"===i&&g.add(e.operation.key):a.reexecuteOperation(Ue(c.get(e.operation.key)||e.operation,"network-only"))),l}))(d((e=>"miss"!==e.outcome||"cache-only"===e.operation.context.requestPolicy))(r)),O=t(l(q)(u([i,h]))),b=l((e=>{var r=new Set,t=M(e,r);return N(e.operation,r,!1),t}))(d((e=>!o.has(e.operation.key)))(O)),x=v((e=>{if(f.push(e)<o.size)return p;for(var r=0;r<f.length;r++)ce(n.data,f[r].operation.key);m.clear();for(var t,i=[],a=new Set;t=f.shift();)i.push(M(t,a));return N(e.operation,a,!1),y(i)}))(d((e=>o.has(e.operation.key)))(O));return u([b,x,k])}},Ve={"cache-only":0,"cache-first":1,"network-only":2,"cache-and-network":3},ze=e=>r=>{var{storage:n}=e,o=e.isOfflineError||(e=>e&&e.networkError&&!e.response&&("undefined"!=typeof navigator&&!1===navigator.onLine||/request failed|failed to fetch|network\s?error/i.test(e.networkError.message)));if(n&&n.onOnline&&n.readMetadata&&n.writeMetadata){var{forward:l,client:v,dispatchDebug:p}=r,{source:y,next:h}=f(),m=[],g=!1,k=!1,_=()=>{if(g){for(var e=[],r=0;r<m.length;r++){var t=m[r];"mutation"===t.kind&&e.push({query:a(t.query),variables:t.variables,extensions:t.extensions})}n.writeMetadata(e)}},O=e=>{for(var r=m.length-1;r>=0;r--)m[r].key===e&&m.splice(r,1)},w=()=>{if(!k){var e=new Set;k=!0;for(var r=0;r<m.length;r++){var t=m[r];if("mutation"===t.kind||!e.has(t.key))if(e.add(t.key),"subscription"!==t.kind){h(i("teardown",t));for(var a="cache-first",n=0;n<m.length;n++){var{requestPolicy:o}=m[n].context;Ve[o]>Ve[a]&&(a=o)}h(Ue(t,a))}else h(Ue(t,"cache-first"))}k=!1,m.length=0,_()}},b=Ge({...e,storage:{...n,readData(){var e=n.readData();return{async then(r){for(var i=await n.readMetadata(),a=0;i&&a<i.length;a++)m.push(v.createRequestOperation("mutation",t(i[a].query,i[a].variables),i[a].extensions));r(await e),n.onOnline(w),g=!0,w()}}}}})({client:v,dispatchDebug:p,forward:e=>s(d((e=>!(g&&"mutation"===e.operation.kind&&e.operation.context.optimistic&&o(e.error,e)&&(m.push(e.operation),_(),1))))(l(e)))});return e=>{var r=u([y,c((e=>{"query"!==e.kind||g?"teardown"===e.kind&&O(e.key):m.push(e)}))(e)]);return d((e=>{if("query"===e.operation.kind){if(o(e.error,e))return h(Ue(e.operation,"cache-only")),m.push(e.operation),!1;g||O(e.operation.key)}return!0}))(b(r))}}return Ge(e)(r)};export{Be as Store,Ge as cacheExchange,ze as offlineExchange};
//# sourceMappingURL=urql-exchange-graphcache.min.mjs.map
