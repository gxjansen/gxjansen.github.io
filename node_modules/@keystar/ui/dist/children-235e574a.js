import { useLayoutEffect } from '@react-aria/utils';
import { useState, isValidElement, cloneElement } from 'react';

// TODO: replace instances of this with CSS `:has()` when it's supported
// https://developer.mozilla.org/en-US/docs/Web/CSS/:has
// https://caniuse.com/#feat=css-has
// https://bugzilla.mozilla.org/show_bug.cgi?id=418039
function useHasChild(query, ref) {
  let [hasChild, setHasChild] = useState(true);
  useLayoutEffect(() => {
    setHasChild(!!(ref.current && ref.current.querySelector(query)));
  }, [setHasChild, query, ref]);
  return hasChild;
}

/**
 * Clone a React element, with optional props. If the value is
 * not a valid React element, return null.
 */
function cloneValidElement(child, props) {
  if (! /*#__PURE__*/isValidElement(child)) {
    return null;
  }
  return /*#__PURE__*/cloneElement(child, props);
}

export { cloneValidElement as c, useHasChild as u };
