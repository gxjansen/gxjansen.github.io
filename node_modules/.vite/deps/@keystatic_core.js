import {
  integer
} from "./chunk-7MMF5JLS.js";
import {
  $c1d7fb2ec91bae71$export$6d08773d2e66f8f2,
  ArrayFieldListView,
  BlockWrapper$1,
  Checkbox,
  FormValueContentFromPreviewProps,
  ImageFieldInput,
  MenuTrigger,
  ToolbarSeparator,
  _ActionBar,
  _ActionBarContainer,
  _Combobox,
  _ListView,
  _Menu,
  _Picker,
  clientSideValidateProp,
  collection,
  config,
  createGetPreviewProps,
  decimal_default,
  document$1,
  filter,
  getInitialPropsValue,
  getSrcPrefix,
  getUploadedFile,
  isValidURL$1,
  l10nMessages,
  markdoc,
  mdx,
  move,
  refreshCwIcon,
  require_dist,
  require_escape_string_regexp,
  require_lib,
  require_slugify,
  singleton,
  useArrayFieldValidationMessage,
  useFieldContext,
  useIsInDocumentEditor,
  useObjectURL,
  useSlugsInCollection,
  valueToUpdater
} from "./chunk-HZLEPBOR.js";
import {
  $2baaea4c71418dea$export$294aa081a6c6f55d,
  $fca6afa0e843324b$export$f12b703ca79dfbb1,
  ActionButton,
  Box,
  Button,
  ButtonGroup,
  ClearButton,
  Content,
  Dialog,
  DialogContainer,
  FieldDataError,
  FieldLabel,
  FieldMessage,
  Flex,
  Heading,
  Icon,
  ImageDimensionsInput,
  NotEditable,
  NumberField,
  PathContext,
  ProgressCircle,
  SlugFieldContext,
  Text,
  TextArea,
  TextField,
  TextLink,
  UploadImageButton,
  VStack,
  assertRequired,
  basicFormFieldWithSimpleReaderParse,
  containerQueries,
  css,
  emptyImageData,
  fixPath,
  imageIcon,
  isString,
  loadImageData,
  object,
  parseImageData,
  pluralize,
  text,
  tokenSchema,
  trash2Icon,
  useConfig,
  useDialogContainer,
  useDragAndDrop,
  useEventCallback,
  useImageLibraryURL,
  useTree,
  validateText
} from "./chunk-FTZ7QXSJ.js";
import {
  require_cookie
} from "./chunk-7KEVJODZ.js";
import {
  require_jsx_runtime
} from "./chunk-QRIEPQWS.js";
import {
  require_react_dom
} from "./chunk-XQLYTHWV.js";
import {
  require_react
} from "./chunk-VJA5E53X.js";
import {
  __toESM
} from "./chunk-SNAQBZPT.js";

// node_modules/@keystatic/core/dist/api-e04cafa8.js
var import_react = __toESM(require_react(), 1);
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var import_sanitize_url = __toESM(require_dist(), 1);
var import_slugify = __toESM(require_slugify(), 1);
function component(options) {
  return options;
}

// node_modules/@keystatic/core/dist/keystatic-core.js
var import_react2 = __toESM(require_react());
var import_jsx_runtime2 = __toESM(require_jsx_runtime());
var import_sanitize_url2 = __toESM(require_dist());
var import_slugify2 = __toESM(require_slugify());
var import_is_hotkey = __toESM(require_lib());
var import_react_dom = __toESM(require_react_dom());
var import_escape_string_regexp = __toESM(require_escape_string_regexp());
var import_cookie = __toESM(require_cookie());
function array(element, opts) {
  var _opts$label;
  return {
    kind: "array",
    element,
    label: (_opts$label = opts === null || opts === void 0 ? void 0 : opts.label) !== null && _opts$label !== void 0 ? _opts$label : "Items",
    description: opts === null || opts === void 0 ? void 0 : opts.description,
    itemLabel: opts === null || opts === void 0 ? void 0 : opts.itemLabel,
    asChildTag: opts === null || opts === void 0 ? void 0 : opts.asChildTag,
    slugField: opts === null || opts === void 0 ? void 0 : opts.slugField,
    validation: opts === null || opts === void 0 ? void 0 : opts.validation
  };
}
function BlocksFieldInput(props) {
  var _props$schema$validat, _props$schema$validat2;
  const [modalState, setModalState] = (0, import_react2.useState)({
    kind: "closed"
  });
  const dismiss = () => {
    setModalState({
      kind: "closed"
    });
  };
  const minLength = (_props$schema$validat = (_props$schema$validat2 = props.schema.validation) === null || _props$schema$validat2 === void 0 || (_props$schema$validat2 = _props$schema$validat2.length) === null || _props$schema$validat2 === void 0 ? void 0 : _props$schema$validat2.min) !== null && _props$schema$validat !== void 0 ? _props$schema$validat : 0;
  const formId = (0, import_react2.useId)();
  const stringFormatter = $fca6afa0e843324b$export$f12b703ca79dfbb1(l10nMessages);
  const errorMessage = useArrayFieldValidationMessage(props);
  const {
    descriptionProps,
    errorMessageProps,
    fieldProps: groupProps,
    labelProps
  } = $2baaea4c71418dea$export$294aa081a6c6f55d({
    description: props.schema.description,
    errorMessage,
    isInvalid: !!errorMessage,
    label: props.schema.label,
    labelElementType: "span"
  });
  return (0, import_jsx_runtime2.jsxs)(VStack, {
    gap: "medium",
    role: "group",
    minWidth: 0,
    ...groupProps,
    children: [(0, import_jsx_runtime2.jsx)(FieldLabel, {
      elementType: "span",
      isRequired: minLength > 0,
      supplementRequiredState: true,
      ...labelProps,
      children: props.schema.label
    }), props.schema.description && (0, import_jsx_runtime2.jsx)(Text, {
      size: "small",
      color: "neutralSecondary",
      ...descriptionProps,
      children: props.schema.description
    }), (0, import_jsx_runtime2.jsxs)(MenuTrigger, {
      children: [(0, import_jsx_runtime2.jsx)(ActionButton, {
        alignSelf: "start",
        children: "Add"
      }), (0, import_jsx_runtime2.jsx)(_Menu, {
        items: props.schema.element.discriminant.options,
        onAction: (discriminant) => {
          var _props$schema$element;
          const val = (_props$schema$element = props.schema.element.discriminant.options.find((x) => x.value.toString() === discriminant.toString())) === null || _props$schema$element === void 0 ? void 0 : _props$schema$element.value;
          if (val === void 0) return;
          setModalState({
            kind: "new",
            discriminant: val
          });
        },
        children: (item) => (0, import_jsx_runtime2.jsx)($c1d7fb2ec91bae71$export$6d08773d2e66f8f2, {
          children: item.label
        }, item.value.toString())
      })]
    }), (0, import_jsx_runtime2.jsx)(ArrayFieldListView, {
      ...props,
      "aria-label": props.schema.label,
      onOpenItem: (idx) => {
        setModalState({
          kind: "edit",
          idx
        });
      }
    }), errorMessage && (0, import_jsx_runtime2.jsx)(FieldMessage, {
      ...errorMessageProps,
      children: errorMessage
    }), (0, import_jsx_runtime2.jsx)(DialogContainer, {
      onDismiss: dismiss,
      children: ((_props$schema$element3) => {
        if (modalState.kind === "closed") {
          return null;
        }
        if (modalState.kind === "edit") {
          var _props$schema$element2;
          const idx = modalState.idx;
          const previewProps = props.elements[idx].value;
          const {
            discriminant: discriminant2
          } = props.elements[idx];
          return (0, import_jsx_runtime2.jsxs)(Dialog, {
            children: [(0, import_jsx_runtime2.jsxs)(Heading, {
              children: ["Edit", " ", (_props$schema$element2 = props.schema.element.discriminant.options.find((x) => x.value === discriminant2)) === null || _props$schema$element2 === void 0 ? void 0 : _props$schema$element2.label]
            }), (0, import_jsx_runtime2.jsx)(BlocksEditItemModalContent, {
              formId,
              onClose: dismiss,
              previewProps,
              modalStateIndex: idx
            }), (0, import_jsx_runtime2.jsx)(ButtonGroup, {
              children: (0, import_jsx_runtime2.jsx)(Button, {
                form: formId,
                prominence: "high",
                type: "submit",
                children: "Done"
              })
            })]
          });
        }
        const discriminant = modalState.discriminant;
        return (0, import_jsx_runtime2.jsxs)(Dialog, {
          children: [(0, import_jsx_runtime2.jsxs)(Heading, {
            children: ["Add", " ", (_props$schema$element3 = props.schema.element.discriminant.options.find((x) => x.value === discriminant)) === null || _props$schema$element3 === void 0 ? void 0 : _props$schema$element3.label]
          }), (0, import_jsx_runtime2.jsx)(Content, {
            children: (0, import_jsx_runtime2.jsx)(BlocksAddItemModalContent, {
              discriminant,
              formId,
              previewProps: props
            })
          }), (0, import_jsx_runtime2.jsxs)(ButtonGroup, {
            children: [(0, import_jsx_runtime2.jsx)(Button, {
              onPress: dismiss,
              children: stringFormatter.format("cancel")
            }), (0, import_jsx_runtime2.jsx)(Button, {
              form: formId,
              prominence: "high",
              type: "submit",
              children: stringFormatter.format("add")
            })]
          })]
        });
      })()
    })]
  });
}
function BlocksEditItemModalContent(props) {
  return (0, import_jsx_runtime2.jsx)(Content, {
    children: (0, import_jsx_runtime2.jsx)(VStack, {
      id: props.formId,
      elementType: "form",
      onSubmit: (event) => {
        if (event.target !== event.currentTarget) return;
        event.preventDefault();
        props.onClose();
      },
      gap: "xxlarge",
      children: (0, import_jsx_runtime2.jsx)(FormValueContentFromPreviewProps, {
        autoFocus: true,
        ...props.previewProps
      })
    })
  });
}
function BlocksAddItemModalContent(props) {
  const schema = props.previewProps.schema.element.values[props.discriminant.toString()];
  const [value, setValue] = (0, import_react2.useState)(() => getInitialPropsValue(schema));
  const [forceValidation, setForceValidation] = (0, import_react2.useState)(false);
  const previewProps = (0, import_react2.useMemo)(() => createGetPreviewProps(schema, setValue, () => void 0), [schema, setValue])(value);
  const {
    dismiss
  } = useDialogContainer();
  return (0, import_jsx_runtime2.jsx)(VStack, {
    id: props.formId,
    elementType: "form",
    onSubmit: (event) => {
      if (event.target !== event.currentTarget) return;
      event.preventDefault();
      if (!clientSideValidateProp(schema, value, void 0)) {
        setForceValidation(true);
        return;
      }
      props.previewProps.onChange([...props.previewProps.elements.map((x) => ({
        key: x.key
      })), {
        key: void 0,
        value: valueToUpdater({
          value,
          discriminant: props.discriminant
        }, props.previewProps.schema.element)
      }]);
      dismiss();
    },
    gap: "xxlarge",
    children: (0, import_jsx_runtime2.jsx)(FormValueContentFromPreviewProps, {
      forceValidation,
      autoFocus: true,
      ...previewProps
    })
  });
}
function blocks(blocks2, opts) {
  const entries = Object.entries(blocks2);
  if (!entries.length) {
    throw new Error("fields.blocks must have at least one entry");
  }
  const select$1 = select({
    label: "Kind",
    defaultValue: entries[0][0],
    options: Object.entries(blocks2).map(([key, {
      label
    }]) => ({
      label,
      value: key
    }))
  });
  const element = conditional(select$1, Object.fromEntries(entries.map(([key, {
    schema
  }]) => [key, schema])));
  return {
    ...array(element, {
      label: opts.label,
      description: opts.description,
      validation: opts.validation,
      itemLabel(props) {
        const kind = props.discriminant;
        const block = blocks2[kind];
        if (!block.itemLabel) return block.label;
        return block.itemLabel(props.value);
      }
    }),
    Input: BlocksFieldInput
  };
}
function CheckboxFieldInput(props) {
  return (0, import_jsx_runtime2.jsxs)(Checkbox, {
    isSelected: props.value,
    onChange: props.onChange,
    autoFocus: props.autoFocus,
    children: [(0, import_jsx_runtime2.jsx)(Text, {
      children: props.label
    }), props.description && (0, import_jsx_runtime2.jsx)(Text, {
      slot: "description",
      children: props.description
    })]
  });
}
function checkbox({
  label,
  defaultValue = false,
  description
}) {
  return basicFormFieldWithSimpleReaderParse({
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(CheckboxFieldInput, {
        ...props,
        label,
        description
      });
    },
    defaultValue() {
      return defaultValue;
    },
    parse(value) {
      if (value === void 0) return defaultValue;
      if (typeof value !== "boolean") {
        throw new FieldDataError("Must be a boolean");
      }
      return value;
    },
    validate(value) {
      return value;
    },
    serialize(value) {
      return {
        value
      };
    }
  });
}
function child(options) {
  return {
    kind: "child",
    options: options.kind === "block" ? {
      ...options,
      dividers: options.dividers,
      formatting: options.formatting === "inherit" ? {
        blockTypes: "inherit",
        headingLevels: "inherit",
        inlineMarks: "inherit",
        listTypes: "inherit",
        alignment: "inherit",
        softBreaks: "inherit"
      } : options.formatting,
      links: options.links,
      images: options.images,
      tables: options.tables,
      componentBlocks: options.componentBlocks
    } : {
      kind: "inline",
      placeholder: options.placeholder,
      formatting: options.formatting === "inherit" ? {
        inlineMarks: "inherit",
        softBreaks: "inherit"
      } : options.formatting,
      links: options.links
    }
  };
}
function ImageField(props) {
  const {
    image: image2,
    onChange
  } = props;
  const [status, setStatus] = (0, import_react2.useState)(image2.src ? "good" : "");
  const imageLibraryURL = useImageLibraryURL();
  const onPaste = (event) => {
    event.preventDefault();
    const text2 = event.clipboardData.getData("text/plain");
    const parsed = parseImageData(text2);
    props.onChange(parsed);
  };
  const onLoad = useEventCallback((data) => {
    onChange(data);
    setStatus("good");
  });
  const config2 = useConfig();
  const hasSetFields = !!(props.image.alt || props.image.width || props.image.height);
  (0, import_react2.useEffect)(() => {
    if (!props.image.src) {
      setStatus("");
      return;
    }
    if (!isValidURL$1(props.image.src)) {
      return;
    }
    if (hasSetFields) {
      setStatus("good");
      return;
    }
    setStatus("loading");
    loadImageData(props.image.src, config2).then((newData) => {
      onLoad(newData);
    }).catch(() => {
      setStatus("error");
    });
  }, [config2, hasSetFields, onLoad, props.image.src]);
  const [blurred, setBlurred] = (0, import_react2.useState)(false);
  const errorMessage = (blurred || props.forceValidation) && props.isRequired && !image2.src ? "Image URL is required." : void 0;
  return (0, import_jsx_runtime2.jsxs)(VStack, {
    gap: "xlarge",
    padding: "large",
    children: [(0, import_jsx_runtime2.jsxs)(VStack, {
      gap: "medium",
      children: [(0, import_jsx_runtime2.jsx)(TextField, {
        label: "Image URL",
        isRequired: props.isRequired,
        errorMessage,
        autoFocus: props.autoFocus,
        onPaste,
        onKeyDown: (e) => {
          if (e.code === "Backspace" || e.code === "Delete") {
            props.onChange(emptyImageData);
          }
        },
        onBlur: () => setBlurred(true),
        value: image2.src,
        description: (0, import_jsx_runtime2.jsxs)(Text, {
          children: ["Upload an image, or copy a URL from the", " ", (0, import_jsx_runtime2.jsx)(TextLink, {
            prominence: "high",
            href: imageLibraryURL,
            target: "_blank",
            rel: "noreferrer",
            children: "Image Library"
          }), " ", "and paste it into this field."]
        }),
        endElement: status === "loading" ? (0, import_jsx_runtime2.jsx)(Flex, {
          height: "element.regular",
          width: "element.regular",
          alignItems: "center",
          justifyContent: "center",
          children: (0, import_jsx_runtime2.jsx)(ProgressCircle, {
            size: "small",
            "aria-label": "Checking…",
            isIndeterminate: true
          })
        }) : image2.src ? (0, import_jsx_runtime2.jsx)(ClearButton, {
          onPress: () => {
            props.onChange(emptyImageData);
            setStatus("");
          },
          preventFocus: true
        }) : null
      }), (0, import_jsx_runtime2.jsx)(UploadImageButton, {
        alignSelf: "start",
        onUploaded: (data) => {
          onChange(data);
        }
      })]
    }), status === "good" ? (0, import_jsx_runtime2.jsxs)(import_jsx_runtime2.Fragment, {
      children: [(0, import_jsx_runtime2.jsx)(Box, {
        alignSelf: "start",
        backgroundColor: "canvas",
        borderRadius: "regular",
        border: "neutral",
        padding: "regular",
        children: (0, import_jsx_runtime2.jsx)("img", {
          alt: image2.alt,
          src: image2.src,
          style: {
            display: "block",
            maxHeight: tokenSchema.size.alias.singleLineWidth,
            maxWidth: "100%"
          }
        })
      }), (0, import_jsx_runtime2.jsx)(TextArea, {
        label: "Alt text",
        value: image2.alt,
        onChange: (alt) => props.onChange({
          ...image2,
          alt
        })
      }), (0, import_jsx_runtime2.jsx)(ImageDimensionsInput, {
        src: image2.src,
        image: image2,
        onChange: (dimensions) => {
          onChange({
            ...props.image,
            ...dimensions
          });
        }
      })]
    }) : (0, import_jsx_runtime2.jsxs)(VStack, {
      "aria-hidden": true,
      alignItems: "center",
      backgroundColor: "surface",
      borderRadius: "regular",
      gap: "medium",
      paddingX: "large",
      paddingY: "xlarge",
      children: [(0, import_jsx_runtime2.jsx)(Icon, {
        src: imageIcon,
        color: "neutralSecondary",
        size: "medium"
      }), (0, import_jsx_runtime2.jsx)(Text, {
        align: "center",
        color: "neutralSecondary",
        size: "small",
        children: "Awaiting URL to display image preview and information…"
      })]
    })]
  });
}
function CloudImageFieldInput(props) {
  var _props$fields$width$v, _props$fields$height$;
  const labelId = (0, import_react2.useId)();
  const descriptionId = (0, import_react2.useId)();
  return (0, import_jsx_runtime2.jsxs)(VStack, {
    "aria-labelledby": labelId,
    "aria-describedby": props.schema.description ? descriptionId : void 0,
    border: "muted",
    borderRadius: "medium",
    minWidth: 0,
    role: "group",
    children: [(0, import_jsx_runtime2.jsxs)(VStack, {
      backgroundColor: "surface",
      borderBottom: "muted",
      borderTopStartRadius: "medium",
      borderTopEndRadius: "medium",
      gap: "medium",
      minWidth: 0,
      padding: "large",
      children: [(0, import_jsx_runtime2.jsx)(Text, {
        color: "neutralEmphasis",
        size: "medium",
        weight: "medium",
        id: labelId,
        children: props.schema.label
      }), !!props.schema.description && (0, import_jsx_runtime2.jsx)(Text, {
        id: descriptionId,
        size: "regular",
        color: "neutralSecondary",
        children: props.schema.description
      })]
    }), (0, import_jsx_runtime2.jsx)(ImageField, {
      image: {
        src: props.fields.src.value,
        alt: props.fields.alt.value,
        width: (_props$fields$width$v = props.fields.width.value) !== null && _props$fields$width$v !== void 0 ? _props$fields$width$v : void 0,
        height: (_props$fields$height$ = props.fields.height.value) !== null && _props$fields$height$ !== void 0 ? _props$fields$height$ : void 0
      },
      onChange: (data) => {
        var _data$width, _data$height;
        props.onChange({
          src: data.src,
          alt: data.alt,
          width: (_data$width = data.width) !== null && _data$width !== void 0 ? _data$width : null,
          height: (_data$height = data.height) !== null && _data$height !== void 0 ? _data$height : null
        });
      },
      autoFocus: props.autoFocus,
      isRequired: props.isRequired,
      forceValidation: props.forceValidation
    })]
  });
}
function cloudImage({
  label,
  description,
  validation
}) {
  return {
    ...object({
      src: text({
        label: "URL",
        validation: {
          length: {
            min: validation !== null && validation !== void 0 && validation.isRequired ? 1 : 0
          }
        }
      }),
      alt: text({
        label: "Alt text"
      }),
      height: integer({
        label: "Height"
      }),
      width: integer({
        label: "Width"
      })
    }, {
      label,
      description
    }),
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(CloudImageFieldInput, {
        ...props,
        isRequired: validation === null || validation === void 0 ? void 0 : validation.isRequired
      });
    }
  };
}
function conditional(discriminant, values) {
  return {
    kind: "conditional",
    discriminant,
    values
  };
}
function validateDate(validation, value, label) {
  if (value !== null && !/^\d{4}-\d{2}-\d{2}$/.test(value)) {
    return `${label} is not a valid date`;
  }
  if (validation !== null && validation !== void 0 && validation.isRequired && value === null) {
    return `${label} is required`;
  }
  if ((validation !== null && validation !== void 0 && validation.min || validation !== null && validation !== void 0 && validation.max) && value !== null) {
    const date2 = new Date(value);
    if ((validation === null || validation === void 0 ? void 0 : validation.min) !== void 0) {
      const min = new Date(validation.min);
      if (date2 < min) {
        return `${label} must be after ${min.toLocaleDateString()}`;
      }
    }
    if ((validation === null || validation === void 0 ? void 0 : validation.max) !== void 0) {
      const max = new Date(validation.max);
      if (date2 > max) {
        return `${label} must be no later than ${max.toLocaleDateString()}`;
      }
    }
  }
}
function DateFieldInput(props) {
  var _props$validation;
  const [blurred, onBlur] = (0, import_react2.useReducer)(() => true, false);
  return (0, import_jsx_runtime2.jsx)(TextField, {
    label: props.label,
    description: props.description,
    type: "date",
    onChange: (val) => {
      props.onChange(val === "" ? null : val);
    },
    autoFocus: props.autoFocus,
    value: props.value === null ? "" : props.value,
    onBlur,
    isRequired: (_props$validation = props.validation) === null || _props$validation === void 0 ? void 0 : _props$validation.isRequired,
    errorMessage: blurred || props.forceValidation ? validateDate(props.validation, props.value, props.label) : void 0
  });
}
function date({
  label,
  defaultValue,
  validation,
  description
}) {
  return basicFormFieldWithSimpleReaderParse({
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(DateFieldInput, {
        validation,
        label,
        description,
        ...props
      });
    },
    defaultValue() {
      if (defaultValue === void 0) {
        return null;
      }
      if (typeof defaultValue === "string") {
        return defaultValue;
      }
      const today = /* @__PURE__ */ new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, "0");
      const day = String(today.getDate()).padStart(2, "0");
      return `${year}-${month}-${day}`;
    },
    parse(value) {
      if (value === void 0) {
        return null;
      }
      if (value instanceof Date) {
        const year = value.getUTCFullYear();
        const month = String(value.getUTCMonth() + 1).padStart(2, "0");
        const day = String(value.getUTCDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }
      if (typeof value !== "string") {
        throw new FieldDataError("Must be a string");
      }
      return value;
    },
    serialize(value) {
      if (value === null) return {
        value: void 0
      };
      const date2 = new Date(value);
      date2.toISOString = () => value;
      date2.toString = () => value;
      return {
        value: date2
      };
    },
    validate(value) {
      const message = validateDate(validation, value, label);
      if (message !== void 0) {
        throw new FieldDataError(message);
      }
      assertRequired(value, validation, label);
      return value;
    }
  });
}
function validateDatetime(validation, value, label) {
  if (value !== null && !/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(value)) {
    return `${label} is not a valid datetime`;
  }
  if (validation !== null && validation !== void 0 && validation.isRequired && value === null) {
    return `${label} is required`;
  }
  if ((validation !== null && validation !== void 0 && validation.min || validation !== null && validation !== void 0 && validation.max) && value !== null) {
    const datetime2 = new Date(value);
    if ((validation === null || validation === void 0 ? void 0 : validation.min) !== void 0) {
      const min = new Date(validation.min);
      if (datetime2 < min) {
        return `${label} must be after ${min.toISOString()}`;
      }
    }
    if ((validation === null || validation === void 0 ? void 0 : validation.max) !== void 0) {
      const max = new Date(validation.max);
      if (datetime2 > max) {
        return `${label} must be no later than ${max.toISOString()}`;
      }
    }
  }
}
function DatetimeFieldInput(props) {
  var _props$validation;
  const [blurred, onBlur] = (0, import_react2.useReducer)(() => true, false);
  return (0, import_jsx_runtime2.jsx)(TextField, {
    label: props.label,
    description: props.description,
    type: "datetime-local",
    onChange: (val) => {
      props.onChange(val === "" ? null : val);
    },
    autoFocus: props.autoFocus,
    value: props.value === null ? "" : props.value,
    onBlur,
    isRequired: (_props$validation = props.validation) === null || _props$validation === void 0 ? void 0 : _props$validation.isRequired,
    errorMessage: blurred || props.forceValidation ? validateDatetime(props.validation, props.value, props.label) : void 0
  });
}
function datetime({
  label,
  defaultValue,
  validation,
  description
}) {
  return basicFormFieldWithSimpleReaderParse({
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(DatetimeFieldInput, {
        validation,
        label,
        description,
        ...props
      });
    },
    defaultValue() {
      if (defaultValue === void 0) {
        return null;
      }
      if (typeof defaultValue === "string") {
        return defaultValue;
      }
      if (defaultValue.kind === "now") {
        const now = /* @__PURE__ */ new Date();
        return new Date(now.getTime() - now.getTimezoneOffset() * 60 * 1e3).toISOString().slice(0, -8);
      }
      return null;
    },
    parse(value) {
      if (value === void 0) {
        return null;
      }
      if (value instanceof Date) {
        return value.toISOString().slice(0, -8);
      }
      if (typeof value !== "string") {
        throw new FieldDataError("Must be a string or date");
      }
      return value;
    },
    serialize(value) {
      if (value === null) return {
        value: void 0
      };
      const date2 = /* @__PURE__ */ new Date(value + "Z");
      date2.toJSON = () => date2.toISOString().slice(0, -8);
      date2.toString = () => date2.toISOString().slice(0, -8);
      return {
        value: date2
      };
    },
    validate(value) {
      const message = validateDatetime(validation, value, label);
      if (message !== void 0) {
        throw new FieldDataError(message);
      }
      assertRequired(value, validation, label);
      return value;
    }
  });
}
function empty() {
  return basicFormFieldWithSimpleReaderParse({
    Input() {
      return null;
    },
    defaultValue() {
      return null;
    },
    parse() {
      return null;
    },
    serialize() {
      return {
        value: void 0
      };
    },
    validate(value) {
      return value;
    },
    label: "Empty"
  });
}
function emptyDocument() {
  return {
    kind: "form",
    formKind: "content",
    Input() {
      return null;
    },
    defaultValue() {
      return null;
    },
    parse() {
      return null;
    },
    contentExtension: ".mdoc",
    serialize() {
      return {
        value: void 0,
        content: new Uint8Array(),
        external: /* @__PURE__ */ new Map(),
        other: /* @__PURE__ */ new Map()
      };
    },
    validate(value) {
      return value;
    },
    reader: {
      parse() {
        return null;
      }
    }
  };
}
function FileFieldInput(props) {
  var _props$validation, _props$validation2;
  const {
    value
  } = props;
  const [blurred, onBlur] = (0, import_react2.useReducer)(() => true, false);
  const isInEditor = useIsInDocumentEditor();
  const objectUrl = useObjectURL(value === null ? null : value.data, void 0);
  const labelId = (0, import_react2.useId)();
  const descriptionId = (0, import_react2.useId)();
  return (0, import_jsx_runtime2.jsxs)(Flex, {
    "aria-describedby": props.description ? descriptionId : void 0,
    "aria-labelledby": labelId,
    direction: "column",
    gap: "medium",
    role: "group",
    children: [(0, import_jsx_runtime2.jsx)(FieldLabel, {
      id: labelId,
      elementType: "span",
      isRequired: (_props$validation = props.validation) === null || _props$validation === void 0 ? void 0 : _props$validation.isRequired,
      children: props.label
    }), props.description && (0, import_jsx_runtime2.jsx)(Text, {
      size: "small",
      color: "neutralSecondary",
      id: descriptionId,
      children: props.description
    }), (0, import_jsx_runtime2.jsxs)(ButtonGroup, {
      children: [(0, import_jsx_runtime2.jsx)(ActionButton, {
        onPress: async () => {
          const file2 = await getUploadedFile("");
          if (file2) {
            var _file$filename$match$, _file$filename$match;
            props.onChange({
              data: file2.content,
              filename: file2.filename,
              extension: (_file$filename$match$ = (_file$filename$match = file2.filename.match(/\.([^.]+$)/)) === null || _file$filename$match === void 0 ? void 0 : _file$filename$match[1]) !== null && _file$filename$match$ !== void 0 ? _file$filename$match$ : ""
            });
          }
        },
        children: "Choose file"
      }), value !== null && (0, import_jsx_runtime2.jsxs)(import_jsx_runtime2.Fragment, {
        children: [(0, import_jsx_runtime2.jsx)(ActionButton, {
          prominence: "low",
          onPress: () => {
            props.onChange(null);
            onBlur();
          },
          children: "Remove"
        }), objectUrl && (0, import_jsx_runtime2.jsx)(Button, {
          href: objectUrl,
          download: value.filename,
          prominence: "low",
          children: "Download"
        })]
      })]
    }), isInEditor && value !== null && (0, import_jsx_runtime2.jsx)(TextField, {
      label: "Filename",
      onChange: (filename) => {
        props.onChange({
          ...value,
          filename
        });
      },
      value: value.filename
    }), (props.forceValidation || blurred) && ((_props$validation2 = props.validation) === null || _props$validation2 === void 0 ? void 0 : _props$validation2.isRequired) && value === null && (0, import_jsx_runtime2.jsxs)(FieldMessage, {
      children: [props.label, " is required"]
    })]
  });
}
function file({
  label,
  directory,
  validation,
  description,
  publicPath
}) {
  return {
    kind: "form",
    formKind: "asset",
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(FileFieldInput, {
        label,
        description,
        validation,
        ...props
      });
    },
    defaultValue() {
      return null;
    },
    filename(value, args) {
      if (typeof value === "string") {
        return value.slice(getSrcPrefix(publicPath, args.slug).length);
      }
      return void 0;
    },
    parse(value, args) {
      var _value$match$, _value$match;
      if (value === void 0) {
        return null;
      }
      if (typeof value !== "string") {
        throw new FieldDataError("Must be a string");
      }
      if (args.asset === void 0) {
        return null;
      }
      return {
        data: args.asset,
        filename: value.slice(getSrcPrefix(publicPath, args.slug).length),
        extension: (_value$match$ = (_value$match = value.match(/\.([^.]+$)/)) === null || _value$match === void 0 ? void 0 : _value$match[1]) !== null && _value$match$ !== void 0 ? _value$match$ : ""
      };
    },
    validate(value) {
      assertRequired(value, validation, label);
      return value;
    },
    serialize(value, args) {
      if (value === null) {
        return {
          value: void 0,
          asset: void 0
        };
      }
      const filename = args.suggestedFilenamePrefix ? args.suggestedFilenamePrefix + "." + value.extension : value.filename;
      return {
        value: `${getSrcPrefix(publicPath, args.slug)}${filename}`,
        asset: {
          filename,
          content: value.data
        }
      };
    },
    directory: directory ? fixPath(directory) : void 0,
    reader: {
      parse(value) {
        if (typeof value !== "string" && value !== void 0) {
          throw new FieldDataError("Must be a string");
        }
        const val = value === void 0 ? null : value;
        assertRequired(val, validation, label);
        return val;
      }
    }
  };
}
function image({
  label,
  directory,
  validation,
  description,
  publicPath
}) {
  return {
    kind: "form",
    formKind: "asset",
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(ImageFieldInput, {
        label,
        description,
        validation,
        ...props
      });
    },
    defaultValue() {
      return null;
    },
    filename(value, args) {
      if (typeof value === "string") {
        return value.slice(getSrcPrefix(publicPath, args.slug).length);
      }
      return void 0;
    },
    parse(value, args) {
      var _value$match$, _value$match;
      if (value === void 0) {
        return null;
      }
      if (typeof value !== "string") {
        throw new FieldDataError("Must be a string");
      }
      if (args.asset === void 0) {
        return null;
      }
      return {
        data: args.asset,
        filename: value.slice(getSrcPrefix(publicPath, args.slug).length),
        extension: (_value$match$ = (_value$match = value.match(/\.([^.]+$)/)) === null || _value$match === void 0 ? void 0 : _value$match[1]) !== null && _value$match$ !== void 0 ? _value$match$ : ""
      };
    },
    validate(value) {
      assertRequired(value, validation, label);
      return value;
    },
    serialize(value, args) {
      if (value === null) {
        return {
          value: void 0,
          asset: void 0
        };
      }
      const filename = args.suggestedFilenamePrefix ? args.suggestedFilenamePrefix + "." + value.extension : value.filename;
      return {
        value: `${getSrcPrefix(publicPath, args.slug)}${filename}`,
        asset: {
          filename,
          content: value.data
        }
      };
    },
    directory: directory ? fixPath(directory) : void 0,
    reader: {
      parse(value) {
        if (typeof value !== "string" && value !== void 0) {
          throw new FieldDataError("Must be a string");
        }
        const val = value === void 0 ? null : value;
        assertRequired(val, validation, label);
        return val;
      }
    }
  };
}
function validateMultiRelationshipLength(validation, value) {
  var _validation$length$mi, _validation$length, _validation$length$ma, _validation$length2;
  const minLength = (_validation$length$mi = validation === null || validation === void 0 || (_validation$length = validation.length) === null || _validation$length === void 0 ? void 0 : _validation$length.min) !== null && _validation$length$mi !== void 0 ? _validation$length$mi : 0;
  if (value.length < minLength) {
    return `Must have at least ${pluralize(minLength, {
      singular: "item"
    })}.`;
  }
  const maxLength = (_validation$length$ma = validation === null || validation === void 0 || (_validation$length2 = validation.length) === null || _validation$length2 === void 0 ? void 0 : _validation$length2.max) !== null && _validation$length$ma !== void 0 ? _validation$length$ma : Infinity;
  if (value.length > maxLength) {
    return `Must have at most ${pluralize(maxLength, {
      singular: "item"
    })}.`;
  }
}
function MultiRelationshipInput(props) {
  var _props$validation;
  const valAsObjects = (0, import_react2.useMemo)(() => {
    return props.value.map((key) => ({
      key
    }));
  }, [props.value]);
  const [blurred, onBlur] = (0, import_react2.useReducer)(() => true, false);
  const slugs = useSlugsInCollection(props.collection);
  const options = (0, import_react2.useMemo)(() => {
    return slugs.map((slug2) => ({
      slug: slug2
    }));
  }, [slugs]);
  const _errorMessage = (props.forceValidation || blurred) && validateMultiRelationshipLength(props.validation, props.value);
  const [errorMessage, setErrorMessage] = (0, import_react2.useState)(_errorMessage);
  (0, import_react2.useEffect)(() => {
    setErrorMessage(_errorMessage);
  }, [_errorMessage]);
  const items = (0, import_react2.useMemo)(() => {
    const elementSet = new Set(props.value);
    return options.filter((option) => !elementSet.has(option.slug));
  }, [props.value, options]);
  return (0, import_jsx_runtime2.jsxs)(VStack, {
    gap: "medium",
    minWidth: 0,
    children: [(0, import_jsx_runtime2.jsx)(_Combobox, {
      label: props.label,
      description: props.description,
      selectedKey: null,
      placeholder: items.length === 0 ? "All selected" : void 0,
      onSelectionChange: (key) => {
        if (typeof key === "string") {
          props.onChange([...props.value, key]);
        }
      },
      disabledKeys: ["No more items…"],
      onBlur,
      autoFocus: props.autoFocus,
      defaultItems: items.length ? items : [{
        slug: "No more items…"
      }],
      isReadOnly: items.length === 0,
      isRequired: ((_props$validation = props.validation) === null || _props$validation === void 0 || (_props$validation = _props$validation.length) === null || _props$validation === void 0 ? void 0 : _props$validation.min) !== void 0 && props.validation.length.min >= 1,
      errorMessage,
      width: "auto",
      children: (item) => (0, import_jsx_runtime2.jsx)($c1d7fb2ec91bae71$export$6d08773d2e66f8f2, {
        children: item.slug
      }, item.slug)
    }), (0, import_jsx_runtime2.jsx)(MultiRelationshipListView, {
      autoFocus: props.autoFocus,
      forceValidation: props.forceValidation,
      onChange: (value) => {
        props.onChange(value.map((x) => x.key));
      },
      elements: valAsObjects,
      "aria-label": props.label
    })]
  });
}
function MultiRelationshipListView(props) {
  const [selectedKeys, setSelectedKeys] = (0, import_react2.useState)(() => /* @__PURE__ */ new Set([]));
  let onMove = (keys, target) => {
    const targetIndex = props.elements.findIndex((x) => x.key === target.key);
    if (targetIndex === -1) return;
    const allKeys = props.elements.map((x) => ({
      key: x.key
    }));
    const indexToMoveTo = target.dropPosition === "before" ? targetIndex : targetIndex + 1;
    const indices = keys.map((key) => allKeys.findIndex((x) => x.key === key));
    props.onChange(move(allKeys, indices, indexToMoveTo));
  };
  const dragType = (0, import_react2.useMemo)(() => Math.random().toString(36), []);
  let {
    dragAndDropHooks
  } = useDragAndDrop({
    getItems(keys) {
      return [...keys].map((key) => {
        key = JSON.stringify(key);
        return {
          [dragType]: key,
          "text/plain": key
        };
      });
    },
    getAllowedDropOperations() {
      return ["move", "cancel"];
    },
    async onDrop(e) {
      if (e.target.type !== "root" && e.target.dropPosition !== "on") {
        let keys = [];
        for (let item of e.items) {
          if (item.kind === "text") {
            let key;
            if (item.types.has(dragType)) {
              key = JSON.parse(await item.getText(dragType));
              keys.push(key);
            } else if (item.types.has("text/plain")) {
              key = await item.getText("text/plain");
              keys = key.split("\n").map((val) => val.replaceAll('"', ""));
            }
          }
        }
        onMove(keys, e.target);
      }
    },
    getDropOperation(target) {
      if (target.type === "root" || target.dropPosition === "on") {
        return "cancel";
      }
      return "move";
    }
  });
  return (0, import_jsx_runtime2.jsxs)(_ActionBarContainer, {
    maxHeight: "scale.3400",
    minHeight: "scale.1600",
    children: [(0, import_jsx_runtime2.jsx)(_ListView, {
      "aria-label": props["aria-label"],
      items: props.elements,
      dragAndDropHooks,
      selectionMode: "multiple",
      onSelectionChange: setSelectedKeys,
      selectedKeys,
      renderEmptyState: arrayFieldEmptyState,
      UNSAFE_className: css({
        borderRadius: tokenSchema.size.radius.regular
      }),
      children: (item) => {
        const label = item.key;
        return (0, import_jsx_runtime2.jsx)($c1d7fb2ec91bae71$export$6d08773d2e66f8f2, {
          textValue: label,
          children: label
        }, item.key);
      }
    }), (0, import_jsx_runtime2.jsx)(_ActionBar, {
      selectedItemCount: selectedKeys === "all" ? "all" : selectedKeys.size,
      onClearSelection: () => setSelectedKeys(/* @__PURE__ */ new Set()),
      onAction: (key) => {
        if (key === "delete") {
          let newItems = props.elements;
          if (selectedKeys instanceof Set) {
            newItems = props.elements.filter((item) => !selectedKeys.has(item.key));
          } else if (selectedKeys === "all") {
            newItems = [];
          }
          props.onChange(newItems);
          setSelectedKeys(/* @__PURE__ */ new Set());
        }
      },
      children: (0, import_jsx_runtime2.jsxs)($c1d7fb2ec91bae71$export$6d08773d2e66f8f2, {
        textValue: "Remove",
        children: [(0, import_jsx_runtime2.jsx)(Icon, {
          src: trash2Icon
        }), (0, import_jsx_runtime2.jsx)(Text, {
          children: "Remove"
        })]
      }, "delete")
    })]
  });
}
function arrayFieldEmptyState() {
  return (0, import_jsx_runtime2.jsx)(VStack, {
    gap: "large",
    alignItems: "center",
    justifyContent: "center",
    height: "100%",
    padding: "regular",
    children: (0, import_jsx_runtime2.jsx)(Text, {
      align: "center",
      color: "neutralTertiary",
      children: "No items selected…"
    })
  });
}
function multiRelationship({
  label,
  collection: collection2,
  validation,
  description
}) {
  return basicFormFieldWithSimpleReaderParse({
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(MultiRelationshipInput, {
        label,
        collection: collection2,
        description,
        validation,
        ...props
      });
    },
    defaultValue() {
      return [];
    },
    parse(value) {
      if (value === void 0) {
        return [];
      }
      if (!Array.isArray(value) || !value.every(isString)) {
        throw new FieldDataError("Must be an array of strings");
      }
      return value;
    },
    validate(value) {
      const error = validateMultiRelationshipLength(validation, value);
      if (error) {
        throw new FieldDataError(error);
      }
      return value;
    },
    serialize(value) {
      return {
        value
      };
    }
  });
}
function MultiselectFieldInput(props) {
  const labelId = (0, import_react2.useId)();
  const descriptionId = (0, import_react2.useId)();
  return (0, import_jsx_runtime2.jsxs)(Flex, {
    role: "group",
    "aria-labelledby": labelId,
    "aria-describedby": props.description ? descriptionId : void 0,
    direction: "column",
    gap: "medium",
    children: [(0, import_jsx_runtime2.jsx)(FieldLabel, {
      elementType: "span",
      id: labelId,
      children: props.label
    }), props.description && (0, import_jsx_runtime2.jsx)(Text, {
      id: descriptionId,
      size: "small",
      color: "neutralSecondary",
      children: props.description
    }), props.options.map((option) => (0, import_jsx_runtime2.jsx)(Checkbox, {
      isSelected: props.value.includes(option.value),
      onChange: () => {
        if (props.value.includes(option.value)) {
          props.onChange(props.value.filter((x) => x !== option.value));
        } else {
          props.onChange([...props.value, option.value]);
        }
      },
      children: option.label
    }, option.value))]
  });
}
function multiselect({
  label,
  options,
  defaultValue = [],
  description
}) {
  const valuesToOption = new Map(options.map((x) => [x.value, x]));
  const field = basicFormFieldWithSimpleReaderParse({
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(MultiselectFieldInput, {
        label,
        description,
        options,
        ...props
      });
    },
    defaultValue() {
      return defaultValue;
    },
    parse(value) {
      if (value === void 0) {
        return [];
      }
      if (!Array.isArray(value)) {
        throw new FieldDataError("Must be an array of options");
      }
      if (!value.every((x) => typeof x === "string" && valuesToOption.has(x))) {
        throw new FieldDataError(`Must be an array with one of ${options.map((x) => x.value).join(", ")}`);
      }
      return value;
    },
    validate(value) {
      return value;
    },
    serialize(value) {
      return {
        value
      };
    }
  });
  return {
    ...field,
    options
  };
}
function validateNumber(validation, value, step, label) {
  if (value !== null && typeof value !== "number") {
    return `${label} must be a number`;
  }
  if (validation !== null && validation !== void 0 && validation.isRequired && value === null) {
    return `${label} is required`;
  }
  if (value !== null) {
    if ((validation === null || validation === void 0 ? void 0 : validation.min) !== void 0 && value < validation.min) {
      return `${label} must be at least ${validation.min}`;
    }
    if ((validation === null || validation === void 0 ? void 0 : validation.max) !== void 0 && value > validation.max) {
      return `${label} must be at most ${validation.max}`;
    }
    if (step !== void 0 && (validation === null || validation === void 0 ? void 0 : validation.validateStep) !== void 0 && new decimal_default(value).mod(new decimal_default(step)).toNumber() !== 0) {
      return `${label} must be a multiple of ${step}`;
    }
  }
}
function NumberFieldInput(props) {
  var _props$validation;
  const [blurred, onBlur] = (0, import_react2.useReducer)(() => true, false);
  return (0, import_jsx_runtime2.jsx)(NumberField, {
    label: props.label,
    description: props.description,
    isRequired: (_props$validation = props.validation) === null || _props$validation === void 0 ? void 0 : _props$validation.isRequired,
    errorMessage: props.forceValidation || blurred ? validateNumber(props.validation, props.value, props.step, props.label) : void 0,
    onBlur,
    autoFocus: props.autoFocus,
    step: props.step,
    value: props.value === null ? void 0 : props.value,
    onChange: (val) => {
      props.onChange(val === void 0 ? null : val);
    }
  });
}
function number({
  label,
  defaultValue,
  step,
  validation,
  description
}) {
  return basicFormFieldWithSimpleReaderParse({
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(NumberFieldInput, {
        label,
        description,
        validation,
        step,
        ...props
      });
    },
    defaultValue() {
      return defaultValue !== null && defaultValue !== void 0 ? defaultValue : null;
    },
    parse(value) {
      if (value === void 0) {
        return null;
      }
      if (typeof value === "number") {
        return value;
      }
      throw new FieldDataError("Must be a number");
    },
    validate(value) {
      const message = validateNumber(validation, value, step, label);
      if (message !== void 0) {
        throw new FieldDataError(message);
      }
      assertRequired(value, validation, label);
      return value;
    },
    serialize(value) {
      return {
        value: value === null ? void 0 : value
      };
    }
  });
}
function PathReferenceInput(props) {
  var _props$validation, _props$validation2;
  const match = (0, import_react2.useMemo)(() => props.pattern ? filter(props.pattern) : () => true, [props.pattern]);
  const [blurred, onBlur] = (0, import_react2.useReducer)(() => true, false);
  const tree = useTree().current;
  const options = (0, import_react2.useMemo)(() => {
    const files = tree.kind === "loaded" ? [...tree.data.entries.values()] : [];
    return files.filter((val) => match(val.path));
  }, [tree, match]);
  const _errorMessage = (props.forceValidation || blurred) && (_props$validation = props.validation) !== null && _props$validation !== void 0 && _props$validation.isRequired && props.value === null ? `${props.label} is required` : void 0;
  const [errorMessage, setErrorMessage] = (0, import_react2.useState)(_errorMessage);
  (0, import_react2.useEffect)(() => {
    setErrorMessage(_errorMessage);
  }, [_errorMessage]);
  return (0, import_jsx_runtime2.jsx)(_Combobox, {
    label: props.label,
    description: props.description,
    selectedKey: props.value,
    onSelectionChange: (key) => {
      if (typeof key === "string" || key === null) {
        props.onChange(key);
      }
    },
    onBlur,
    isRequired: (_props$validation2 = props.validation) === null || _props$validation2 === void 0 ? void 0 : _props$validation2.isRequired,
    errorMessage,
    autoFocus: props.autoFocus,
    defaultItems: options,
    width: "auto",
    children: (item) => (0, import_jsx_runtime2.jsx)($c1d7fb2ec91bae71$export$6d08773d2e66f8f2, {
      children: item.path
    }, item.path)
  });
}
function pathReference({
  label,
  pattern,
  validation,
  description
}) {
  return basicFormFieldWithSimpleReaderParse({
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(PathReferenceInput, {
        label,
        pattern,
        description,
        validation,
        ...props
      });
    },
    defaultValue() {
      return null;
    },
    parse(value) {
      if (value === void 0) {
        return null;
      }
      if (typeof value !== "string") {
        throw new FieldDataError("Must be a string");
      }
      return value;
    },
    validate(value) {
      assertRequired(value, validation, label);
      return value;
    },
    serialize(value) {
      return {
        value: value === null ? void 0 : value
      };
    }
  });
}
function RelationshipInput(props) {
  var _props$validation, _props$validation2;
  const [blurred, onBlur] = (0, import_react2.useReducer)(() => true, false);
  const slugs = useSlugsInCollection(props.collection);
  const options = (0, import_react2.useMemo)(() => {
    return slugs.map((slug2) => ({
      slug: slug2
    }));
  }, [slugs]);
  const _errorMessage = (props.forceValidation || blurred) && (_props$validation = props.validation) !== null && _props$validation !== void 0 && _props$validation.isRequired && props.value === null ? `${props.label} is required` : void 0;
  const [errorMessage, setErrorMessage] = (0, import_react2.useState)(_errorMessage);
  (0, import_react2.useEffect)(() => {
    setErrorMessage(_errorMessage);
  }, [_errorMessage]);
  return (0, import_jsx_runtime2.jsx)(_Combobox, {
    label: props.label,
    description: props.description,
    selectedKey: props.value,
    onSelectionChange: (key) => {
      if (typeof key === "string" || key === null) {
        props.onChange(key);
      }
    },
    onBlur,
    autoFocus: props.autoFocus,
    defaultItems: options,
    isRequired: (_props$validation2 = props.validation) === null || _props$validation2 === void 0 ? void 0 : _props$validation2.isRequired,
    errorMessage,
    width: "auto",
    children: (item) => (0, import_jsx_runtime2.jsx)($c1d7fb2ec91bae71$export$6d08773d2e66f8f2, {
      children: item.slug
    }, item.slug)
  });
}
function relationship({
  label,
  collection: collection2,
  validation,
  description
}) {
  return basicFormFieldWithSimpleReaderParse({
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(RelationshipInput, {
        label,
        collection: collection2,
        description,
        validation,
        ...props
      });
    },
    defaultValue() {
      return null;
    },
    parse(value) {
      if (value === void 0) {
        return null;
      }
      if (typeof value !== "string") {
        throw new FieldDataError("Must be a string");
      }
      return value;
    },
    validate(value) {
      assertRequired(value, validation, label);
      return value;
    },
    serialize(value) {
      return {
        value: value === null ? void 0 : value
      };
    }
  });
}
function SelectFieldInput(props) {
  let fieldContext = useFieldContext();
  return (0, import_jsx_runtime2.jsx)(_Picker, {
    label: props.label,
    description: props.description,
    items: props.options,
    selectedKey: props.value,
    onSelectionChange: (key) => {
      props.onChange(key);
    },
    autoFocus: props.autoFocus,
    width: {
      mobile: "auto",
      tablet: fieldContext.span === 12 ? "alias.singleLineWidth" : "auto"
    },
    children: (item) => (0, import_jsx_runtime2.jsx)($c1d7fb2ec91bae71$export$6d08773d2e66f8f2, {
      children: item.label
    }, item.value)
  });
}
function select({
  label,
  options,
  defaultValue,
  description
}) {
  const optionValuesSet = new Set(options.map((x) => x.value));
  if (!optionValuesSet.has(defaultValue)) {
    throw new Error(`A defaultValue of ${defaultValue} was provided to a select field but it does not match the value of one of the options provided`);
  }
  const field = basicFormFieldWithSimpleReaderParse({
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(SelectFieldInput, {
        label,
        options,
        description,
        ...props
      });
    },
    defaultValue() {
      return defaultValue;
    },
    parse(value) {
      if (value === void 0) {
        return defaultValue;
      }
      if (typeof value !== "string") {
        throw new FieldDataError("Must be a string");
      }
      if (!optionValuesSet.has(value)) {
        throw new FieldDataError("Must be a valid option");
      }
      return value;
    },
    validate(value) {
      return value;
    },
    serialize(value) {
      return {
        value
      };
    }
  });
  return {
    ...field,
    options
  };
}
var emptySet = /* @__PURE__ */ new Set();
function SlugFieldInput(props) {
  var _props$args$slug$labe, _props$args$slug, _props$args$slug$vali, _props$args$slug2, _props$args$slug$vali2, _props$args$slug3, _props$args$name$vali, _props$args$name$vali2, _props$args$name$vali3, _props$args$name$vali4, _props$args$name$vali5, _props$args$slug4;
  const slugContext = (0, import_react2.useContext)(SlugFieldContext);
  const path = (0, import_react2.useContext)(PathContext);
  const slugInfo = path.length === 1 && path[0] === (slugContext === null || slugContext === void 0 ? void 0 : slugContext.field) ? slugContext : {
    slugs: emptySet,
    glob: "*"
  };
  const [blurredName, setBlurredName] = (0, import_react2.useState)(false);
  const [blurredSlug, setBlurredSlug] = (0, import_react2.useState)(false);
  const [shouldGenerateSlug, setShouldGenerateSlug] = (0, import_react2.useState)(props.value === props.defaultValue);
  const generateSlug = (name) => {
    const generated = props.naiveGenerateSlug(name);
    if (slugInfo.slugs.has(generated)) {
      let i = 1;
      while (slugInfo.slugs.has(`${generated}-${i}`)) {
        i++;
      }
      return `${generated}-${i}`;
    }
    return generated;
  };
  const slugFieldLabel = (_props$args$slug$labe = (_props$args$slug = props.args.slug) === null || _props$args$slug === void 0 ? void 0 : _props$args$slug.label) !== null && _props$args$slug$labe !== void 0 ? _props$args$slug$labe : "Slug";
  const slugErrorMessage = props.forceValidation || blurredSlug ? validateText(props.value.slug, (_props$args$slug$vali = (_props$args$slug2 = props.args.slug) === null || _props$args$slug2 === void 0 || (_props$args$slug2 = _props$args$slug2.validation) === null || _props$args$slug2 === void 0 || (_props$args$slug2 = _props$args$slug2.length) === null || _props$args$slug2 === void 0 ? void 0 : _props$args$slug2.min) !== null && _props$args$slug$vali !== void 0 ? _props$args$slug$vali : 1, (_props$args$slug$vali2 = (_props$args$slug3 = props.args.slug) === null || _props$args$slug3 === void 0 || (_props$args$slug3 = _props$args$slug3.validation) === null || _props$args$slug3 === void 0 || (_props$args$slug3 = _props$args$slug3.length) === null || _props$args$slug3 === void 0 ? void 0 : _props$args$slug3.max) !== null && _props$args$slug$vali2 !== void 0 ? _props$args$slug$vali2 : Infinity, slugFieldLabel, slugInfo) : void 0;
  return (0, import_jsx_runtime2.jsxs)(Flex, {
    gap: "xlarge",
    direction: "column",
    children: [(0, import_jsx_runtime2.jsx)(TextField, {
      label: props.args.name.label,
      description: props.args.name.description,
      autoFocus: props.autoFocus,
      value: props.value.name,
      isRequired: !!((_props$args$name$vali = props.args.name.validation) !== null && _props$args$name$vali !== void 0 && (_props$args$name$vali = _props$args$name$vali.length) !== null && _props$args$name$vali !== void 0 && _props$args$name$vali.min),
      onChange: (name) => {
        props.onChange({
          name,
          slug: shouldGenerateSlug ? generateSlug(name) : props.value.slug
        });
      },
      onBlur: () => setBlurredName(true),
      errorMessage: props.forceValidation || blurredName ? validateText(props.value.name, (_props$args$name$vali2 = (_props$args$name$vali3 = props.args.name.validation) === null || _props$args$name$vali3 === void 0 || (_props$args$name$vali3 = _props$args$name$vali3.length) === null || _props$args$name$vali3 === void 0 ? void 0 : _props$args$name$vali3.min) !== null && _props$args$name$vali2 !== void 0 ? _props$args$name$vali2 : 0, (_props$args$name$vali4 = (_props$args$name$vali5 = props.args.name.validation) === null || _props$args$name$vali5 === void 0 || (_props$args$name$vali5 = _props$args$name$vali5.length) === null || _props$args$name$vali5 === void 0 ? void 0 : _props$args$name$vali5.max) !== null && _props$args$name$vali4 !== void 0 ? _props$args$name$vali4 : Infinity, props.args.name.label, void 0) : void 0
    }), (0, import_jsx_runtime2.jsxs)(Flex, {
      gap: "regular",
      alignItems: "end",
      children: [(0, import_jsx_runtime2.jsx)(TextField, {
        flex: 1,
        label: slugFieldLabel,
        description: (_props$args$slug4 = props.args.slug) === null || _props$args$slug4 === void 0 ? void 0 : _props$args$slug4.description,
        value: props.value.slug,
        onChange: (slug2) => {
          setShouldGenerateSlug(false);
          props.onChange({
            name: props.value.name,
            slug: slug2
          });
        },
        onBlur: () => setBlurredSlug(true),
        errorMessage: slugErrorMessage,
        isRequired: true
      }), (0, import_jsx_runtime2.jsxs)(Flex, {
        gap: "regular",
        direction: "column",
        children: [(0, import_jsx_runtime2.jsxs)(ActionButton, {
          "aria-label": "regenerate",
          onPress: () => {
            props.onChange({
              name: props.value.name,
              slug: generateSlug(props.value.name)
            });
          },
          children: [(0, import_jsx_runtime2.jsx)(Icon, {
            src: refreshCwIcon,
            UNSAFE_className: css({
              [containerQueries.above.mobile]: {
                display: "none"
              }
            })
          }), (0, import_jsx_runtime2.jsx)(Text, {
            UNSAFE_className: css({
              [containerQueries.below.tablet]: {
                display: "none"
              }
            }),
            children: "Regenerate"
          })]
        }), slugErrorMessage !== void 0 && (0, import_jsx_runtime2.jsx)(Box, {
          height: "element.xsmall"
        })]
      })]
    })]
  });
}
function parseSlugFieldAsNormalField(value) {
  if (value === void 0) {
    return {
      name: "",
      slug: ""
    };
  }
  if (typeof value !== "object") {
    throw new FieldDataError("Must be an object");
  }
  if (Object.keys(value).length !== 2) {
    throw new FieldDataError("Unexpected keys");
  }
  if (!("name" in value) || !("slug" in value)) {
    throw new FieldDataError("Missing name or slug");
  }
  if (typeof value.name !== "string") {
    throw new FieldDataError("name must be a string");
  }
  if (typeof value.slug !== "string") {
    throw new FieldDataError("slug must be a string");
  }
  return {
    name: value.name,
    slug: value.slug
  };
}
function parseAsSlugField(value, slug2) {
  if (value === void 0) {
    return {
      name: "",
      slug: slug2
    };
  }
  if (typeof value !== "string") {
    throw new FieldDataError("Must be a string");
  }
  return {
    name: value,
    slug: slug2
  };
}
function slug(_args) {
  var _args$name$validation, _args$name$validation2, _args$name$validation3, _args$name$validation4, _args$slug;
  const args = {
    ..._args,
    name: {
      ..._args.name,
      validation: {
        length: {
          min: Math.max((_args$name$validation = _args.name.validation) !== null && _args$name$validation !== void 0 && _args$name$validation.isRequired ? 1 : 0, (_args$name$validation2 = (_args$name$validation3 = _args.name.validation) === null || _args$name$validation3 === void 0 || (_args$name$validation3 = _args$name$validation3.length) === null || _args$name$validation3 === void 0 ? void 0 : _args$name$validation3.min) !== null && _args$name$validation2 !== void 0 ? _args$name$validation2 : 0),
          max: (_args$name$validation4 = _args.name.validation) === null || _args$name$validation4 === void 0 || (_args$name$validation4 = _args$name$validation4.length) === null || _args$name$validation4 === void 0 ? void 0 : _args$name$validation4.max
        }
      }
    }
  };
  const naiveGenerateSlug = ((_args$slug = args.slug) === null || _args$slug === void 0 ? void 0 : _args$slug.generate) || import_slugify2.default;
  let _defaultValue;
  function defaultValue() {
    if (!_defaultValue) {
      var _args$name$defaultVal, _args$name$defaultVal2;
      _defaultValue = {
        name: (_args$name$defaultVal = args.name.defaultValue) !== null && _args$name$defaultVal !== void 0 ? _args$name$defaultVal : "",
        slug: naiveGenerateSlug((_args$name$defaultVal2 = args.name.defaultValue) !== null && _args$name$defaultVal2 !== void 0 ? _args$name$defaultVal2 : "")
      };
    }
    return _defaultValue;
  }
  function validate(value, {
    slugField
  } = {
    slugField: void 0
  }) {
    var _args$name$validation5, _args$name$validation6, _args$name$validation7, _args$name$validation8, _args$slug$validation, _args$slug2, _args$slug$validation2, _args$slug3, _args$slug$label, _args$slug4;
    const nameMessage = validateText(value.name, (_args$name$validation5 = (_args$name$validation6 = args.name.validation) === null || _args$name$validation6 === void 0 || (_args$name$validation6 = _args$name$validation6.length) === null || _args$name$validation6 === void 0 ? void 0 : _args$name$validation6.min) !== null && _args$name$validation5 !== void 0 ? _args$name$validation5 : 0, (_args$name$validation7 = (_args$name$validation8 = args.name.validation) === null || _args$name$validation8 === void 0 || (_args$name$validation8 = _args$name$validation8.length) === null || _args$name$validation8 === void 0 ? void 0 : _args$name$validation8.max) !== null && _args$name$validation7 !== void 0 ? _args$name$validation7 : Infinity, args.name.label, void 0);
    if (nameMessage !== void 0) {
      throw new FieldDataError(nameMessage);
    }
    const slugMessage = validateText(value.slug, (_args$slug$validation = (_args$slug2 = args.slug) === null || _args$slug2 === void 0 || (_args$slug2 = _args$slug2.validation) === null || _args$slug2 === void 0 || (_args$slug2 = _args$slug2.length) === null || _args$slug2 === void 0 ? void 0 : _args$slug2.min) !== null && _args$slug$validation !== void 0 ? _args$slug$validation : 1, (_args$slug$validation2 = (_args$slug3 = args.slug) === null || _args$slug3 === void 0 || (_args$slug3 = _args$slug3.validation) === null || _args$slug3 === void 0 || (_args$slug3 = _args$slug3.length) === null || _args$slug3 === void 0 ? void 0 : _args$slug3.max) !== null && _args$slug$validation2 !== void 0 ? _args$slug$validation2 : Infinity, (_args$slug$label = (_args$slug4 = args.slug) === null || _args$slug4 === void 0 ? void 0 : _args$slug4.label) !== null && _args$slug$label !== void 0 ? _args$slug$label : "Slug", slugField ? slugField : {
      slugs: emptySet2,
      glob: "*"
    });
    if (slugMessage !== void 0) {
      throw new FieldDataError(slugMessage);
    }
    return value;
  }
  const emptySet2 = /* @__PURE__ */ new Set();
  return {
    kind: "form",
    formKind: "slug",
    label: args.name.label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(SlugFieldInput, {
        args,
        naiveGenerateSlug,
        defaultValue: defaultValue(),
        ...props
      });
    },
    defaultValue,
    parse(value, args2) {
      if ((args2 === null || args2 === void 0 ? void 0 : args2.slug) !== void 0) {
        return parseAsSlugField(value, args2.slug);
      }
      return parseSlugFieldAsNormalField(value);
    },
    validate,
    serialize(value) {
      return {
        value
      };
    },
    serializeWithSlug(value) {
      return {
        value: value.name,
        slug: value.slug
      };
    },
    reader: {
      parse(value) {
        const parsed = parseSlugFieldAsNormalField(value);
        return validate(parsed);
      },
      parseWithSlug(value, args2) {
        return validate(parseAsSlugField(value, args2.slug), {
          slugField: {
            glob: args2.glob,
            slugs: emptySet2
          }
        }).name;
      }
    }
  };
}
function validateUrl(validation, value, label) {
  if (value !== null && (typeof value !== "string" || !isValidURL$1(value))) {
    return `${label} is not a valid URL`;
  }
  if (validation !== null && validation !== void 0 && validation.isRequired && value === null) {
    return `${label} is required`;
  }
}
function UrlFieldInput(props) {
  var _props$validation;
  const [blurred, onBlur] = (0, import_react2.useReducer)(() => true, false);
  return (0, import_jsx_runtime2.jsx)(TextField, {
    inputMode: "url",
    width: "auto",
    maxWidth: "scale.6000",
    label: props.label,
    description: props.description,
    autoFocus: props.autoFocus,
    value: props.value === null ? "" : props.value,
    onChange: (val) => {
      props.onChange(val === "" ? null : val);
    },
    onBlur,
    isRequired: (_props$validation = props.validation) === null || _props$validation === void 0 ? void 0 : _props$validation.isRequired,
    errorMessage: props.forceValidation || blurred ? validateUrl(props.validation, props.value, props.label) : void 0
  });
}
function url({
  label,
  defaultValue,
  validation,
  description
}) {
  return basicFormFieldWithSimpleReaderParse({
    label,
    Input(props) {
      return (0, import_jsx_runtime2.jsx)(UrlFieldInput, {
        label,
        description,
        validation,
        ...props
      });
    },
    defaultValue() {
      return defaultValue || null;
    },
    parse(value) {
      if (value === void 0) {
        return null;
      }
      if (typeof value !== "string") {
        throw new FieldDataError("Must be a string");
      }
      return value === "" ? null : value;
    },
    validate(value) {
      const message = validateUrl(validation, value, label);
      if (message !== void 0) {
        throw new FieldDataError(message);
      }
      assertRequired(value, validation, label);
      return value;
    },
    serialize(value) {
      return {
        value: value === null ? void 0 : value
      };
    }
  });
}
var index = Object.freeze({
  __proto__: null,
  array,
  blocks,
  checkbox,
  child,
  cloudImage,
  conditional,
  date,
  datetime,
  document: document$1,
  empty,
  emptyDocument,
  file,
  image,
  integer,
  multiRelationship,
  multiselect,
  number,
  object,
  pathReference,
  relationship,
  select,
  slug,
  text,
  url,
  mdx,
  markdoc
});
export {
  BlockWrapper$1 as BlockWrapper,
  NotEditable,
  ToolbarSeparator,
  collection,
  component,
  config,
  index as fields,
  singleton
};
//# sourceMappingURL=@keystatic_core.js.map
