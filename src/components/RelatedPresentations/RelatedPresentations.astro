---
import { getRelatedPresentations } from "../../utils/eventPresentationRelations";
import { getCollection } from "astro:content";

interface Props {
  eventId: string;
}

const { eventId } = Astro.props;

// Get all presentations
const allPresentations = await getCollection("presentations");

// Get related presentations for this event
const relatedPresentations = getRelatedPresentations(eventId, allPresentations);
---

{
  relatedPresentations.length > 0 && (
    <div class="mt-8">
      <h2 class="mb-4 text-2xl font-bold">Related Presentations</h2>
      <div class="grid gap-6 md:grid-cols-2">
        {relatedPresentations.map((presentation) => (
          <a
            href={`/presentations/${presentation.slug}/`}
            class="block rounded-lg bg-white shadow-md transition-shadow hover:shadow-lg dark:bg-base-900"
          >
            <div class="relative">
              {presentation.data.image && (
                <img
                  src={presentation.data.image}
                  alt={presentation.data.title || ""}
                  class="h-48 w-full rounded-t-lg object-cover"
                />
              )}
              {presentation.data.isWorkshop && (
                <span class="absolute right-2 top-2 rounded bg-primary-600 px-2 py-1 text-sm text-base-100 dark:text-base-900">
                  Workshop
                </span>
              )}
            </div>
            <div class="p-4">
              <h3 class="mb-2 text-lg font-semibold">
                {presentation.data.title}
              </h3>
              {presentation.data.duration && (
                <p class="text-sm text-base-600 dark:text-base-400">
                  Duration: {presentation.data.duration}
                </p>
              )}
              {presentation.data.intendedAudience && (
                <p class="mt-1 text-sm text-base-600 dark:text-base-400">
                  For: {presentation.data.intendedAudience}
                </p>
              )}
            </div>
          </a>
        ))}
      </div>
    </div>
  )
}
