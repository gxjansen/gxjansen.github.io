---
interface Props {
  word?: string;
  variant?: "default" | "game";
}

const { word = "Pondering", variant = "default" } = Astro.props;

// Don't double-add ellipsis if word already ends with one
const displayWord = word.endsWith("…") || word.endsWith("...") ? word : `${word}…`;

// Desynchronized animations
// Icon: start at a random position in the 8-character cycle (discrete steps)
const iconStep = Math.floor(Math.random() * 8);
const iconDelay = (iconStep * (1.4 / 8)).toFixed(3);
// Shimmer: random delay within the 2s cycle
const shimmerDelay = (Math.random() * 2).toFixed(2);
---

<div class="throbber my-4 flex items-center gap-2 font-mono text-sm select-none">
  <span
    class:list={["throbber-icon", variant === "game" ? "game" : "claude"]}
    style={`animation-delay: ${iconDelay}s`}
  ></span>
  <span class="throbber-text" style={`animation-delay: ${shimmerDelay}s`}>{displayWord}</span>
</div>

<style>
  .throbber-icon {
    display: inline-block;
    color: #E28E6E;
    width: 1em;
    text-align: center;
    transform: translateY(-2px);
  }

  /* Claude Code style: cycles between dot and star characters */
  .throbber-icon.claude::before {
    content: "·";
    animation: claude-cycle 1.4s steps(1) infinite;
    animation-delay: inherit;
  }

  @keyframes claude-cycle {
    0% { content: "·"; }
    12.5% { content: "•"; }
    25% { content: "✳"; }
    37.5% { content: "✶"; }
    50% { content: "✻"; }
    62.5% { content: "*"; }
    75% { content: "✶"; }
    87.5% { content: "✢"; }
  }

  /* Game style: cycles through fantasy ASCII characters */
  .throbber-icon.game::before {
    content: "†";
    animation: game-cycle 1.4s steps(1) infinite;
    animation-delay: inherit;
  }

  @keyframes game-cycle {
    0% { content: "†"; }      /* dagger */
    12.5% { content: "✧"; }   /* magic star */
    25% { content: "◆"; }     /* gem */
    37.5% { content: "ψ"; }   /* staff */
    50% { content: "※"; }     /* rune */
    62.5% { content: "☽"; }   /* moon */
    75% { content: "⚡"; }    /* lightning */
    87.5% { content: "✵"; }   /* burst */
  }

  .throbber-text {
    background: linear-gradient(
      90deg,
      #E28E6E 0%,
      #E28E6E 40%,
      #f4b8a0 50%,
      #E28E6E 60%,
      #E28E6E 100%
    );
    background-size: 200% 100%;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: throbber-shimmer 2s ease-in-out infinite;
  }

  @keyframes throbber-shimmer {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }
</style>
