---
import { formatDate, getFaviconUrl } from '@utils/pressUtils';
import type { PressCoverage } from '@types/press';

interface Props {
  articles: PressCoverage[];
}

const { articles } = Astro.props;

// Brand icon mapping based on organization
const getBrandIcon = (org: string | undefined): string | null => {
  if (!org) return null;
  const orgLower = org.toLowerCase();
  if (orgLower.includes('spryker')) return 'spryker';
  return null;
};
---

<section
  id="articles"
  class="mb-16"
  aria-labelledby="articles-heading"
>
  <h2
    id="articles-heading"
    class="h2 mb-4"
  >
    Articles & Interviews
  </h2>
  <div
    class="grid gap-4 md:grid-cols-2"
    role="list"
    aria-label="List of articles and interviews"
  >
    {articles.map(article => {
      const domain = article.articleUrl ? new URL(article.articleUrl).hostname : '';
      const formattedDate = formatDate(article.publicationDate);
      const articleId = `article-${article.articleUrl ? new URL(article.articleUrl).pathname.replace(/\W/g, '-') : crypto.randomUUID()}`;
      const brandIcon = getBrandIcon(article.personOrganization);

      return (
        <article
          class="article-card rounded-xl p-6 hover:shadow-lg transition-shadow bg-gradient-to-br from-base-50 to-base-100 dark:from-base-800/50 dark:to-base-700/50 border border-base-200 dark:border-base-600"
          role="listitem"
          aria-labelledby={articleId}
        >
          <div class="flex items-start gap-4">
            <div class="flex-shrink-0 w-12 h-12 rounded-lg flex items-center justify-center bg-base-200 dark:bg-base-700 overflow-hidden">
              {brandIcon === 'spryker' ? (
                <svg class="w-8 h-8" viewBox="0 0 100 100" aria-hidden="true">
                  <path class="fill-base-600 dark:fill-base-300" d="M52.944,93.257c-.243.168-.513.345-.78.549-.27.204-.549.411-.819.615-.243.204-.447.447-.576.717-.141.243-.168.513-.102.819,0,.062.039.102.039.168s.039.102.039.141c.039.039.039.102.062.141.039.039.039.102.062.141-.168.27-.345.549-.513.819-.141.27-.306.513-.474.717-.168.204-.372.372-.615.474-.243.102-.549.168-.885.168s-.678-.062-1.023-.168c-.345-.102-.655-.243-.947-.411-.306-.168-.615-.372-.885-.576-.306-.204-.576-.447-.845-.678,0-.039,0-.062-.039-.102,0-.039,0-.062-.039-.102,0-.039,0-.062-.039-.102,0-.039-.039-.062-.039-.102-.102-.27-.204-.513-.345-.717s-.345-.411-.513-.615c-.204-.168-.411-.345-.615-.513-.204-.141-.447-.306-.678-.411v.158c0,.039.039.062.039.141s.039.062.039.141.039.102.039.141.039.102.039.141c.243.678.576,1.332.987,1.947.411.576.885,1.089,1.434,1.536s1.128.819,1.74,1.089c.615.27,1.293.447,1.947.474.678.039,1.332-.062,1.908-.306.576-.243,1.128-.655,1.536-1.151.447-.513.743-1.151.921-1.868.168-.743.204-1.562.039-2.421l-.102-.997M26.182,59.786c-.062.039-.141.062-.204.102s-.141.062-.204.102-.141.062-.204.141c-.062.039-.141.102-.204.141-.372.243-.717.513-1.049.743-.345.27-.655.549-.921.845-.27.296-.549.655-.819,1.049-.27.411-.513.885-.717,1.434.655-.102,1.293-.102,1.947,0,.678.102,1.332.27,2.01.549.678.283,1.358.655,2.049,1.089.678.447,1.358.987,2.049,1.602l-2.727-8.105c-.062.039-.168.039-.243.062-.062.039-.168.039-.243.062-.062.039-.168.062-.243.102-.135.016-.201.039-.276.079M28.399,59.338l2.691,7.861,5.954.102c-.615-1.256-1.293-2.381-2.01-3.368-.717-.987-1.434-1.806-2.177-2.483-.743-.678-1.497-1.191-2.24-1.562-.72-.306-1.464-.51-2.217-.549M31.945,69.696c.921,1.089,1.806,2.319,2.691,3.714s1.74,2.957,2.549,4.635c.819,1.704,1.602,3.546,2.319,5.48.717,1.974,1.395,4.046,1.974,6.263.039-.947.062-1.947.039-2.931-.039-.987-.062-2.01-.168-3.036-.062-1.023-.204-2.076-.345-3.098-.141-1.049-.345-2.076-.549-3.138-.141-.717-.306-1.395-.474-2.076-.168-.678-.345-1.332-.549-1.974-.204-.655-.372-1.256-.576-1.868-.204-.615-.447-1.191-.655-1.74l-6.256-.23M18.423,11.716c.168,1.638.372,3.266.576,4.904.204,1.664.447,3.342.717,5.046.27,1.704.549,3.408.819,5.135.309,1.74.615,3.47.947,5.236.447,2.319.921,4.559,1.434,6.736.513,2.214,1.023,4.355,1.562,6.467.549,2.112,1.089,4.148,1.704,6.134.576,2.01,1.191,3.918,1.806,5.789.27-.039.549-.062.819-.062s.549.039.819.062c.27.039.549.102.819.204.27.102.549.204.819.345-.615-1.46-1.23-2.997-1.845-4.559s-1.191-3.164-1.766-4.802-1.128-3.302-1.664-5.006c-.539-1.704-1.089-3.444-1.602-5.21-.678-2.319-1.293-4.598-1.868-6.878-.576-2.24-1.128-4.493-1.602-6.71s-.931-4.394-1.342-6.532c-.497-2.151-.845-4.263-1.151-6.299M71.601,45.356c-.345.062-.717.141-1.049.204-.345.062-.678.168-1.049.243-.345.102-.678.168-1.023.27s-.678.204-1.023.345l-1.128,10.012c1.128-1.293,2.319-2.483,3.546-3.572,1.23-1.089,2.447-2.112,3.74-3.036,1.256-.921,2.585-1.74,3.918-2.447,1.332-.717,2.691-1.358,4.046-1.908-.819-.243-1.562-.411-2.342-.513s-1.536-.141-2.342-.141-1.602.062-2.447.168c-.845.102-1.74.243-2.691.372h-.155c.039.003,0,.003,0,.003M63.062,60.542l-14.509,7.22c-.204.819-.372,1.602-.474,2.447-.141.819-.243,1.664-.306,2.523s-.102,1.704-.062,2.549c0,.845.062,1.74.141,2.585.141,1.293.345,2.549.655,3.776.306,1.23.678,2.421,1.128,3.546.447,1.151.987,2.24,1.562,3.266.615,1.049,1.256,2.01,1.974,2.931.062-2.997.345-5.954.845-8.848.513-2.829,1.191-5.546,2.076-8.171.845-2.585,1.908-5.046,3.098-7.351,1.145-2.326,2.437-4.477,3.871-6.473M58.67,0c.474,1.806.845,3.674,1.191,5.621.306,1.974.549,3.983.717,6.095.168,2.151.306,4.355.411,6.634.102,2.319.141,4.737.168,7.223.102,5.789-.345,10.45-1.089,14.328-.78,4.019-1.908,7.144-3.138,9.835-1.256,2.727-2.625,4.944-3.842,7.016-1.256,2.151-2.342,4.125-3.036,6.467-.039.062-.039.102-.062.168-.026.062-.062.102-.062.168-.039.062-.039.141-.062.168-.039.062-.039.141-.062.168l13.7-6.582h0c.717-4.391,1.151-8.516,1.395-12.358.243-3.74.306-7.246.243-10.486-.062-3.164-.27-6.134-.513-8.848-.27-2.691-.615-5.135-.987-7.351-.27-1.664-.615-3.342-.947-4.944-.345-1.602-.743-3.164-1.151-4.7-.411-1.497-.845-2.997-1.332-4.431C59.693,2.753,59.207,1.358,58.67,0"/>
                </svg>
              ) : article.articleUrl ? (
                <img
                  src={getFaviconUrl(article.articleUrl)}
                  alt={article.personOrganization ? `${article.personOrganization} logo` : "Publication logo"}
                  width="32"
                  height="32"
                  class="w-8 h-8 object-contain"
                />
              ) : (
                <svg class="w-7 h-7 text-base-500 dark:text-base-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z" />
                </svg>
              )}
            </div>
            <div class="flex-1 min-w-0">
              <h3
                id={articleId}
                class="text-lg font-semibold text-base-900 dark:text-base-100 mb-2"
              >
                {article.title}
              </h3>
              <div
                class="text-sm text-base-600 dark:text-base-400 flex flex-wrap items-center gap-2"
                aria-label="Article details"
              >
                <time datetime={new Date(article.publicationDate).toISOString()}>
                  <span class="sr-only">Published on </span>
                  {formattedDate}
                </time>
                {article.personOrganization && (
                  <>
                    <span aria-hidden="true">•</span>
                    <span>
                      <span class="sr-only">Written by </span>
                      {article.personOrganization}
                    </span>
                  </>
                )}
                {domain && (
                  <>
                    <span aria-hidden="true">•</span>
                    <span>
                      <span class="sr-only">Published on </span>
                      {domain}
                    </span>
                  </>
                )}
              </div>
              {article.articleUrl && (
                <a
                  href={article.articleUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-1 mt-3 text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 font-medium text-sm"
                  aria-label={`View article about ${article.title} (opens in new tab)`}
                >
                  View article <span aria-hidden="true">→</span>
                </a>
              )}
            </div>
          </div>
        </article>
      );
    })}
  </div>
</section>
