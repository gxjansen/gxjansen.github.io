---
interface Props {
  videoId: string;
  title: string;
}

const { videoId, title } = Astro.props;

// Generate thumbnail URL
const thumbnailUrl = `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`;
---

<div
  class="lazy-youtube relative aspect-video overflow-hidden rounded-lg bg-base-200 dark:bg-white/[.075]"
  data-video-id={videoId}
  data-title={title}
>
  <!-- Thumbnail -->
  <img
    src={thumbnailUrl}
    alt={`Preview thumbnail for video: ${title}`}
    class="h-full w-full object-cover"
    loading="lazy"
    decoding="async"
  />

  <!-- Play button -->
  <button
    type="button"
    class="group absolute inset-0 flex h-full w-full items-center justify-center"
    aria-label={`Play video: ${title}`}
    onclick={`
      const container = this.closest('.lazy-youtube');
      const videoId = container.dataset.videoId;
      const title = container.dataset.title;

      // Track video play with Umami
      if (typeof umami !== 'undefined') {
        umami.track('media-play', { target: 'youtube', value: title || videoId });
      }

      const iframe = document.createElement('iframe');
      iframe.src = 'https://www.youtube.com/embed/' + videoId + '?autoplay=1&rel=0';
      iframe.title = title || 'YouTube video player';
      iframe.frameBorder = '0';
      iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
      iframe.allowFullscreen = true;
      iframe.classList.add('absolute', 'inset-0', 'w-full', 'h-full');

      container.innerHTML = '';
      container.appendChild(iframe);
    `}
  >
    <div
      class="flex h-12 w-16 items-center justify-center rounded-lg bg-red-600 transition-colors group-hover:bg-red-700"
    >
      <svg class="h-6 w-6 text-white" viewBox="0 0 24 24" fill="currentColor">
        <path d="M8 5v14l11-7z"></path>
      </svg>
    </div>
  </button>
</div>

<style>
  .lazy-youtube button:focus {
    outline: 2px solid theme("colors.primary.500");
    outline-offset: 2px;
  }

  /* High contrast mode support */
  @media (forced-colors: active) {
    .lazy-youtube button {
      border: 2px solid currentColor;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .lazy-youtube .transition-colors {
      transition: none;
    }
  }
</style>
