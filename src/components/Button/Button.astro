---
import ArrowLeftIcon from '@icons/ui/arrow-narrow-left.svg';
import ArrowRightIcon from '@icons/ui/arrow-narrow-right.svg';

/**
 *  * Notes:
 *  if this is to be a link (<a>), pass an "href" prop
 *  if this is to be a button (<button>), pass a "type" prop
 *  you can pass the arrow prop with "left" or "right" to add an arrow to any button variant
 */
interface Props {
  id?: string;
  type?: "button" | "submit" | "reset" | null | undefined;
  variant?: "primary" | "secondary" | "outline" | "ghost" | "on-color";
  href?: string; // the href to go to, ex "/posts/"
  target?: string; // the target for the link, ex "_blank"
  rel?: string; // the rel for the link, ex "noopener"
  arrow?: "left" | "right" | "none";
  onclick?: any; // any onclick events
  class?: string; // any additional classes
  disabled?: boolean; // disabled state
  umamiEvent?: string; // Umami event name (e.g., "cta-click")
  umamiEventTarget?: string; // Umami event target (e.g., "book-guido")
  rest?: any; // catch-all for any additional parameters, such as "aria-label"
}

const {
  type,
  id,
  variant = "primary",
  href,
  arrow = "none",
  onclick,
  disabled = false,
  umamiEvent,
  umamiEventTarget,
  class: className,
  ...rest
} = Astro.props as Props;

// Determine if the link is external
const isExternalLink = href && (href.startsWith('http://') || href.startsWith('https://'));

// Base button classes
// Rosé Pine accent colors for outline buttons
const outlineColors = ['love', 'gold', 'rose', 'pine', 'foam', 'iris'] as const;

// Get a random color if this is an outline button
const randomColor = variant === 'outline'
  ? outlineColors[Math.floor(Math.random() * outlineColors.length)]
  : undefined;

const baseClasses = [
  className,
  'button group',
  'inline-flex items-center justify-center',
  'focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2',
  'disabled:opacity-50 disabled:cursor-not-allowed',
  {
    'button--primary': variant === 'primary',
    'button--secondary': variant === 'secondary',
    'button--outline': variant === 'outline',
    'button--ghost': variant === 'ghost',
    'button--on-color': variant === 'on-color',
  },
];
---

<!-- Link button -->
{
  href && (
    <a
      id={id}
      class:list={baseClasses}
      href={href}
      target={isExternalLink ? "_blank" : undefined}
      rel={isExternalLink ? "noopener noreferrer" : undefined}
      onclick={onclick}
      role="button"
      aria-disabled={disabled}
      tabindex={disabled ? -1 : undefined}
      data-umami-event={umamiEvent}
      data-umami-event-target={umamiEventTarget}
      data-color={randomColor}
      {...rest}
    >
      {arrow === "left" && (
        <ArrowLeftIcon
          class="mr-1 h-[1.4em] w-[1.4em] transition-[transform] group-hover:-translate-x-1"
          aria-hidden="true"
          role="presentation"
        />
      )}
      <span class="button__text">
        <slot />
        {isExternalLink && <span class="sr-only">(opens in new tab)</span>}
      </span>
      {arrow === "right" && (
        <ArrowRightIcon
          class="ml-1 h-[1.4em] w-[1.4em] transition-[transform] group-hover:translate-x-1"
          aria-hidden="true"
          role="presentation"
        />
      )}
    </a>
  )
}

<!-- Regular button -->
{
  !href && (
    <button
      id={id}
      class:list={baseClasses}
      type={type}
      onclick={onclick}
      disabled={disabled}
      aria-disabled={disabled}
      data-umami-event={umamiEvent}
      data-umami-event-target={umamiEventTarget}
      data-color={randomColor}
      {...rest}
    >
      {arrow === "left" && (
        <ArrowLeftIcon
          class="mr-1 h-[1.4em] w-[1.4em] transition-[transform] group-hover:-translate-x-1"
          aria-hidden="true"
          role="presentation"
        />
      )}
      <span class="button__text">
        <slot />
      </span>
      {arrow === "right" && (
        <ArrowRightIcon
          class="ml-1 h-[1.4em] w-[1.4em] transition-[transform] group-hover:translate-x-1"
          aria-hidden="true"
          role="presentation"
        />
      )}
    </button>
  )
}

<style>
  .button {
    position: relative;
    padding: 0.75rem 1.5rem;
    border-radius: 0.375rem;
    font-weight: 500;
    transition: all 0.2s;
  }

  .button:disabled,
  .button[aria-disabled="true"] {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Variant styles with improved contrast ratios */
  .button--primary {
    @apply bg-primary-600 text-white hover:bg-primary-700;
  }

  .button--secondary {
    @apply bg-base-300 text-base-900 hover:bg-base-400 dark:bg-base-600 dark:text-white dark:hover:bg-base-700;
  }

  .button--outline {
    @apply border-2 bg-transparent transition-all duration-200;
    /* Use CSS custom property for color - set by data-color attribute */
    border-color: var(--btn-color);
    color: var(--btn-color);
  }

  .button--outline:hover {
    background-color: var(--btn-color);
    color: var(--btn-hover-text, white);
  }

  /* Rosé Pine accent colors - light mode */
  .button--outline[data-color="love"] { --btn-color: #b4637a; }
  .button--outline[data-color="gold"] { --btn-color: #ea9d34; }
  .button--outline[data-color="rose"] { --btn-color: #d7827e; }
  .button--outline[data-color="pine"] { --btn-color: #286983; }
  .button--outline[data-color="foam"] { --btn-color: #56949f; }
  .button--outline[data-color="iris"] { --btn-color: #907aa9; }

  /* Rosé Pine accent colors - dark mode */
  :global(.dark) .button--outline[data-color="love"] { --btn-color: #eb6f92; --btn-hover-text: #191724; }
  :global(.dark) .button--outline[data-color="gold"] { --btn-color: #f6c177; --btn-hover-text: #191724; }
  :global(.dark) .button--outline[data-color="rose"] { --btn-color: #ebbcba; --btn-hover-text: #191724; }
  :global(.dark) .button--outline[data-color="pine"] { --btn-color: #31748f; --btn-hover-text: #e0def4; }
  :global(.dark) .button--outline[data-color="foam"] { --btn-color: #9ccfd8; --btn-hover-text: #191724; }
  :global(.dark) .button--outline[data-color="iris"] { --btn-color: #c4a7e7; --btn-hover-text: #191724; }

  .button--ghost {
    @apply bg-transparent text-base-800 hover:bg-base-200 dark:text-base-100 dark:hover:bg-base-800;
  }

  /* Special variant for buttons on colored backgrounds */
  .button--on-color {
    @apply border-2 border-base-100 text-base-100 bg-transparent hover:bg-base-100 hover:text-primary-500 dark:border-base-900 dark:text-base-900 dark:hover:bg-base-900 dark:hover:text-primary-500;
  }
</style>
