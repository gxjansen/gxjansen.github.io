---
import ArrowLeftIcon from '@icons/ui/arrow-narrow-left.svg';
import ArrowRightIcon from '@icons/ui/arrow-narrow-right.svg';

/**
 *  * Notes:
 *  if this is to be a link (<a>), pass an "href" prop
 *  if this is to be a button (<button>), pass a "type" prop
 *  you can pass the arrow prop with "left" or "right" to add an arrow to any button variant
 */
interface Props {
  id?: string;
  type?: "button" | "submit" | "reset" | null | undefined;
  variant?: "primary" | "secondary" | "outline" | "ghost" | "on-color";
  href?: string; // the href to go to, ex "/posts/"
  target?: string; // the target for the link, ex "_blank"
  rel?: string; // the rel for the link, ex "noopener"
  arrow?: "left" | "right" | "none";
  onclick?: any; // any onclick events
  class?: string; // any additional classes
  disabled?: boolean; // disabled state
  umamiEvent?: string; // Umami event name (e.g., "cta-click")
  umamiEventTarget?: string; // Umami event target (e.g., "book-guido")
  rest?: any; // catch-all for any additional parameters, such as "aria-label"
}

const {
  type,
  id,
  variant = "primary",
  href,
  arrow = "none",
  onclick,
  disabled = false,
  umamiEvent,
  umamiEventTarget,
  class: className,
  ...rest
} = Astro.props as Props;

// Determine if the link is external
const isExternalLink = href && (href.startsWith('http://') || href.startsWith('https://'));

// Base button classes
// Rosé Pine accent color classes for outline buttons
const colorClasses = [
  'color-love',   // reds
  'color-gold',   // yellows
  'color-rose',   // warm highlights
  'color-pine',   // teals/greens
  'color-foam',   // blues/cyans
  'color-iris'    // purples
];

// Get a random color class if this is an outline button
const randomColorClass = variant === 'outline' 
  ? colorClasses[Math.floor(Math.random() * colorClasses.length)]
  : '';

const baseClasses = [
  className,
  'button group',
  'inline-flex items-center justify-center',
  'focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2',
  'disabled:opacity-50 disabled:cursor-not-allowed',
  {
    'button--primary': variant === 'primary',
    'button--secondary': variant === 'secondary',
    'button--outline': variant === 'outline',
    'button--ghost': variant === 'ghost',
    'button--on-color': variant === 'on-color',
  },
  randomColorClass // Add the random color class
];
---

<!-- Link button -->
{
  href && (
    <a
      id={id}
      class:list={baseClasses}
      href={href}
      target={isExternalLink ? "_blank" : undefined}
      rel={isExternalLink ? "noopener noreferrer" : undefined}
      onclick={onclick}
      role="button"
      aria-disabled={disabled}
      tabindex={disabled ? -1 : undefined}
      data-umami-event={umamiEvent}
      data-umami-event-target={umamiEventTarget}
      {...rest}
    >
      {arrow === "left" && (
        <ArrowLeftIcon
          class="mr-1 h-[1.4em] w-[1.4em] transition-[transform] group-hover:-translate-x-1"
          aria-hidden="true"
          role="presentation"
        />
      )}
      <span class="button__text">
        <slot />
        {isExternalLink && <span class="sr-only">(opens in new tab)</span>}
      </span>
      {arrow === "right" && (
        <ArrowRightIcon
          class="ml-1 h-[1.4em] w-[1.4em] transition-[transform] group-hover:translate-x-1"
          aria-hidden="true"
          role="presentation"
        />
      )}
    </a>
  )
}

<!-- Regular button -->
{
  !href && (
    <button
      id={id}
      class:list={baseClasses}
      type={type}
      onclick={onclick}
      disabled={disabled}
      aria-disabled={disabled}
      data-umami-event={umamiEvent}
      data-umami-event-target={umamiEventTarget}
      {...rest}
    >
      {arrow === "left" && (
        <ArrowLeftIcon
          class="mr-1 h-[1.4em] w-[1.4em] transition-[transform] group-hover:-translate-x-1"
          aria-hidden="true"
          role="presentation"
        />
      )}
      <span class="button__text">
        <slot />
      </span>
      {arrow === "right" && (
        <ArrowRightIcon
          class="ml-1 h-[1.4em] w-[1.4em] transition-[transform] group-hover:translate-x-1"
          aria-hidden="true"
          role="presentation"
        />
      )}
    </button>
  )
}

<style>
  .button {
    position: relative;
    padding: 0.75rem 1.5rem;
    border-radius: 0.375rem;
    font-weight: 500;
    transition: all 0.2s;
  }

  .button:disabled,
  .button[aria-disabled="true"] {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Variant styles with improved contrast ratios */
  .button--primary {
    @apply bg-primary-600 text-white hover:bg-primary-700;
  }

  .button--secondary {
    @apply bg-base-300 text-base-900 hover:bg-base-400 dark:bg-base-600 dark:text-white dark:hover:bg-base-700;
  }

  .button--outline {
    @apply border-2 bg-transparent transition-all duration-200;
  }

  /* Rosé Pine accent color variations */
  /* Love - reds */
  .button.button--outline.color-love {
    border-color: #b4637a !important;
    color: #b4637a !important;
  }
  :global(.dark) .button.button--outline.color-love {
    border-color: #eb6f92 !important;
    color: #eb6f92 !important;
  }
  .button.button--outline.color-love:hover {
    background-color: #b4637a !important;
    color: white !important;
  }
  :global(.dark) .button.button--outline.color-love:hover {
    background-color: #eb6f92 !important;
    color: #191724 !important;
  }

  /* Gold - yellows */
  .button.button--outline.color-gold {
    border-color: #ea9d34 !important;
    color: #ea9d34 !important;
  }
  :global(.dark) .button.button--outline.color-gold {
    border-color: #f6c177 !important;
    color: #f6c177 !important;
  }
  .button.button--outline.color-gold:hover {
    background-color: #ea9d34 !important;
    color: white !important;
  }
  :global(.dark) .button.button--outline.color-gold:hover {
    background-color: #f6c177 !important;
    color: #191724 !important;
  }

  /* Rose - warm highlights */
  .button.button--outline.color-rose {
    border-color: #d7827e !important;
    color: #d7827e !important;
  }
  :global(.dark) .button.button--outline.color-rose {
    border-color: #ebbcba !important;
    color: #ebbcba !important;
  }
  .button.button--outline.color-rose:hover {
    background-color: #d7827e !important;
    color: white !important;
  }
  :global(.dark) .button.button--outline.color-rose:hover {
    background-color: #ebbcba !important;
    color: #191724 !important;
  }

  /* Pine - teals/greens */
  .button.button--outline.color-pine {
    border-color: #286983 !important;
    color: #286983 !important;
  }
  :global(.dark) .button.button--outline.color-pine {
    border-color: #31748f !important;
    color: #31748f !important;
  }
  .button.button--outline.color-pine:hover {
    background-color: #286983 !important;
    color: white !important;
  }
  :global(.dark) .button.button--outline.color-pine:hover {
    background-color: #31748f !important;
    color: #e0def4 !important;
  }

  /* Foam - blues/cyans */
  .button.button--outline.color-foam {
    border-color: #56949f !important;
    color: #56949f !important;
  }
  :global(.dark) .button.button--outline.color-foam {
    border-color: #9ccfd8 !important;
    color: #9ccfd8 !important;
  }
  .button.button--outline.color-foam:hover {
    background-color: #56949f !important;
    color: white !important;
  }
  :global(.dark) .button.button--outline.color-foam:hover {
    background-color: #9ccfd8 !important;
    color: #191724 !important;
  }

  /* Iris - purples */
  .button.button--outline.color-iris {
    border-color: #907aa9 !important;
    color: #907aa9 !important;
  }
  :global(.dark) .button.button--outline.color-iris {
    border-color: #c4a7e7 !important;
    color: #c4a7e7 !important;
  }
  .button.button--outline.color-iris:hover {
    background-color: #907aa9 !important;
    color: white !important;
  }
  :global(.dark) .button.button--outline.color-iris:hover {
    background-color: #c4a7e7 !important;
    color: #191724 !important;
  }

  .button--ghost {
    @apply bg-transparent text-base-800 hover:bg-base-200 dark:text-base-100 dark:hover:bg-base-800;
  }

  /* Special variant for buttons on colored backgrounds */
  .button--on-color {
    @apply border-2 border-base-100 text-base-100 bg-transparent hover:bg-base-100 hover:text-primary-500 dark:border-base-900 dark:text-base-900 dark:hover:bg-base-900 dark:hover:text-primary-500;
  }
</style>
