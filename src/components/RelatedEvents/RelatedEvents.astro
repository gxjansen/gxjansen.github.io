---
import { getRelatedEvents } from "../../utils/eventPresentationRelations";
import { loadEventIcons } from "../../utils/eventUtils";
import type { Event as EventUtilsType } from "../../utils/eventUtils";
import EventCard from "../Events/EventCard.astro";

interface Props {
  presentationSlug: string;
}

const { presentationSlug } = Astro.props;

// Get related events for this presentation
const relatedEvents = getRelatedEvents(presentationSlug);

// Convert EventRelationType to EventUtilsType format
const eventsForLoading = relatedEvents.map((event) => ({
  ...event,
  loadedIcon: null, // Initialize with null, will be populated by loadEventIcons
}));

// Sort events by date in descending order and load icons
const sortedEvents = await loadEventIcons(
  [...eventsForLoading].sort(
    (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime(),
  ),
);

// Split events into two columns for better organization
const firstColumnEvents = sortedEvents.filter((_, i) => i % 2 === 0);
const secondColumnEvents = sortedEvents.filter((_, i) => i % 2 === 1);
---

{
  sortedEvents.length > 0 && (
    <div class="mt-12 border-t border-base-200 pt-12 dark:border-base-800">
      <h2 class="mb-8 text-2xl font-bold text-base-900 dark:text-base-100">
        I've given the above session at the following events:
      </h2>
      <div class="grid grid-cols-1 gap-6 md:grid-cols-2 md:gap-8">
        {/* First column */}
        <div class="space-y-6">
          {firstColumnEvents.map((event) => (
            <EventCard
              {...event}
              showPresentationName={false}
              isOnPresentationPage={true}
            />
          ))}
        </div>

        {/* Second column - offset as a whole */}
        <div class="space-y-6 md:mt-24">
          {secondColumnEvents.map((event) => (
            <EventCard
              {...event}
              showPresentationName={false}
              isOnPresentationPage={true}
            />
          ))}
        </div>
      </div>
    </div>
  )
}
