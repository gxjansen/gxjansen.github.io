---
import type { CollectionEntry } from "astro:content";
import { getLocaleFromUrl } from "@js/localeUtils";

interface Props {
  currentSlug: string;
  posts: CollectionEntry<"post">[];
}

const { currentSlug, posts } = Astro.props;
const currLocale = getLocaleFromUrl(Astro.url);

// Sort posts by date, newest first
const sortedPosts = posts.sort(
  (a, b) =>
    new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime(),
);

// Find current post index
const currentIndex = sortedPosts.findIndex((p) => p.slug === currentSlug);
const prevPost = currentIndex > 0 ? sortedPosts[currentIndex - 1] : null;
const nextPost =
  currentIndex < sortedPosts.length - 1 ? sortedPosts[currentIndex + 1] : null;
---

<nav
  class="mt-12 border-t border-base-200 pt-8 dark:border-base-800"
  aria-label="Blog post navigation"
>
  <div class="flex items-center justify-between">
    <a
      href={`/post/`}
      class="flex items-center gap-2 rounded text-base-600 hover:text-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:text-base-400 dark:hover:text-primary-400"
      aria-label="Return to article overview"
      data-umami-event="nav-click"
      data-umami-event-target="blog-overview"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-4 w-4"
        viewBox="0 0 24 24"
        stroke-width="2"
        stroke="currentColor"
        fill="none"
        aria-hidden="true"
        role="presentation"
      >
        <path d="M15 6l-6 6l6 6"></path>
      </svg>
      <span>Back to Article Overview</span>
    </a>
  </div>

  <div class="mt-8 flex items-center justify-between gap-4">
    {
      prevPost && (
        <a
          href={`/post/${prevPost.slug}/`}
          class="group flex-1 rounded-lg border border-base-200 p-4 hover:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:border-base-800 dark:hover:border-primary-400"
          aria-label={`Previous article: ${prevPost.data.title}`}
          data-umami-event="nav-click"
          data-umami-event-target="blog-prev"
        >
          <span class="flex items-center gap-1 text-sm text-base-500 group-hover:text-primary-500 dark:text-base-400 dark:group-hover:text-primary-400">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              fill="none"
              aria-hidden="true"
              role="presentation"
            >
              <path d="M15 6l-6 6l6 6" />
            </svg>
            <span>Previous</span>
          </span>
          <p class="mt-1 line-clamp-2 font-medium text-base-900 group-hover:text-primary-500 dark:text-white dark:group-hover:text-primary-400">
            {prevPost.data.title}
          </p>
        </a>
      )
    }

    {
      nextPost && (
        <a
          href={`/post/${nextPost.slug}/`}
          class="group flex-1 rounded-lg border border-base-200 p-4 text-right hover:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:border-base-800 dark:hover:border-primary-400"
          aria-label={`Next article: ${nextPost.data.title}`}
          data-umami-event="nav-click"
          data-umami-event-target="blog-next"
        >
          <span class="flex items-center justify-end gap-1 text-sm text-base-500 group-hover:text-primary-500 dark:text-base-400 dark:group-hover:text-primary-400">
            <span>Next</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              fill="none"
              aria-hidden="true"
              role="presentation"
            >
              <path d="M9 6l6 6l-6 6" />
            </svg>
          </span>
          <p class="mt-1 line-clamp-2 font-medium text-base-900 group-hover:text-primary-500 dark:text-white dark:group-hover:text-primary-400">
            {nextPost.data.title}
          </p>
        </a>
      )
    }
  </div>
</nav>
