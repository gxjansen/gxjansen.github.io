---
// utils
import { getCollection } from "astro:content";
import { defaultLocale } from "@config/siteSettings.json";

// layouts
import BlogLayoutCenter from "@layouts/BlogLayoutCenter.astro";

// Get all posts for static paths
export async function getStaticPaths() {
  const posts = await getCollection("post", ({ data }) => {
    return !data.draft;
  });
  
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { 
      post,
      allPosts: posts // Pass all non-draft posts
    },
  }));
}

// Get the post data from props
const { post, allPosts } = Astro.props;

if (!post) {
  return Astro.redirect('/404');
}

// Get the rendered content
const { Content } = await post.render();
---

<BlogLayoutCenter post={post} allPosts={allPosts} transitionName={`heroImage-${post.slug}`}>
  <Content />
</BlogLayoutCenter>
