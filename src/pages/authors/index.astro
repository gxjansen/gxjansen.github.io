---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "@layouts/BaseLayout.astro";

const authors = await getCollection("authors");

// Get post counts for each author
const allPosts = await getCollection("post", ({ data }) => !data.draft);
const authorPostCounts = authors.map(author => {
  const postCount = allPosts.filter(post =>
    post.data.authors && post.data.authors.includes(author.slug)
  ).length;
  return { author, postCount };
}).sort((a, b) => b.postCount - a.postCount);
---

<BaseLayout
  title="About the Author"
  description="Meet the expert behind this content"
>
  <div class="mt-24 mx-auto max-w-5xl px-4">
    <h1 class="text-4xl md:text-5xl font-bold text-base-900 dark:text-base-100 mb-4">
      About the Author
    </h1>
    <p class="text-xl text-base-600 dark:text-base-400 mb-12">
      Meet the expert behind this content
    </p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {authorPostCounts.map(({ author, postCount }) => (
        <article class="border border-base-300 dark:border-base-700 rounded-xl p-6 hover:shadow-lg transition-shadow">
          <a href={`/authors/${author.slug}/`} class="flex gap-6">
            {author.data.avatar && (
              <div class="flex-shrink-0">
                <Image
                  src={author.data.avatar}
                  alt={`${author.data.name}'s avatar`}
                  width={100}
                  height={100}
                  quality="high"
                  class="h-20 w-20 rounded-full object-cover"
                />
              </div>
            )}

            <div class="flex-1">
              <h2 class="text-xl font-bold text-base-900 dark:text-base-100 hover:text-primary-500 dark:hover:text-primary-400">
                {author.data.name}
              </h2>

              {(author.data.jobTitle || author.data.organization) && (
                <div class="mt-1 text-sm text-base-600 dark:text-base-400">
                  {author.data.jobTitle}
                  {author.data.jobTitle && author.data.organization && " at "}
                  {author.data.organization}
                </div>
              )}

              {author.data.bioShort && (
                <p class="mt-2 text-sm text-base-700 dark:text-base-300 line-clamp-2">
                  {author.data.bioShort}
                </p>
              )}

              <div class="mt-3 text-sm text-primary-600 dark:text-primary-400">
                {postCount} {postCount === 1 ? 'article' : 'articles'}
              </div>
            </div>
          </a>
        </article>
      ))}
    </div>
  </div>
</BaseLayout>
