---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "@layouts/BaseLayout.astro";

const authors = await getCollection("authors");

// Get post counts for each author
const allPosts = await getCollection("post", ({ data }) => !data.draft);
const authorPostCounts = authors
  .map((author) => {
    const postCount = allPosts.filter(
      (post) => post.data.authors && post.data.authors.includes(author.slug),
    ).length;
    return { author, postCount };
  })
  .sort((a, b) => b.postCount - a.postCount);
---

<BaseLayout
  title="About the Author"
  description="Meet the expert behind this content"
>
  <div class="mx-auto mt-24 max-w-5xl px-4">
    <h1
      class="mb-4 text-4xl font-bold text-base-900 md:text-5xl dark:text-base-100"
    >
      About the Author
    </h1>
    <p class="mb-12 text-xl text-base-600 dark:text-base-400">
      Meet the expert behind this content
    </p>

    <div class="grid grid-cols-1 gap-8 md:grid-cols-2">
      {
        authorPostCounts.map(({ author, postCount }) => (
          <article class="rounded-xl border border-base-300 p-6 transition-shadow hover:shadow-lg dark:border-base-700">
            <a href={`/authors/${author.slug}/`} class="flex gap-6">
              {author.data.avatar && (
                <div class="flex-shrink-0">
                  <Image
                    src={author.data.avatar}
                    alt={`${author.data.name}'s avatar`}
                    width={100}
                    height={100}
                    quality="high"
                    class="h-20 w-20 rounded-full object-cover"
                  />
                </div>
              )}

              <div class="flex-1">
                <h2 class="text-xl font-bold text-base-900 hover:text-primary-500 dark:text-base-100 dark:hover:text-primary-400">
                  {author.data.name}
                </h2>

                {(author.data.jobTitle || author.data.organization) && (
                  <div class="mt-1 text-sm text-base-600 dark:text-base-400">
                    {author.data.jobTitle}
                    {author.data.jobTitle && author.data.organization && " at "}
                    {author.data.organization}
                  </div>
                )}

                {author.data.bioShort && (
                  <p class="mt-2 line-clamp-2 text-sm text-base-700 dark:text-base-300">
                    {author.data.bioShort}
                  </p>
                )}

                <div class="mt-3 text-sm text-primary-600 dark:text-primary-400">
                  {postCount} {postCount === 1 ? "article" : "articles"}
                </div>
              </div>
            </a>
          </article>
        ))
      }
    </div>
  </div>
</BaseLayout>
