/* Import Component Styles */
@use './utilities/utilities';
@use './components/alerts';
@use './components/cards';
@use './components/links';
@use './base/typography';
@use './prose';
@use './scroll-reveal';

/* Base Styles */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Base Typography */
@layer base {
  html {
    font-size: 16px;

    @screen sm {
      font-size: 18px;
    }

    @screen md {
      font-size: 22.4px; /* 1.4rem */
    }
  }
}

/* Layer Components */
@layer components {
  /* Card Base Styles */
  .card {
    @apply bg-base-50 dark:bg-base-900 rounded-xl shadow-lg transition-all duration-300 overflow-hidden;
  }

  .card-container {
    @apply mb-0;
  }

  .card-content {
    @apply p-4 sm:p-6 md:p-8 flex flex-col;
  }

  .card-title {
    @apply text-xl font-semibold mb-4 text-base-900 dark:text-base-100;
  }

  .card-meta {
    @apply text-sm text-base-500 dark:text-base-400 flex flex-wrap gap-2 mb-4;
  }

  .cards-grid {
    @apply grid gap-6 md:grid-cols-2 lg:grid-cols-3;
  }

  /* Card Media */
  .card img:first-child,
  .card iframe:first-child {
    @apply aspect-video object-cover mb-0;
  }

  /* Video Card */
  .lazy-youtube {
    @apply aspect-video relative;

    img {
      @apply w-full h-full object-cover;
    }
  }

  /* Horizontal Scroll Container */
  .scroll-container {
    @apply flex overflow-x-auto gap-3 pb-6 snap-x snap-mandatory px-2;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    scroll-behavior: smooth;

    &::-webkit-scrollbar {
      display: none;
    }
  }

  .scroll-container-wrapper {
    @apply relative;
  }

  .scroll-item {
    @apply flex-none snap-center w-[calc(100%-1rem)] sm:w-[calc(50%-0.5rem)] max-w-full box-border;
  }

  /* Carousel Header and Progress */
  .carousel-header {
    @apply mb-6 flex flex-col items-center;
  }

  .carousel-progress {
    @apply flex gap-2 justify-center items-center mt-2;
  }

  .progress-dot {
    @apply w-2 h-2 rounded-full transition-all duration-300;
    @apply bg-base-300 dark:bg-base-600;

    &[data-active="true"] {
      @apply w-3 h-3;
      @apply bg-primary-500 dark:bg-primary-400;
    }
  }

  /* Navigation Buttons */
  .nav-button {
    @apply absolute top-1/2 -translate-y-1/2 z-10;
    @apply w-12 h-12 flex items-center justify-center;
    @apply bg-base-50/95 dark:bg-base-800/95 rounded-full;
    @apply text-base-800 dark:text-base-200 text-2xl;
    @apply shadow-lg transition-all duration-300;
    @apply hover:bg-base-100 dark:hover:bg-base-700;
    @apply focus:outline-none focus:ring-2 focus:ring-primary-500;
    @apply disabled:opacity-30 disabled:cursor-not-allowed;
    @apply disabled:hover:bg-base-50/95 dark:disabled:hover:bg-base-800/95;
    /* Improved touch target size */
    @apply touch-manipulation;

    &.left-button {
      @apply left-0 -translate-x-1/2;
    }

    &.right-button {
      @apply right-0 translate-x-1/2;
    }

    /* Prevent button clicks from triggering card links */
    &::before {
      content: '';
      @apply absolute inset-0;
    }

    /* Improved focus styles */
    &:focus-visible {
      @apply ring-offset-2 ring-offset-base-50 dark:ring-offset-base-900;
    }
  }

  .site-container {
    @apply mx-auto max-w-7xl w-full box-border px-2 sm:px-4;
  }


  /* Z-index Management */
  .z-background {
    @apply -z-10;
  }

  .z-base {
    @apply z-0;
  }

  .z-nav {
    @apply z-10;
  }

  .z-overlay {
    @apply z-20;
  }

  .z-modal {
    @apply z-30;
  }

  .z-toast {
    @apply z-40;
  }

  .z-tooltip {
    @apply z-50;
  }
}

/* Animated Focus Ring */
@keyframes focus-ring-expand {
  from {
    outline-offset: 0px;
    outline-color: transparent;
  }
  to {
    outline-offset: 3px;
    outline-color: theme('colors.primary.500');
  }
}

:focus-visible {
  outline: 2px solid theme('colors.primary.500');
  outline-offset: 3px;
  animation: focus-ring-expand 0.2s cubic-bezier(0.33, 1, 0.68, 1);
}

/* Global Reduced-Motion Safety Net */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Bluesky Comments Styling */
.bluesky-comments-wrapper {
  /* Style the library's "Comments" title to match our design */
  [class*="_commentsTitle_"] {
    @apply text-xl font-bold mb-4 text-base-900 dark:text-base-100;
    margin-top: 0 !important; /* Override library's margin-top */
  }

  /* Style the stats bar (likes, reposts, etc.) */
  [class*="_statsBar_"] {
    @apply text-base-600 dark:text-base-400 text-sm mb-4;
  }

  /* Style the reply text */
  [class*="_replyText_"] {
    @apply text-base-600 dark:text-base-400;
  }

  /* Style the divider */
  [class*="_divider_"] {
    @apply border-base-200 dark:border-base-700;
    border-top-width: 1px;
    border-top-style: solid;
  }

  /* Comments list spacing */
  [class*="_commentsList_"] {
    @apply mt-4;
  }

  /* Individual comment styling */
  [class*="_commentContainer_"] {
    @apply py-3;
  }

  /* Comment content */
  [class*="_commentContent_"] {
    @apply max-w-none;
  }

  /* Author link styling */
  [class*="_authorLink_"] {
    @apply text-base-900 dark:text-base-100;

    &:hover {
      @apply text-primary-600 dark:text-primary-400;
    }
  }

  /* Author name */
  [class*="_authorName_"] {
    @apply font-medium text-base-900 dark:text-base-100;
  }

  /* Handle (username) */
  [class*="_handle_"] {
    @apply text-base-500 dark:text-base-400;
  }

  /* Avatar styling */
  [class*="_avatar_"] {
    @apply bg-base-200 dark:bg-base-700;
  }

  /* Replies container (nested comments) */
  [class*="_repliesContainer_"] {
    @apply border-base-300 dark:border-base-600;
    border-left-width: 2px;
  }

  /* Actions container */
  [class*="_actionsContainer_"] {
    @apply text-base-500 dark:text-base-400 text-xs;
  }

  /* Show more button */
  [class*="_showMoreButton_"] {
    @apply text-base-600 dark:text-base-300 border-base-300 dark:border-base-600;
    @apply hover:bg-base-100 dark:hover:bg-base-800;
    @apply rounded-md px-3 py-1.5;
    background: transparent !important;
  }

  /* Loading and error text */
  [class*="_loadingText_"],
  [class*="_errorText_"] {
    @apply text-base-600 dark:text-base-400;
  }

  /* Link styling inside comments - WCAG AA compliance */
  a {
    @apply text-foam-light hover:underline;
  }

  :root[class~="dark"] & a {
    @apply text-foam;
  }

  /* Override library container max-width */
  [class*="_container_"] {
    max-width: none !important;
  }
}
